import"./axios-f993d27a.js";import{Y as u,o as h,p as _,c3 as y,e8 as d,e9 as g}from"./ParameterInputList-a8424193.js";import{y as f}from"./n8n-8025af5e.js";import{m as b}from"./vue-typed-mixins-a25478b2.js";import{D as v}from"./index-3ee35394.js";import{m as C}from"./pinia-ba86f1d8.js";import{M as $}from"./MappingPill-ddae2198.js";import"./vendor-df0f493f.js";import"./flatted-8b14da7d.js";import"./vue-i18n-b439dfd7.js";import"./en-bbe6b9d4.js";import"./dateformat-ef117725.js";import"./lodash-es-e1022157.js";import"./codemirror-lang-html-n8n-728c3977.js";import"./@jsplumb/browser-ui-ddea9532.js";import"./@jsplumb/core-75ba1e73.js";import"./@jsplumb/util-79bcf4d9.js";import"./@jsplumb/common-fe415eb9.js";import"./@jsplumb/connector-bezier-c9c16c6b.js";import"./uuid-cf522c50.js";import"./codemirror-lang-n8n-expression-0036beb8.js";import"./luxon-3d1ae2f1.js";import"./fast-json-stable-stringify-0e965c3b.js";import"./esprima-next-d1b163ef.js";import"./prettier-50ab9e24.js";import"./@fortawesome/fontawesome-svg-core-a6b9645d.js";import"./@fortawesome/free-solid-svg-icons-a2911fb5.js";import"./@fortawesome/free-regular-svg-icons-74cb85f8.js";import"./@fortawesome/vue-fontawesome-1701eda0.js";import"./vue2-touch-events-2bad05e9.js";import"./v-click-outside-01179a04.js";import"./vue-fragment-f3d0cc79.js";import"./vue-agile-00cde7d9.js";import"./timeago.js-a9e71aec.js";import"./canvas-confetti-60b90aac.js";import"./file-saver-d988540e.js";import"./vue2-teleport-53e66c3b.js";import"./vue-json-pretty-49f1c0cb.js";import"./humanize-duration-3471cd08.js";import"./vue-infinite-loading-8e5543e4.js";import"./copy-to-clipboard-fcf36459.js";const c=40,w=b(u).extend({name:"run-data-table",components:{Draggable:v,MappingPill:$},props:{node:{type:Object},inputData:{type:Array},mappingEnabled:{type:Boolean},distanceFromActive:{type:Number},runIndex:{type:Number},outputIndex:{type:Number},totalRuns:{type:Number},pageOffset:{type:Number},hasDefaultHoverState:{type:Boolean}},data(){return{activeColumn:-1,forceShowGrip:!1,draggedColumn:!1,draggingPath:null,hoveringPath:null,mappingHintVisible:!1,activeRow:null,columnLimit:c,columnLimitExceeded:!1}},mounted(){if(this.tableData&&this.tableData.columns&&this.$refs.draggable){const e=this.$refs.draggable.$refs.wrapper;e&&this.$emit("mounted",{avgRowHeight:e.offsetHeight/this.tableData.data.length})}},computed:{...C(_,h),hoveringItem(){return this.ndvStore.hoveringItem},pairedItemMappings(){return this.workflowsStore.workflowExecutionPairedItemMappings},tableData(){return this.convertToTable(this.inputData)},focusedMappableInput(){return this.ndvStore.focusedMappableInput}},methods:{shorten:y,isHoveringRow(e){if(e===this.activeRow)return!0;const t=this.pageOffset+e;if(t===0&&!this.hoveringItem&&this.hasDefaultHoverState&&this.distanceFromActive===1)return!0;const a=d(this.node.name,this.runIndex||0,this.outputIndex||0,t);if(!this.hoveringItem||!this.pairedItemMappings[a])return!1;const s=d(this.hoveringItem.nodeName,this.hoveringItem.runIndex,this.hoveringItem.outputIndex,this.hoveringItem.itemIndex);return this.pairedItemMappings[a].has(s)},onMouseEnterCell(e){const t=e.target;if(t&&this.mappingEnabled){const a=t.dataset.col;a&&!isNaN(parseInt(a,10))&&(this.activeColumn=parseInt(a,10))}if(t){const a=t.dataset.row;a&&!isNaN(parseInt(a,10))&&(this.activeRow=parseInt(a,10),this.$emit("activeRowChanged",this.pageOffset+this.activeRow))}},onMouseLeaveCell(){this.activeColumn=-1,this.activeRow=null,this.$emit("activeRowChanged",null)},onMouseEnterKey(e,t){this.hoveringPath=this.getCellExpression(e,t)},onMouseLeaveKey(){this.hoveringPath=null},isHovering(e,t){const a=this.getCellExpression(e,t);return this.hoveringPath===a},getExpression(e){return this.node?g({nodeName:this.node.name,distanceFromActive:this.distanceFromActive,path:[e]}):""},getPathNameFromTarget(e){return e?e.dataset.name:""},getCellPathName(e,t){const a=e[e.length-1];return typeof a=="string"?a:e.length>1?`${e[e.length-2]}[${a}]`:`${this.tableData.columns[t]}[${a}]`},getCellExpression(e,t){if(!this.node)return"";const a=this.tableData.columns[t];return g({nodeName:this.node.name,distanceFromActive:this.distanceFromActive,path:[a,...e]})},isEmpty(e){return e===""||Array.isArray(e)&&e.length===0||typeof e=="object"&&e!==null&&Object.keys(e).length===0||e===null||e===void 0},getValueToRender(e){return e===""?this.$locale.baseText("runData.emptyString"):typeof e=="string"?e.replaceAll(`
`,"\\n"):Array.isArray(e)&&e.length===0?this.$locale.baseText("runData.emptyArray"):typeof e=="object"&&e!==null&&Object.keys(e).length===0?this.$locale.baseText("runData.emptyObject"):e==null?`[${e}]`:e},onDragStart(){this.draggedColumn=!0,this.ndvStore.resetMappingTelemetry()},onCellDragStart(e){e&&e.dataset.value&&(this.draggingPath=e.dataset.value),this.onDragStart()},onCellDragEnd(e){this.draggingPath=null,this.onDragEnd(e.dataset.name||"","tree",e.dataset.depth||"0")},isDraggingKey(e,t){if(this.draggingPath)return this.draggingPath===this.getCellExpression(e,t)},onDragEnd(e,t,a="0"){setTimeout(()=>{const s=this.ndvStore.mappingTelemetry,n={src_node_type:this.node.type,src_field_name:e,src_nodes_back:this.distanceFromActive,src_run_index:this.runIndex,src_runs_total:this.totalRuns,src_field_nest_level:parseInt(a,10),src_view:"table",src_element:t,success:!1,...s};this.$externalHooks().run("runDataTable.onDragEnd",n),this.$telemetry.track("User dragged data for mapping",n)},1e3)},isSimple(e){return typeof e!="object"||e===null||Array.isArray(e)&&e.length===0||typeof e=="object"&&Object.keys(e).length===0},hasJsonInColumn(e){return this.tableData.hasJson[this.tableData.columns[e]]},convertToTable(e){const t=[],a=[];let s,n,r;const o={};return e.forEach(l=>{if(!l.hasOwnProperty("json"))return;r=l.json,n=[];const p=Object.keys(r||{});p.length>c?(this.columnLimitExceeded=!0,s=p.slice(0,c)):s=p,a.forEach(i=>{r.hasOwnProperty(i)?(n.push(r[i]),s.splice(s.indexOf(i),1),o[i]=o[i]||typeof r[i]=="object"&&Object.keys(r[i]||{}).length>0||!1):n.push(void 0)}),s.forEach(i=>{a.push(i),n.push(r[i]),o[i]=o[i]||typeof r[i]=="object"&&Object.keys(r[i]||{}).length>0||!1}),t.push(n)}),t.forEach(l=>{a.length>l.length&&l.push(...new Array(a.length-l.length))}),{hasJson:o,columns:a,data:t}},switchToJsonView(){this.$emit("displayModeChange","json")}},watch:{focusedMappableInput(e){setTimeout(()=>{this.forceShowGrip=!!this.focusedMappableInput},e?300:150)}}}),D="/%7B%7BBASE_PATH%7D%7D/static/data-mapping-gif.gif",E="_dataDisplay_1tktz_1",I="_table_1tktz_14",M="_nodeClass_1tktz_62",k="_emptyCell_1tktz_66",x="_header_1tktz_70",T="_draggableHeader_1tktz_82",R="_dragButton_1tktz_86",S="_draggingHeader_1tktz_90",H="_activeHeader_1tktz_94",z="_dataKey_1tktz_103",P="_value_1tktz_112",K="_nestedValue_1tktz_116 _value_1tktz_112",A="_mappable_1tktz_121",N="_empty_1tktz_66",j="_limitColWidth_1tktz_129",O="_minColWidth_1tktz_133",L="_hoveringKey_1tktz_137",V="_draggingKey_1tktz_141",F="_tableRightMargin_1tktz_145",B="_hoveringRow_1tktz_153",W="_warningTooltip_1tktz_158",J={dataDisplay:E,table:I,nodeClass:M,emptyCell:k,header:x,draggableHeader:T,dragButton:R,draggingHeader:S,activeHeader:H,dataKey:z,value:P,nestedValue:K,mappable:A,empty:N,limitColWidth:j,minColWidth:O,hoveringKey:L,draggingKey:V,tableRightMargin:F,hoveringRow:B,warningTooltip:W};var G=function(){var t=this,a=t._self._c;return t._self._setupProxy,a("div",{class:t.$style.dataDisplay},[t.tableData.columns&&t.tableData.columns.length===0?a("table",{class:t.$style.table},[a("tr",[a("th",{class:t.$style.emptyCell}),a("th",{class:t.$style.tableRightMargin})]),t._l(t.tableData.data,function(s,n){return a("tr",{key:n,class:{[t.$style.hoveringRow]:t.isHoveringRow(n)}},[a("td",{attrs:{"data-row":n,"data-col":0},on:{mouseenter:t.onMouseEnterCell,mouseleave:t.onMouseLeaveCell}},[a("n8n-info-tip",[t._v(t._s(t.$locale.baseText("runData.emptyItemHint")))])],1),a("td",{class:t.$style.tableRightMargin})])})],2):a("table",{class:t.$style.table},[a("thead",[a("tr",[t._l(t.tableData.columns||[],function(s,n){return a("th",{key:s},[a("n8n-tooltip",{attrs:{placement:"bottom-start",disabled:!t.mappingEnabled,"open-delay":1e3},scopedSlots:t._u([{key:"content",fn:function(){return[a("div",[a("img",{attrs:{src:D}}),t._v(" "+t._s(t.$locale.baseText("dataMapping.dragColumnToFieldHint"))+" ")])]},proxy:!0}],null,!0)},[a("draggable",{attrs:{type:"mapping",data:t.getExpression(s),disabled:!t.mappingEnabled},on:{dragstart:t.onDragStart,dragend:r=>t.onDragEnd(r,"column")},scopedSlots:t._u([{key:"preview",fn:function({canDrop:r}){return[a("MappingPill",{attrs:{html:t.shorten(s,16,2),"can-drop":r}})]}},{key:"default",fn:function({isDragging:r}){return[a("div",{class:{[t.$style.header]:!0,[t.$style.draggableHeader]:t.mappingEnabled,[t.$style.activeHeader]:(n===t.activeColumn||t.forceShowGrip)&&t.mappingEnabled,[t.$style.draggingHeader]:r}},[a("span",[t._v(t._s(s||"Â "))]),a("div",{class:t.$style.dragButton},[a("font-awesome-icon",{attrs:{icon:"grip-vertical"}})],1)])]}}],null,!0)})],1)],1)}),t.columnLimitExceeded?a("th",{class:t.$style.header},[a("n8n-tooltip",{attrs:{placement:"bottom-end"},scopedSlots:t._u([{key:"content",fn:function(){return[a("div",[a("i18n",{attrs:{path:"dataMapping.tableView.tableColumnsExceeded.tooltip"},scopedSlots:t._u([{key:"columnLimit",fn:function(){return[t._v(t._s(t.columnLimit))]},proxy:!0},{key:"link",fn:function(){return[a("a",{on:{click:t.switchToJsonView}},[t._v(t._s(t.$locale.baseText("dataMapping.tableView.tableColumnsExceeded.tooltip.link")))])]},proxy:!0}],null,!1,344426289)})],1)]},proxy:!0}],null,!1,3350813415)},[a("span",[a("font-awesome-icon",{class:t.$style.warningTooltip,attrs:{icon:"exclamation-triangle"}}),t._v(" "+t._s(t.$locale.baseText("dataMapping.tableView.tableColumnsExceeded"))+" ")],1)])],1):t._e(),a("th",{class:t.$style.tableRightMargin})],2)]),a("draggable",{ref:"draggable",attrs:{tag:"tbody",type:"mapping",targetDataKey:"mappable",disabled:!t.mappingEnabled},on:{dragstart:t.onCellDragStart,dragend:t.onCellDragEnd},scopedSlots:t._u([{key:"preview",fn:function({canDrop:s,el:n}){return[a("MappingPill",{attrs:{html:t.shorten(t.getPathNameFromTarget(n)||"",16,2),"can-drop":s}})]}}])},[t._l(t.tableData.data,function(s,n){return a("tr",{key:n,class:{[t.$style.hoveringRow]:t.isHoveringRow(n)},attrs:{"data-test-id":t.isHoveringRow(n)?"hovering-item":void 0}},[t._l(s,function(r,o){return a("td",{key:o,class:t.hasJsonInColumn(o)?t.$style.minColWidth:t.$style.limitColWidth,attrs:{"data-row":n,"data-col":o},on:{mouseenter:t.onMouseEnterCell,mouseleave:t.onMouseLeaveCell}},[t.isSimple(r)?a("span",{staticClass:"ph-no-capture",class:{[t.$style.value]:!0,[t.$style.empty]:t.isEmpty(r)}},[t._v(t._s(t.getValueToRender(r)))]):a("n8n-tree",{attrs:{nodeClass:t.$style.nodeClass,value:r},scopedSlots:t._u([{key:"label",fn:function({label:l,path:p}){return[a("span",{class:{[t.$style.hoveringKey]:t.mappingEnabled&&t.isHovering(p,o),[t.$style.draggingKey]:t.isDraggingKey(p,o),[t.$style.dataKey]:!0,[t.$style.mappable]:t.mappingEnabled},attrs:{"data-target":"mappable","data-name":t.getCellPathName(p,o),"data-value":t.getCellExpression(p,o),"data-depth":p.length},on:{mouseenter:()=>t.onMouseEnterKey(p,o),mouseleave:t.onMouseLeaveKey}},[t._v(t._s(l||t.$locale.baseText("runData.unnamedField")))])]}},{key:"value",fn:function({value:l}){return[a("span",{staticClass:"ph-no-capture",class:{[t.$style.nestedValue]:!0,[t.$style.empty]:t.isEmpty(l)}},[t._v(t._s(t.getValueToRender(l)))])]}}],null,!0)})],1)}),t.columnLimitExceeded?a("td"):t._e(),a("td",{class:t.$style.tableRightMargin})],2)})],2)],1)])},U=[];const m={$style:J};function q(e){for(var t in m)this[t]=m[t]}var X=f(w,G,U,!1,q,null,null,null);const Nt=X.exports;export{Nt as default};
//# sourceMappingURL=RunDataTable-eb563a78.js.map
