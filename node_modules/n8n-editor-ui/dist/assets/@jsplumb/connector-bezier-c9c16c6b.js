import{e as A,l as X,t as Y}from"./util-79bcf4d9.js";import{V,W as J,X as Z}from"./core-75ba1e73.js";import{A as j}from"./common-fe415eb9.js";function z(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function D(n,r){for(var o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function B(n,r,o){return r&&D(n.prototype,r),o&&D(n,o),n}function v(n,r,o){return r in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,n}function O(n,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(r&&r.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),r&&S(n,r)}function L(n){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},L(n)}function S(n,r){return S=Object.setPrototypeOf||function(i,t){return i.__proto__=t,i},S(n,r)}function d(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function P(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function E(n,r){return r&&(typeof r=="object"||typeof r=="function")?r:P(n)}function R(n){var r=d();return function(){var i=L(n),t;if(r){var e=L(this).constructor;t=Reflect.construct(i,arguments,e)}else t=i.apply(this,arguments);return E(this,t)}}var Q=function(n){O(o,n);var r=R(o);function o(i,t){var e;return z(this,o),e=r.call(this,i,t),e.connection=i,v(P(e),"showLoopback",void 0),v(P(e),"curviness",void 0),v(P(e),"margin",void 0),v(P(e),"proximityLimit",void 0),v(P(e),"orientation",void 0),v(P(e),"loopbackRadius",void 0),v(P(e),"clockwise",void 0),v(P(e),"isLoopbackCurrently",void 0),v(P(e),"geometry",null),t=t||{},e.showLoopback=t.showLoopback!==!1,e.curviness=t.curviness||10,e.margin=t.margin||5,e.proximityLimit=t.proximityLimit||80,e.clockwise=t.orientation&&t.orientation==="clockwise",e.loopbackRadius=t.loopbackRadius||25,e.isLoopbackCurrently=!1,e}return B(o,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(t,e){var u=e.sourcePos,c=e.targetPos,a=Math.abs(u.curX-c.curX),f=Math.abs(u.curY-c.curY);if(!this.showLoopback||e.sourceEndpoint.elementId!==e.targetEndpoint.elementId)this.isLoopbackCurrently=!1,this._computeBezier(t,e,u,c,a,f);else{this.isLoopbackCurrently=!0;var s=e.sourcePos.curX,l=e.sourcePos.curY-this.margin,y=s,h=l-this.loopbackRadius,x=y-this.loopbackRadius,p=h-this.loopbackRadius;a=2*this.loopbackRadius,f=2*this.loopbackRadius,t.points[0]=x,t.points[1]=p,t.points[2]=a,t.points[3]=f,this._addSegment(J,{loopback:!0,x1:s-x+4,y1:l-p,startAngle:0,endAngle:2*Math.PI,r:this.loopbackRadius,ac:!this.clockwise,x2:s-x-4,y2:l-p,cx:y-x,cy:h-p})}}},{key:"exportGeometry",value:function(){return this.geometry==null?null:{controlPoints:[A({},this.geometry.controlPoints[0]),A({},this.geometry.controlPoints[1])],source:A({},this.geometry.source),target:A({},this.geometry.target)}}},{key:"transformGeometry",value:function(t,e,u){return{controlPoints:[{x:t.controlPoints[0].x+e,y:t.controlPoints[0].y+u},{x:t.controlPoints[1].x+e,y:t.controlPoints[1].y+u}],source:this.transformAnchorPlacement(t.source,e,u),target:this.transformAnchorPlacement(t.target,e,u)}}},{key:"importGeometry",value:function(t){return t!=null?t.controlPoints==null||t.controlPoints.length!=2?(X("jsPlumb Bezier: cannot import geometry; controlPoints missing or does not have length 2"),this.setGeometry(null,!0),!1):t.controlPoints[0].x==null||t.controlPoints[0].y==null||t.controlPoints[1].x==null||t.controlPoints[1].y==null?(X("jsPlumb Bezier: cannot import geometry; controlPoints malformed"),this.setGeometry(null,!0),!1):t.source==null||t.source.curX==null||t.source.curY==null?(X("jsPlumb Bezier: cannot import geometry; source missing or malformed"),this.setGeometry(null,!0),!1):t.target==null||t.target.curX==null||t.target.curY==null?(X("jsPlumb Bezier: cannot import geometry; target missing or malformed"),this.setGeometry(null,!0),!1):(this.setGeometry(t,!1),!0):!1}}]),o}(Z),g={subtract:function(r,o){return{x:r.x-o.x,y:r.y-o.y}},dotProduct:function(r,o){return r.x*o.x+r.y*o.y},square:function(r){return Math.sqrt(r.x*r.x+r.y*r.y)},scale:function(r,o){return{x:r.x*o,y:r.y*o}}},U=64,tt=Math.pow(2,-U-1);function nt(n,r){for(var o=[],i=et(n,r),t=r.length-1,e=2*t-1,u=q(i,e,o,0),c=g.subtract(n,r[0]),a=g.square(c),f=0,s,l=0;l<u;l++)c=g.subtract(n,G(r,t,o[l],null,null)),s=g.square(c),s<a&&(a=s,f=o[l]);return c=g.subtract(n,r[t]),s=g.square(c),s<a&&(a=s,f=1),{location:f,distance:a}}function rt(n,r){var o=nt(n,r);return{point:G(r,r.length-1,o.location,null,null),location:o.location}}function et(n,r){for(var o=r.length-1,i=2*o-1,t=[],e=[],u=[],c=[],a=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],f=0;f<=o;f++)t[f]=g.subtract(r[f],n);for(var s=0;s<=o-1;s++)e[s]=g.subtract(r[s+1],r[s]),e[s]=g.scale(e[s],3);for(var l=0;l<=o-1;l++)for(var y=0;y<=o;y++)u[l]||(u[l]=[]),u[l][y]=g.dotProduct(e[l],t[y]);for(var h=0;h<=i;h++)c[h]||(c[h]=[]),c[h].y=0,c[h].x=parseFloat(""+h)/i;for(var x=o,p=o-1,m=0;m<=x+p;m++)for(var M=Math.max(0,m-p),k=Math.min(m,x),b=M;b<=k;b++){var _=m-b;c[b+_].y+=u[_][b]*a[_][b]}return c}function q(n,r,o,i){var t=[],e=[],u,c,a=[],f=[];switch(ot(n,r)){case 0:return 0;case 1:{if(i>=U)return o[0]=(n[0].x+n[r].x)/2,1;if(it(n,r))return o[0]=ut(n,r),1;break}}G(n,r,.5,t,e),u=q(t,r,a,i+1),c=q(e,r,f,i+1);for(var s=0;s<u;s++)o[s]=a[s];for(var l=0;l<c;l++)o[l+u]=f[l];return u+c}function ot(n,r){var o=0,i,t;i=t=Y(n[0].y);for(var e=1;e<=r;e++)i=Y(n[e].y),i!=t&&o++,t=i;return o}function it(n,r){var o,i,t,e,u,c,a,f,s,l,y,h,x,p,m,M;c=n[0].y-n[r].y,a=n[r].x-n[0].x,f=n[0].x*n[r].y-n[r].x*n[0].y;var k,b;k=b=0;for(var _=1;_<r;_++){var C=c*n[_].x+a*n[_].y+f;C>k?k=C:C<b&&(b=C)}return y=0,h=1,x=0,p=c,m=a,M=f-k,s=y*m-p*h,l=1/s,i=(h*M-m*x)*l,p=c,m=a,M=f-b,s=y*m-p*h,l=1/s,t=(h*M-m*x)*l,e=Math.min(i,t),u=Math.max(i,t),o=u-e,o<tt?1:0}function ut(n,r){var o=1,i=0,t=n[r].x-n[0].x,e=n[r].y-n[0].y,u=n[0].x-0,c=n[0].y-0,a=t*i-e*o,f=1/a,s=(t*c-e*u)*f;return 0+o*s}function G(n,r,o,i,t){for(var e=[[]],u=0;u<=r;u++)e[0][u]=n[u];for(var c=1;c<=r;c++)for(var a=0;a<=r-c;a++)e[c]||(e[c]=[]),e[c][a]||(e[c][a]={}),e[c][a].x=(1-o)*e[c-1][a].x+o*e[c-1][a+1].x,e[c][a].y=(1-o)*e[c-1][a].y+o*e[c-1][a+1].y;if(i!=null)for(var f=0;f<=r;f++)i[f]=e[f][0];if(t!=null)for(var s=0;s<=r;s++)t[s]=e[r-s][s];return e[r][0]}function ct(n,r){var o=[];n--;for(var i=0;i<=n;i++)o.push(at(i/n,r));return o}function at(n,r){var o={x:0,y:0};if(n===0)return r[0];var i=r.length-1;if(n===1)return r[i];var t=r,e=1-n;if(i===0)return r[0];if(i===1)return{x:e*t[0].x+n*t[1].x,y:e*t[0].y+n*t[1].y};if(4>i){var u=e*e,c=n*n,a=0,f,s,l;return i===2?(t=[t[0],t[1],t[2],o],f=u,s=2*(e*n),l=c):i===3&&(f=u*e,s=3*(u*n),l=3*(e*c),a=n*c),{x:f*t[0].x+s*t[1].x+l*t[2].x+a*t[3].x,y:f*t[0].y+s*t[1].y+l*t[2].y+a*t[3].y}}else return o}function st(n){var r=0;if(!$(n))for(var o=16,i=ct(o,n),t=0;t<o-1;t++){var e=i[t],u=i[t+1];r+=W(e,u)}return r}var N=new Map;function lt(n){var r=N.get(n);if(!r){r=[];var o=function(){return function(h){return Math.pow(h,n)}},i=function(){return function(h){return Math.pow(1-h,n)}},t=function(h){return function(x){return h}},e=function(){return function(h){return h}},u=function(){return function(h){return 1-h}},c=function(h){return function(x){for(var p=1,m=0;m<h.length;m++)p=p*h[m](x);return p}};r.push(o());for(var a=1;a<n;a++){for(var f=[t(n)],s=0;s<n-a;s++)f.push(e());for(var l=0;l<a;l++)f.push(u());r.push(c(f))}r.push(i()),N.set(n,r)}return r}function w(n,r){for(var o=lt(n.length-1),i=0,t=0,e=0;e<n.length;e++)i=i+n[e].x*o[e](r),t=t+n[e].y*o[e](r);return{x:i,y:t}}function W(n,r){return Math.sqrt(Math.pow(n.x-r.x,2)+Math.pow(n.y-r.y,2))}function $(n){return n[0].x===n[1].x&&n[0].y===n[1].y}function H(n,r,o){if($(n))return{point:n[0],location:r};for(var i=w(n,r),t=0,e=r,u=o>0?1:-1,c=null;t<Math.abs(o);)e+=.005*u,c=w(n,e),t+=W(c,i),i=c;return{point:c,location:e}}function ft(n,r,o){return H(n,r,o).point}function ht(n,r,o){return H(n,r,o).location}function yt(n,r){var o=w(n,r),i=w(n.slice(0,n.length-1),r),t=i.y-o.y,e=i.x-o.x;return t===0?1/0:Math.atan(t/e)}function xt(n,r,o,i,t){var e=i-r,u=n-o,c=n*(r-i)+r*(o-n),a=pt(t),f=[e*a[0][0]+u*a[1][0],e*a[0][1]+u*a[1][1],e*a[0][2]+u*a[1][2],e*a[0][3]+u*a[1][3]+c],s=vt.apply(null,f),l=[];if(s!=null)for(var y=0;y<3;y++){var h=s[y],x=Math.pow(h,2),p=Math.pow(h,3),m={x:a[0][0]*p+a[0][1]*x+a[0][2]*h+a[0][3],y:a[1][0]*p+a[1][1]*x+a[1][2]*h+a[1][3]},M=void 0;o-n!==0?M=(m[0]-n)/(o-n):M=(m[1]-r)/(i-r),h>=0&&h<=1&&M>=0&&M<=1&&l.push(m)}return l}function K(n,r){return[-n[0][r]+3*n[1][r]+-3*n[2][r]+n[3][r],3*n[0][r]-6*n[1][r]+3*n[2][r],-3*n[0][r]+3*n[1][r],n[0][r]]}function pt(n){return[K(n,"x"),K(n,"y")]}function vt(n,r,o,i){var t=r/n,e=o/n,u=i/n,c=(3*e-Math.pow(t,2))/9,a=(9*t*e-27*u-2*Math.pow(t,3))/54,f=Math.pow(c,3)+Math.pow(a,2),s,l,y=[0,0,0];if(f>=0)s=Y(a+Math.sqrt(f))*Math.pow(Math.abs(a+Math.sqrt(f)),1/3),l=Y(a-Math.sqrt(f))*Math.pow(Math.abs(a-Math.sqrt(f)),1/3),y[0]=-t/3+(s+l),y[1]=-t/3-(s+l)/2,y[2]=-t/3-(s+l)/2,Math.abs(Math.sqrt(3)*(s-l)/2)!==0&&(y[1]=-1,y[2]=-1);else{var h=Math.acos(a/Math.sqrt(-Math.pow(c,3)));y[0]=2*Math.sqrt(-c)*Math.cos(h/3)-t/3,y[1]=2*Math.sqrt(-c)*Math.cos((h+2*Math.PI)/3)-t/3,y[2]=2*Math.sqrt(-c)*Math.cos((h+4*Math.PI)/3)-t/3}for(var x=0;x<3;x++)(y[x]<0||y[x]>1)&&(y[x]=-1);return y}var I=function(n){O(o,n);var r=R(o);function o(i){var t;return z(this,o),t=r.call(this,i),v(P(t),"curve",void 0),v(P(t),"cp1x",void 0),v(P(t),"cp1y",void 0),v(P(t),"cp2x",void 0),v(P(t),"cp2y",void 0),v(P(t),"length",0),v(P(t),"type",o.segmentType),t.cp1x=i.cp1x,t.cp1y=i.cp1y,t.cp2x=i.cp2x,t.cp2y=i.cp2y,t.x1=i.x1,t.x2=i.x2,t.y1=i.y1,t.y2=i.y2,t.curve=[{x:t.x1,y:t.y1},{x:t.cp1x,y:t.cp1y},{x:t.cp2x,y:t.cp2y},{x:t.x2,y:t.y2}],t.extents={xmin:Math.min(t.x1,t.x2,t.cp1x,t.cp2x),ymin:Math.min(t.y1,t.y2,t.cp1y,t.cp2y),xmax:Math.max(t.x1,t.x2,t.cp1x,t.cp2x),ymax:Math.max(t.y1,t.y2,t.cp1y,t.cp2y)},t}return B(o,[{key:"getPath",value:function(t){return(t?"M "+this.x2+" "+this.y2+" ":"")+"C "+this.cp2x+" "+this.cp2y+" "+this.cp1x+" "+this.cp1y+" "+this.x1+" "+this.y1}},{key:"pointOnPath",value:function(t,e){return t=o._translateLocation(this.curve,t,e),w(this.curve,t)}},{key:"gradientAtPoint",value:function(t,e){return t=o._translateLocation(this.curve,t,e),yt(this.curve,t)}},{key:"pointAlongPathFrom",value:function(t,e,u){return t=o._translateLocation(this.curve,t,u),ft(this.curve,t,e)}},{key:"getLength",value:function(){return(this.length==null||this.length===0)&&(this.length=st(this.curve)),this.length}},{key:"findClosestPointOnPath",value:function(t,e){var u=rt({x:t,y:e},this.curve);return{d:Math.sqrt(Math.pow(u.point.x-t,2)+Math.pow(u.point.y-e,2)),x:u.point.x,y:u.point.y,l:1-u.location,s:this,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(t,e,u,c){return xt(t,e,u,c,this.curve)}}],[{key:"_translateLocation",value:function(t,e,u){return u&&(e=ht(t,e>0?0:1,e)),e}}]),o}(j);v(I,"segmentType","Bezier");var T=function(n){O(o,n);var r=R(o);function o(i,t){var e;return z(this,o),e=r.call(this,i,t),e.connection=i,v(P(e),"type",o.type),v(P(e),"majorAnchor",void 0),v(P(e),"minorAnchor",void 0),t=t||{},e.majorAnchor=t.curviness||150,e.minorAnchor=10,e}return B(o,[{key:"getCurviness",value:function(){return this.majorAnchor}},{key:"_findControlPoint",value:function(t,e,u,c,a){var f=c[0]!==a[0]||c[1]===a[1],s={x:0,y:0};return f?(a[0]===0?s.x=u.curX<e.curX?t.x+this.minorAnchor:t.x-this.minorAnchor:s.x=t.x+this.majorAnchor*a[0],a[1]===0?s.y=u.curY<e.curY?t.y+this.minorAnchor:t.y-this.minorAnchor:s.y=t.y+this.majorAnchor*c[1]):(c[0]===0?s.x=e.curX<u.curX?t.x+this.minorAnchor:t.x-this.minorAnchor:s.x=t.x-this.majorAnchor*c[0],c[1]===0?s.y=e.curY<u.curY?t.y+this.minorAnchor:t.y-this.minorAnchor:s.y=t.y+this.majorAnchor*a[1]),s}},{key:"_computeBezier",value:function(t,e,u,c,a,f){var s,l,y=u.curX<c.curX?a:0,h=u.curY<c.curY?f:0,x=u.curX<c.curX?0:a,p=u.curY<c.curY?0:f;this.edited!==!0?(s=this._findControlPoint({x:y,y:h},u,c,t.so,t.to),l=this._findControlPoint({x,y:p},c,u,t.to,t.so)):(s=this.geometry.controlPoints[0],l=this.geometry.controlPoints[1]),this.geometry={controlPoints:[s,l],source:e.sourcePos,target:e.targetPos},this._addSegment(I,{x1:y,y1:h,x2:x,y2:p,cp1x:s.x,cp1y:s.y,cp2x:l.x,cp2y:l.y})}}]),o}(Q);v(T,"type","Bezier");function mt(n,r,o,i){return n<=o&&i<=r?1:n<=o&&r<=i?2:o<=n&&i>=r?3:4}function Pt(n,r,o,i,t,e,u,c,a){if(c<=a)return{x:n,y:r};if(o===1)return i.curY<=0&&t.curY>=1?{x:n+(i.x<.5?-1*e:e),y:r}:i.curX>=1&&t.curX<=0?{x:n,y:r+(i.y<.5?-1*u:u)}:{x:n+-1*e,y:r+-1*u};if(o===2)return i.curY>=1&&t.curY<=0?{x:n+(i.x<.5?-1*e:e),y:r}:i.curX>=1&&t.curX<=0?{x:n,y:r+(i.y<.5?-1*u:u)}:{x:n+e,y:r+-1*u};if(o===3)return i.curY>=1&&t.curY<=0?{x:n+(i.x<.5?-1*e:e),y:r}:i.curX<=0&&t.curX>=1?{x:n,y:r+(i.y<.5?-1*u:u)}:{x:n+-1*e,y:r+-1*u};if(o===4)return i.curY<=0&&t.curY>=1?{x:n+(i.x<.5?-1*e:e),y:r}:i.curX<=0&&t.curX>=1?{x:n,y:r+(i.y<.5?-1*u:u)}:{x:n+e,y:r+-1*u}}var F=function(n){O(o,n);var r=R(o);function o(i,t){var e;return z(this,o),e=r.call(this,i,t),e.connection=i,v(P(e),"type",o.type),v(P(e),"_controlPoint",void 0),e.curviness=t.curviness||10,e.margin=t.margin||5,e.proximityLimit=t.proximityLimit||80,e.clockwise=t.orientation&&t.orientation==="clockwise",e}return B(o,[{key:"_computeBezier",value:function(t,e,u,c,a,f){var s=u.curX<c.curX?0:a,l=u.curY<c.curY?0:f,y=u.curX<c.curX?a:0,h=u.curY<c.curY?f:0;if(u.x===0&&(s-=this.margin),u.x===1&&(s+=this.margin),u.y===0&&(l-=this.margin),u.y===1&&(l+=this.margin),c.x===0&&(y-=this.margin),c.x===1&&(y+=this.margin),c.y===0&&(h-=this.margin),c.y===1&&(h+=this.margin),this.edited!==!0){var x=(s+y)/2,p=(l+h)/2,m=mt(s,l,y,h),M=Math.sqrt(Math.pow(y-s,2)+Math.pow(h-l,2));this._controlPoint=Pt(x,p,m,e.sourcePos,e.targetPos,this.curviness,this.curviness,M,this.proximityLimit)}else this._controlPoint=this.geometry.controlPoints[0];var k,b,_,C;k=this._controlPoint.x,b=this._controlPoint.x,_=this._controlPoint.y,C=this._controlPoint.y,this.geometry={controlPoints:[this._controlPoint,this._controlPoint],source:e.sourcePos,target:e.targetPos},this._addSegment(I,{x1:y,y1:h,x2:s,y2:l,cp1x:k,cp1y:_,cp2x:b,cp2y:C})}}]),o}(Q);v(F,"type","StateMachine");V.register(T.type,T);V.register(F.type,F);export{I as B};
//# sourceMappingURL=connector-bezier-c9c16c6b.js.map
