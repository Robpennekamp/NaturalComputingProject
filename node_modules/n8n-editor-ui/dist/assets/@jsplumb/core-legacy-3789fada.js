System.register(["./util-legacy-b5c07987.js","./common-legacy-1cf8cb8a.js"],(function(e,t){"use strict";var n,i,o,s,r,a,l,c,u,h,d,p,y,v,f,g,m,x,k,_,C,b,E,S,P,w,A,I,T,O,M,G,L,D,F,j,B,R,V;return{setters:[e=>{n=e.l,i=e.v,o=e.x,s=e.y,r=e.z,a=e.u,l=e.E,c=e.n,u=e.A,h=e.e,d=e.i,p=e.j,y=e.m,v=e.p,f=e.g,g=e.r,m=e.B,x=e.f,k=e.C,_=e.a,C=e.D,b=e.h,E=e.F,S=e.T,P=e.G,w=e.H,A=e.I,I=e.J,T=e.K,O=e.L,M=e.M,G=e.N,L=e.O},e=>{D=e.P,F=e.E,j=e.A,B=e.D,R=e.a,V=e.W}],execute:function(){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function U(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function H(e,t,n){return t&&U(e.prototype,t),n&&U(e,n),e}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}function Y(e){return Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Y(e)}function z(e,t){return z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},z(e,t)}function N(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?N(e):t}function J(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Y(e);if(t){var o=Y(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return q(this,n)}}function K(e,t,n){return K="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Y(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}},K(e,t,n||e)}function Z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,s=[],r=!0,a=!1;try{for(n=n.call(e);!(r=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);r=!0);}catch(l){a=!0,o=l}finally{try{r||null==n.return||n.return()}finally{if(a)throw o}}return s}}(e,t)||Q(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(e){return function(e){if(Array.isArray(e))return ee(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Q(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){if(e){if("string"==typeof e)return ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ee(e,t):void 0}}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}e({D:function(e){return e.type===En.type},G:function(e){return e.type===bn.type},U:function(e,t,n){return new gt(e,t,n)},a:ge,c:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return"."+e})).join(",")},o:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join(" ")},x:function(e){return e.type===Ke.type},y:function(e){return e.type===Sn.type},z:function(e){return e.type===Cn.type}});var te={},ne={},ie={},oe=e("a1",{get:function(e,t,n){var i=te[t];if(i)return new i(e,n);throw{message:"jsPlumb: unknown endpoint type '"+t+"'"}},clone:function(e){var t=ie[e.type];return oe.get(e.endpoint,e.type,t.getParams(e))},compute:function(e,t,i,o){var s=ne[e.type];if(null!=s)return s(e,t,i,o);n("jsPlumb: cannot find endpoint calculator for endpoint of type ",e.type)},registerHandler:function(e){ie[e.type]=e,te[e.type]=e.cls,ne[e.type]=e.compute}}),se=e("H",function(){function e(n,i){t(this,e),this.endpoint=n,W(this,"typeId",void 0),W(this,"x",void 0),W(this,"y",void 0),W(this,"w",void 0),W(this,"h",void 0),W(this,"computedValue",void 0),W(this,"bounds",F()),W(this,"classes",[]),W(this,"instance",void 0),W(this,"type",void 0),i=i||{},this.instance=n.instance,n.cssClass&&this.classes.push(n.cssClass),i.cssClass&&this.classes.push(i.cssClass)}return H(e,[{key:"addClass",value:function(e){this.classes.push(e),this.instance.addEndpointClass(this.endpoint,e)}},{key:"removeClass",value:function(e){this.classes=this.classes.filter((function(t){return t!==e})),this.instance.removeEndpointClass(this.endpoint,e)}},{key:"compute",value:function(e,t,n){this.computedValue=oe.compute(this,e,t,n),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(e){this.instance.setEndpointVisible(this.endpoint,e)}}]),e}()),re=e("L",function(e){X(i,e);var n=J(i);function i(e,o){var s;return t(this,i),W(N(s=n.call(this,e,o)),"radius",void 0),W(N(s),"defaultOffset",void 0),W(N(s),"defaultInnerRadius",void 0),W(N(s),"type",i.type),o=o||{},s.radius=o.radius||5,s.defaultOffset=.5*s.radius,s.defaultInnerRadius=s.radius/3,s}return i}(se));W(re,"type","Dot");var ae={type:re.type,cls:re,compute:function(e,t,n,i){var o=t.curX-e.radius,s=t.curY-e.radius,r=2*e.radius,a=2*e.radius;if(i&&i.stroke){var l=i.strokeWidth||1;o-=l,s-=l,r+=2*l,a+=2*l}return e.x=o,e.y=s,e.w=r,e.h=a,[o,s,r,a,e.radius]},getParams:function(e){return{radius:e.radius}}},le=e("P",function(e){X(i,e);var n=J(i);function i(e,o){var s;return t(this,i),W(N(s=n.call(this,e,o)),"type",i.type),s}return i}(se));W(le,"type","Blank");var ce={type:le.type,cls:le,compute:function(e,t,n,i){return e.x=t.curX,e.y=t.curY,e.w=10,e.h=0,[t.curX,t.curY,10,0]},getParams:function(e){return{}}},ue=e("M",function(e){X(i,e);var n=J(i);function i(e,o){var s;return t(this,i),W(N(s=n.call(this,e,o)),"width",void 0),W(N(s),"height",void 0),W(N(s),"type",i.type),o=o||{},s.width=o.width||10,s.height=o.height||10,s}return H(i,null,[{key:"_getParams",value:function(e){return{width:e.width,height:e.height}}}]),i}(se));W(ue,"type","Rectangle");var he={type:ue.type,cls:ue,compute:function(e,t,n,i){var o=i.width||e.width,s=i.height||e.height,r=t.curX-o/2,a=t.curY-s/2;return e.x=r,e.y=a,e.w=o,e.h=s,[r,a,o,s]},getParams:function(e){return{width:e.width,height:e.height}}},de=e("X",function(){function e(n,i){t(this,e),this.connection=n,W(this,"type",void 0),W(this,"edited",!1),W(this,"stub",void 0),W(this,"sourceStub",void 0),W(this,"targetStub",void 0),W(this,"maxStub",void 0),W(this,"typeId",void 0),W(this,"gap",void 0),W(this,"sourceGap",void 0),W(this,"targetGap",void 0),W(this,"segments",[]),W(this,"totalLength",0),W(this,"segmentProportions",[]),W(this,"segmentProportionalLengths",[]),W(this,"paintInfo",null),W(this,"strokeWidth",void 0),W(this,"x",void 0),W(this,"y",void 0),W(this,"w",void 0),W(this,"h",void 0),W(this,"segment",void 0),W(this,"bounds",F()),W(this,"cssClass",void 0),W(this,"hoverClass",void 0),W(this,"geometry",void 0),this.stub=i.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=i.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=i.cssClass||"",this.hoverClass=i.hoverClass||""}return H(e,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(e,t){this.geometry=e,this.edited=null!=e&&!t}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(e){return this.geometry=e,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function(e,t,n){return{x:e.x,y:e.y,ox:e.ox,oy:e.oy,curX:e.curX+t,curY:e.curY+n}}},{key:"resetBounds",value:function(){this.bounds=F()}},{key:"findSegmentForPoint",value:function(e,t){for(var n={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},i=0;i<this.segments.length;i++){var o=this.segments[i].findClosestPointOnPath(e,t);o.d<n.d&&(n.d=o.d,n.l=o.l,n.x=o.x,n.y=o.y,n.s=this.segments[i],n.x1=o.x1,n.x2=o.x2,n.y1=o.y1,n.y2=o.y2,n.index=i,n.connectorLocation=this.segmentProportions[i][0]+o.l*(this.segmentProportions[i][1]-this.segmentProportions[i][0]))}return n}},{key:"lineIntersection",value:function(e,t,n,i){for(var o=[],s=0;s<this.segments.length;s++)o.push.apply(o,this.segments[s].lineIntersection(e,t,n,i));return o}},{key:"boxIntersection",value:function(e,t,n,i){for(var o=[],s=0;s<this.segments.length;s++)o.push.apply(o,this.segments[s].boxIntersection(e,t,n,i));return o}},{key:"boundingBoxIntersection",value:function(e){for(var t=[],n=0;n<this.segments.length;n++)t.push.apply(t,this.segments[n].boundingBoxIntersection(e));return t}},{key:"_updateSegmentProportions",value:function(){for(var e=0,t=0;t<this.segments.length;t++){var n=this.segments[t].getLength();this.segmentProportionalLengths[t]=n/this.totalLength,this.segmentProportions[t]=[e,e+=n/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(e,t){var n,i,o;if(t&&(e=e>0?e/this.totalLength:(this.totalLength+e)/this.totalLength),1===e)n=this.segments.length-1,o=1;else if(0===e)o=0,n=0;else if(e>=.5){for(n=0,o=0,i=this.segmentProportions.length-1;i>-1;i--)if(this.segmentProportions[i][1]>=e&&this.segmentProportions[i][0]<=e){n=i,o=(e-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}}else for(n=this.segmentProportions.length-1,o=1,i=0;i<this.segmentProportions.length;i++)if(this.segmentProportions[i][1]>=e){n=i,o=(e-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}return{segment:this.segments[n],proportion:o,index:n}}},{key:"_addSegment",value:function(e,t){if(t.x1!==t.x2||t.y1!==t.y2){var n=new e(t);this.segments.push(n),this.totalLength+=n.getLength(),this.updateBounds(n)}}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(e){this.strokeWidth=e.strokeWidth;var t=e.sourcePos.curX,n=e.targetPos.curX,o=e.sourcePos.curY,s=e.targetPos.curY,r=i({x:t,y:o},{x:n,y:s}),a=n<t,l=s<o,c=[e.sourcePos.ox,e.sourcePos.oy],u=[e.targetPos.ox,e.targetPos.oy],h=a?n:t,d=l?s:o,p=Math.abs(n-t),y=Math.abs(s-o),v=0===c[0]&&0===c[1],f=0===u[0]&&0===u[1];if(v||f){var g=p>y?0:1,m=[1,0][g],x=0===g?t:o,k=0===g?n:s;v&&(c[g]=x>k?-1:1,c[m]=0),f&&(u[g]=x>k?1:-1,u[m]=0)}var _=a?p+this.sourceGap*c[0]:this.sourceGap*c[0],C=l?y+this.sourceGap*c[1]:this.sourceGap*c[1],b=a?this.targetGap*u[0]:p+this.targetGap*u[0],E=l?this.targetGap*u[1]:y+this.targetGap*u[1],S=c[0]*u[0]+c[1]*u[1],P={sx:_,sy:C,tx:b,ty:E,xSpan:Math.abs(b-_),ySpan:Math.abs(E-C),mx:(_+b)/2,my:(C+E)/2,so:c,to:u,x:h,y:d,w:p,h:y,segment:r,startStubX:_+c[0]*this.sourceStub,startStubY:C+c[1]*this.sourceStub,endStubX:b+u[0]*this.targetStub,endStubY:E+u[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(_-b)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(C-E)>this.sourceStub+this.targetStub,opposite:-1===S,perpendicular:0===S,orthogonal:1===S,sourceAxis:0===c[0]?"y":"x",points:[h,d,p,y,_,C,b,E],stubs:[this.sourceStub,this.targetStub]};return P.anchorOrientation=P.opposite?"opposite":P.orthogonal?"orthogonal":"perpendicular",P}},{key:"updateBounds",value:function(e){var t=e.extents;this.bounds.xmin=Math.min(this.bounds.xmin,t.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,t.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,t.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,t.ymax)}},{key:"dumpSegmentsToConsole",value:function(){n("SEGMENTS:");for(var e=0;e<this.segments.length;e++)n(this.segments[e].type,""+this.segments[e].getLength(),""+this.segmentProportions[e])}},{key:"pointOnPath",value:function(e,t){var n=this._findSegmentForLocation(e,t);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(e,t){var n=this._findSegmentForLocation(e,t);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(e,t,n){var i=this._findSegmentForLocation(e,n);return i.segment&&i.segment.pointAlongPathFrom(i.proportion,t,!1)||{x:0,y:0}}},{key:"compute",value:function(e){this.paintInfo=this._prepareCompute(e),this._clearSegments(),this._compute(this.paintInfo,e),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(e,t){}}]),e}()),pe=e("a0",function(e){X(i,e);var n=J(i);function i(e){var o;return t(this,i),W(N(o=n.call(this,e)),"length",void 0),W(N(o),"m",void 0),W(N(o),"m2",void 0),W(N(o),"type",i.segmentType),o._setCoordinates({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}),o}return H(i,[{key:"getPath",value:function(e){return(e?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=o({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(e){this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this._recalc()}},{key:"pointOnPath",value:function(e,t){if(0!==e||t){if(1!==e||t){var n=t?e>0?e:this.length+e:e*this.length;return s({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},n)}return{x:this.x2,y:this.y2}}return{x:this.x1,y:this.y1}}},{key:"gradientAtPoint",value:function(e,t){return this.m}},{key:"pointAlongPathFrom",value:function(e,t,n){var i=this.pointOnPath(e,n),o=t<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return t<=0&&Math.abs(t)>1&&(t*=-1),s(i,o,t)}},{key:"within",value:function(e,t,n){return n>=Math.min(e,t)&&n<=Math.max(e,t)}},{key:"closest",value:function(e,t,n){return Math.abs(n-e)<Math.abs(n-t)?e:t}},{key:"findClosestPointOnPath",value:function(e,t){var n={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(0===this.m)n.y=this.y1,n.x=this.within(this.x1,this.x2,e)?e:this.closest(this.x1,this.x2,e);else if(this.m===1/0||this.m===-1/0)n.x=this.x1,n.y=this.within(this.y1,this.y2,t)?t:this.closest(this.y1,this.y2,t);else{var i=this.y1-this.m*this.x1,o=(t-this.m2*e-i)/(this.m-this.m2),s=this.m*o+i;n.x=this.within(this.x1,this.x2,o)?o:this.closest(this.x1,this.x2,o),n.y=this.within(this.y1,this.y2,s)?s:this.closest(this.y1,this.y2,s)}var a=r({x:n.x,y:n.y},{x:this.x1,y:this.y1});return n.d=r({x:e,y:t},n),n.l=a/length,n}},{key:"_pointLiesBetween",value:function(e,t,n){return n>t?t<=e&&e<=n:t>=e&&e>=n}},{key:"lineIntersection",value:function(e,t,n,i){var s=Math.abs(o({x:e,y:t},{x:n,y:i})),r=Math.abs(this.m),a=r===1/0?this.x1:this.y1-r*this.x1,l=[],c=s===1/0?e:t-s*e;if(s!==r)if(s===1/0&&0===r)this._pointLiesBetween(e,this.x1,this.x2)&&this._pointLiesBetween(this.y1,t,i)&&l.push({x:e,y:this.y1});else if(0===s&&r===1/0)this._pointLiesBetween(t,this.y1,this.y2)&&this._pointLiesBetween(this.x1,e,n)&&l.push({x:this.x1,y:t});else{var u,h;s===1/0?(u=e,this._pointLiesBetween(u,this.x1,this.x2)&&(h=r*e+a,this._pointLiesBetween(h,t,i)&&l.push({x:u,y:h}))):0===s?(h=t,this._pointLiesBetween(h,this.y1,this.y2)&&(u=(t-a)/r,this._pointLiesBetween(u,e,n)&&l.push({x:u,y:h}))):(h=r*(u=(c-a)/(r-s))+a,this._pointLiesBetween(u,this.x1,this.x2)&&this._pointLiesBetween(h,this.y1,this.y2)&&l.push({x:u,y:h}))}return l}},{key:"boxIntersection",value:function(e,t,n,i){var o=[];return o.push.apply(o,this.lineIntersection(e,t,e+n,t)),o.push.apply(o,this.lineIntersection(e+n,t,e+n,t+i)),o.push.apply(o,this.lineIntersection(e+n,t+i,e,t+i)),o.push.apply(o,this.lineIntersection(e,t+i,e,t)),o}}]),i}(j));W(pe,"segmentType","Straight");var ye=function(e){X(i,e);var n=J(i);function i(){var e;t(this,i);for(var o=arguments.length,s=new Array(o),r=0;r<o;r++)s[r]=arguments[r];return W(N(e=n.call.apply(n,[this].concat(s))),"type",i.type),e}return H(i,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(e,t){this._addSegment(pe,{x1:e.sx,y1:e.sy,x2:e.startStubX,y2:e.startStubY}),this._addSegment(pe,{x1:e.startStubX,y1:e.startStubY,x2:e.endStubX,y2:e.endStubY}),this._addSegment(pe,{x1:e.endStubX,y1:e.endStubY,x2:e.tx,y2:e.ty}),this.geometry={source:t.sourcePos,target:t.targetPos}}},{key:"transformGeometry",value:function(e,t,n){return{source:this.transformAnchorPlacement(e.source,t,n),target:this.transformAnchorPlacement(e.target,t,n)}}}]),i}(de);W(ye,"type","Straight");var ve={},fe=e("V",{get:function(e,t,n){var i=ve[t];if(i)return new i(e,n);throw{message:"jsPlumb: unknown connector type '"+t+"'"}},register:function(e,t){ve[e]=t}});function ge(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return"["+e+"]"})).join(",")}var me=e("f","source"),xe=e("T","target"),ke=e("B","block"),_e=e("N","none"),Ce=(e("t","absolute"),e("F","fixed"),e("w","static"),e("A","data-jtk-group")),be=e("u","data-jtk-managed"),Ee=(e("e","data-jtk-not-draggable"),e("Q","tabindex"),e("h","data-jtk-scope-"),e("r","checkCondition")),Se=(e("n","checkDropAllowed"),e("C","jtk-connector")),Pe=e("b","jtk-endpoint"),we=e("i","jtk-floating-endpoint"),Ae="jtk-group-collapsed",Ie="jtk-group-expanded",Te=e("d","jtk-overlay"),Oe=e("Z","connection"),Me="internal.connection",Ge=e("$","connection:detach"),Le=e("_","connection:move"),De="internal.endpoint:unregistered",Fe="internal.connection:detached",je="group:member:added",Be=e("p","maxConnections"),Re=e("E","zoom"),Ve=e("q","isDetachAllowed"),Ue=(e("I","beforeDrag"),e("Y","beforeDrop")),He=e("s","beforeDetach"),We=(e("g","beforeStartDetach"),e("S",ge(be))),Xe="paintStyle";function Ye(e){var t=null;return(t=d(e)?{type:e,options:{}}:e).options.id=t.options.id||a(),t}var ze=e("O",function(e){X(i,e);var n=J(i);function i(e,o,s){var r;for(var l in t(this,i),(r=n.call(this)).instance=e,r.component=o,W(N(r),"id",void 0),W(N(r),"type",void 0),W(N(r),"cssClass",void 0),W(N(r),"visible",!0),W(N(r),"location",void 0),W(N(r),"events",void 0),W(N(r),"attributes",void 0),s=s||{},r.id=s.id||a(),r.cssClass=s.cssClass||"",r.setLocation(s.location),r.events=s.events||{},r.attributes=s.attributes||{},r.events)r.bind(l,r.events[l]);return r}return H(i,[{key:"setLocation",value:function(e){var t=null==this.location?.5:this.location;if(null!=e)try{var n="string"==typeof e?parseFloat(e):e;isNaN(n)||(t=n)}catch(i){}this.location=t}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"setVisible",value:function(e){this.visible=e,this.instance.setOverlayVisible(this,e)}},{key:"isVisible",value:function(){return this.visible}}]),i}(l)),Ne={},qe=function(e,t,n,i){var o=Ne[t];if(o)return new o(e,n,i);throw{message:"jsPlumb: unknown overlay type '"+t+"'"}},Je=function(e,t){Ne[e]=t},Ke=function(e){X(i,e);var n=J(i);function i(e,o,s){var r;return t(this,i),(r=n.call(this,e,o,s)).instance=e,r.component=o,W(N(r),"label",void 0),W(N(r),"labelText",void 0),W(N(r),"type",i.type),W(N(r),"cachedDimensions",void 0),s=s||{label:""},r.setLabel(s.label),r}return H(i,[{key:"getLabel",value:function(){return c(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(e){this.label=e,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(e){null!=e.label&&this.setLabel(e.label),null!=e.location&&(this.setLocation(e.location),this.instance.updateLabel(this))}}]),i}(ze);function Ze(e){return null==e?null:e.split(" ").filter((function(e){return null!=e&&e.length>0}))}function $e(e,t,n){for(var i in t)e[i]=n}W(Ke,"type","Label"),Je(Ke.type,Ke);var Qe="__default",et="__label",tt="overlay",nt="remove";function it(e,t){if(e.getDefaultType){var n=e.getTypeDescriptor(),i={},o=e.getDefaultType(),s=h({},o);$e(i,o,Qe),e._types.forEach((function(t){if(t!==Qe){var o=e.instance.getType(t,n);if(null!=o){var r=new Set(["connector","anchor","anchors"]);if("override"===o.mergeStrategy)for(var a in o)r.add(a);s=y(s,o,["cssClass"],I(r)),$e(i,o,t)}}})),t&&(s=T(s,t,"_")),e.applyType(s,i)}}function ot(e,t){var n=e.instance.getType(t,e.getTypeDescriptor());null!=n&&n.cssClass&&e.removeClass(n.cssClass)}function st(e){if(e.paintStyle&&e.hoverPaintStyle){var t={};h(t,e.paintStyle),h(t,e.hoverPaintStyle),e.hoverPaintStyle=t}}var rt,at,lt,ct,ut=function(e){X(o,e);var i=J(o);function o(e,n){var s;if(t(this,o),(s=i.call(this)).instance=e,W(N(s),"defaultLabelLocation",.5),W(N(s),"overlays",{}),W(N(s),"overlayPositions",{}),W(N(s),"overlayPlacements",{}),W(N(s),"clone",void 0),W(N(s),"deleted",void 0),W(N(s),"segment",void 0),W(N(s),"x",void 0),W(N(s),"y",void 0),W(N(s),"w",void 0),W(N(s),"h",void 0),W(N(s),"id",void 0),W(N(s),"visible",!0),W(N(s),"typeId",void 0),W(N(s),"params",{}),W(N(s),"paintStyle",void 0),W(N(s),"hoverPaintStyle",void 0),W(N(s),"paintStyleInUse",void 0),W(N(s),"_hover",!1),W(N(s),"lastPaintedAt",void 0),W(N(s),"data",void 0),W(N(s),"_defaultType",void 0),W(N(s),"events",void 0),W(N(s),"parameters",void 0),W(N(s),"_types",void 0),W(N(s),"_typeCache",void 0),W(N(s),"cssClass",void 0),W(N(s),"hoverClass",void 0),W(N(s),"beforeDetach",void 0),W(N(s),"beforeDrop",void 0),n=n||{},s.cssClass=n.cssClass||"",s.hoverClass=n.hoverClass||e.defaults.hoverClass,s.beforeDetach=n.beforeDetach,s.beforeDrop=n.beforeDrop,s._types=new Set,s._typeCache={},s.parameters=u(n.parameters||{}),s.id=n.id||s.getIdPrefix()+(new Date).getTime(),s._defaultType={parameters:s.parameters,scope:n.scope||s.instance.defaultScope,overlays:{}},n.events)for(var r in n.events)s.bind(r,n.events[r]);s.clone=function(){var t=Object.create(s.constructor.prototype);return s.constructor.apply(t,[e,n]),t},s.overlays={},s.overlayPositions={};var a=n.overlays||[],l={},c=s.getDefaultOverlayKey();if(c){var h=s.instance.defaults[c];h&&a.push.apply(a,$(h));for(var d=0;d<a.length;d++){var p=Ye(a[d]);l[p.options.id]=p}}return s._defaultType.overlays=l,n.label&&(s.getDefaultType().overlays[et]={type:Ke.type,options:{label:n.label,location:n.labelLocation||s.defaultLabelLocation,id:et,cssClass:"jtk-default-label"}}),s}return H(o,[{key:"isDetachAllowed",value:function(e){var t=!0;if(this.beforeDetach)try{t=this.beforeDetach(e)}catch(i){n("jsPlumb: beforeDetach callback failed",i)}return t}},{key:"isDropAllowed",value:function(e,t,i,o,s){var r,a={sourceId:e,targetId:t,scope:i,connection:o,dropEndpoint:s};if(this.beforeDrop)try{r=this.beforeDrop(a)}catch(l){n("jsPlumb: beforeDrop callback failed",l)}else r=this.instance.checkCondition(Ue,a);return r}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(e){for(var t in e)this._defaultType[t]=e[t]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(e,t,n){this._typeCache[n]=this._typeCache[n]||{},this._typeCache[n][e]=t}},{key:"getCachedTypeItem",value:function(e,t){return this._typeCache[t]?this._typeCache[t][e]:null}},{key:"setType",value:function(e,t){this.clearTypes(),(Ze(e)||[]).forEach(this._types.add,this._types),it(this,t)}},{key:"getType",value:function(){return Array.from(this._types.keys())}},{key:"reapplyTypes",value:function(e){it(this,e)}},{key:"hasType",value:function(e){return this._types.has(e)}},{key:"addType",value:function(e,t){var n=Ze(e),i=!1;if(null!=n){for(var o=0,s=n.length;o<s;o++)this._types.has(n[o])||(this._types.add(n[o]),i=!0);i&&it(this,t)}}},{key:"removeType",value:function(e,t){var n,i=this,o=Ze(e),s=!1;if(null!=o){for(var r=0,a=o.length;r<a;r++)n=o[r],s=!!i._types.has(n)&&(ot(i,n),i._types.delete(n),!0)||s;s&&it(this,t)}}},{key:"clearTypes",value:function(e){var t=this;this._types.forEach((function(e){ot(t,e)})),this._types.clear(),it(this,e)}},{key:"toggleType",value:function(e,t){var n=Ze(e);if(null!=n){for(var i=0,o=n.length;i<o;i++)this._types.has(n[i])?(ot(this,n[i]),this._types.delete(n[i])):this._types.add(n[i]);it(this,t)}}},{key:"applyType",value:function(e,t){if(this.setPaintStyle(e.paintStyle),this.setHoverPaintStyle(e.hoverPaintStyle),this.mergeParameters(e.parameters),this.paintStyleInUse=this.getPaintStyle(),e.overlays){var n,i={};for(n in e.overlays){var o=this.overlays[e.overlays[n].options.id];if(o)o.updateFrom(e.overlays[n].options),i[e.overlays[n].options.id]=!0,this.instance.reattachOverlay(o,this);else{var s=this.getCachedTypeItem(tt,e.overlays[n].options.id);null!=s?(this.instance.reattachOverlay(s,this),s.setVisible(!0),s.updateFrom(e.overlays[n].options),this.overlays[s.id]=s):s=this.addOverlay(e.overlays[n]),i[s.id]=!0}}for(n in this.overlays)null==i[this.overlays[n].id]&&this.removeOverlay(this.overlays[n].id,!0)}}},{key:"setPaintStyle",value:function(e){this.paintStyle=e,this.paintStyleInUse=this.paintStyle,st(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(e){this.hoverPaintStyle=e,st(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(e){null!=e&&h(this.parameters,e)}},{key:"setVisible",value:function(e){this.visible=e,e?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(e,t){this.overlayPositions[e.id]=t}},{key:"getAbsoluteOverlayPosition",value:function(e){return this.overlayPositions?this.overlayPositions[e.id]:null}},{key:"_clazzManip",value:function(e,t){for(var n in this.overlays)"add"===e?this.instance.addOverlayClass(this.overlays[n],t):e===nt&&this.instance.removeOverlayClass(this.overlays[n],t)}},{key:"addClass",value:function(e,t){var n=(this.cssClass||"").split(" ");n.push(e),this.cssClass=n.join(" "),this._clazzManip("add",e)}},{key:"removeClass",value:function(e,t){var n=(this.cssClass||"").split(" ");this.cssClass=n.filter((function(t){return t!==e})).join(" "),this._clazzManip(nt,e)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(e){this.data=e||{}}},{key:"mergeData",value:function(e){this.data=h(this.data,e)}},{key:"addOverlay",value:function(e){var t=function(e,t){var n=null;if(d(t))n=qe(e.instance,t,e,{});else if(null!=t.type&&null!=t.options){var i=t,o=h({},i.options);n=qe(e.instance,i.type,e,o)}else n=t;return n.id=n.id||a(),e.cacheTypeItem(tt,n,n.id),e.overlays[n.id]=n,n}(this,e);if(this.getData&&t.type===Ke.type&&!d(e)){var n=this.getData(),i=e.options;if(n){var o=n[i.labelLocationAttribute||"labelLocation"];o&&(t.location=o)}}return t}},{key:"getOverlay",value:function(e){return this.overlays[e]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i in t=t||[],this.overlays)0!==t.length&&-1===t.indexOf(i)||this.overlays[i].setVisible(!1)}},{key:"showOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!0)}},{key:"showOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i in t=t||[],this.overlays)0!==t.length&&-1===t.indexOf(i)||this.overlays[i].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(e,t){var n=this.overlays[e];n&&(n.setVisible(!1),t||this.instance.destroyOverlay(n),delete this.overlays[e],this.overlayPositions&&delete this.overlayPositions[e],this.overlayPlacements&&delete this.overlayPlacements[e])}},{key:"removeOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0,o=t.length;i<o;i++)this.removeOverlay(arguments[i])}},{key:"getLabel",value:function(){var e=this.getLabelOverlay();return null!=e?e.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay(et)}},{key:"setLabel",value:function(e){var t,n,i,o,s=this.getLabelOverlay();if(s)if(d(e)||c(e))s.setLabel(e);else{var r=e;r.label&&s.setLabel(r.label),r.location&&(s.location=r.location)}else{var a=d(e)||c(e)?{label:e}:e;t=this,i={cssClass:(n=a).cssClass,id:et,component:t},o=h(i,n),s=new Ke(t.instance,t,o),this.overlays[et]=s}}}]),o}(l);!function(e){e.top="top",e.left="left",e.right="right",e.bottom="bottom"}(ct||(ct={}));var ht=ct.top,dt=ct.left,pt=ct.right,yt=ct.bottom,vt=[dt,pt],ft=[ht,yt],gt=function(){function e(n,i,o){t(this,e),this.instance=n,this.element=i,W(this,"isFloating",!0),W(this,"isContinuous",void 0),W(this,"isDynamic",void 0),W(this,"locations",[]),W(this,"currentLocation",0),W(this,"locked",!1),W(this,"cssClass",""),W(this,"timestamp",null),W(this,"type","Floating"),W(this,"id",a()),W(this,"orientation",[0,0]),W(this,"size",void 0),this.size=n.viewport.getPosition(o),this.locations.push({x:.5,y:.5,ox:this.orientation[0],oy:this.orientation[1],offx:0,offy:0,iox:this.orientation[0],ioy:this.orientation[1],cls:""})}return H(e,[{key:"_updateOrientationInRouter",value:function(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function(e){this.orientation=this.instance.router.getEndpointOrientation(e),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),e}(),mt=(W(rt={},ht,yt),W(rt,pt,dt),W(rt,dt,pt),W(rt,yt,ht),rt),xt=(W(at={},ht,pt),W(at,pt,yt),W(at,dt,ht),W(at,yt,dt),at),kt=(W(lt={},ht,dt),W(lt,pt,ht),W(lt,dt,yt),W(lt,yt,pt),lt);function _t(e){return 0===e.faces.length?ht:e.faces[0]}function Ct(e,t){return-1!==e.faces.indexOf(t)}function bt(e,t){return null==e.lockedAxis?null==e.lockedFace?!0===Ct(e,t):e.lockedFace===t:-1!==e.lockedAxis.indexOf(t)}function Et(e,t){if(Ct(e,t))return t;if(Ct(e,mt[t]))return mt[t];var n=function(e,t){return(e.clockwise?xt:kt)[t]}(e,t);if(Ct(e,n))return n;var i=function(e,t){return(e.clockwise?kt:xt)[t]}(e,t);return Ct(e,i)?i:t}var St={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},Pt={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},wt={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},At={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},It={Top:[St],Bottom:[Pt],Left:[wt],Right:[At],TopLeft:[{x:0,y:0,ox:0,oy:-1,offx:0,offy:0}],TopRight:[{x:1,y:0,ox:1,oy:-1,offx:0,offy:0}],BottomLeft:[{x:0,y:1,ox:0,oy:1,offx:0,offy:0}],BottomRight:[{x:1,y:1,ox:0,oy:1,offx:0,offy:0}],Center:[{x:.5,y:.5,ox:0,oy:0,offx:0,offy:0}],AutoDefault:[St,wt,Pt,At]},Tt={Continuous:{faces:[ht,dt,yt,pt]},ContinuousTop:{faces:[ht]},ContinuousRight:{faces:[pt]},ContinuousBottom:{faces:[yt]},ContinuousLeft:{faces:[dt]},ContinuousLeftRight:{faces:[dt,pt]},ContinuousTopBottom:{faces:[ht,yt]}};function Ot(e,t){if(t=t||{},e===R.Perimeter)return function(e){var t=(e=e||{}).anchorCount||60,n=e.shape;if(!n)throw new Error("no shape supplied to Perimeter Anchor type");if(!Rt.has(n))throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type");var i=Rt.get(n)(t);e.rotation&&(i=function(e,t){for(var n=[],i=t/180*Math.PI,o=0;o<e.length;o++){var s=e[o].x-.5,r=e[o].y-.5;n.push({x:s*Math.cos(i)-r*Math.sin(i)+.5,y:s*Math.sin(i)+r*Math.cos(i)+.5,ox:e[o].ox,oy:e[o].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return n}(i,e.rotation));var o=Mt(R.Perimeter,i,e),s=h(o,{shape:n});return s}(t);var n=It[e];if(null!=n)return Mt(e,O(n,(function(e){return h({iox:e.ox,ioy:e.oy},e)})),t);if(null!=(n=Tt[e]))return function(e,t,n){var i={type:e,locations:[],currentLocation:0,locked:!1,id:a(),cssClass:n.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:n.faces||t,lockedFace:null,lockedAxis:null,clockwise:!(!1===n.clockwise),__currentFace:null};return Object.defineProperty(i,Gt,{get:function(){return this.__currentFace},set:function(e){this.__currentFace=Et(this,e)}}),i}(e,n.faces,t);throw{message:"jsPlumb: unknown anchor type '"+e+"'"}}function Mt(e,t,n){return{type:e,locations:t,currentLocation:0,locked:!1,id:a(),isFloating:!1,isContinuous:!1,isDynamic:t.length>1,timestamp:null,cssClass:n.cssClass||""}}var Gt="currentFace";function Lt(e){return e.length<7&&e.every(L)||7===e.length&&e.slice(0,5).every(L)&&d(e[6])}function Dt(e){if(d(e))return Ot(e,null);if(Array.isArray(e)){if(Lt(e)){var t=e;return Mt(null,[{x:t[0],y:t[1],ox:t[2],oy:t[3],offx:null==t[4]?0:t[4],offy:null==t[5]?0:t[5],iox:t[2],ioy:t[3],cls:t[6]||""}],{cssClass:t[6]||""})}return Mt("Dynamic",O(e,(function(e){if(d(e)){var t=It[e];return null!=t?h({iox:t[0].ox,ioy:t[0].oy,cls:""},t[0]):null}if(Lt(e))return{x:e[0],y:e[1],ox:e[2],oy:e[3],offx:null==e[4]?0:e[4],offy:null==e[5]?0:e[5],iox:e[2],ioy:e[3],cls:e[6]||""}})).filter((function(e){return null!=e})),{})}var n=e;return Ot(n.type,n.options)}function Ft(e){for(var t=.5,n=2*Math.PI/e,i=[],o=0,s=0;s<e;s++){var r=t+t*Math.sin(o),a=t+t*Math.cos(o);i.push({x:r,y:a,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),o+=n}return i}function jt(e,t){for(var n=[],i=0;i<e.length;i++)n.push([e[i][0],e[i][1],e[i][2],e[i][3],1/e.length,e[i][4],e[i][5]]);return function(e,t){for(var n=t/e.length,i=[],o=function(e,o,s,r,a,l,c){for(var u=(s-e)/(n=t*a),h=(r-o)/n,d=0;d<n;d++)i.push({x:e+u*d,y:o+h*d,ox:null==l?0:l,oy:null==c?0:c,offx:0,offy:0,iox:0,ioy:0,cls:""})},s=0;s<e.length;s++)o.apply(null,e[s]);return i}(n,t)}function Bt(e){return jt([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],e)}var Rt=new Map;Rt.set(D.Circle,Ft),Rt.set(D.Ellipse,Ft),Rt.set(D.Rectangle,Bt),Rt.set(D.Square,Bt),Rt.set(D.Diamond,(function(e){return jt([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],e)})),Rt.set(D.Triangle,(function(e){return jt([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],e)}));var Vt="anchors",Ut="connector";function Ht(e,t,n,i,o,s,r){var a;if(t)e.endpoints[n]=t,t.addConnection(e);else{var l=r||e.endpointSpec||e.endpointsSpec[n]||e.instance.defaults.endpoints[n]||e.instance.defaults.endpoint,c=e.endpointStyles[n]||e.endpointStyle||e.instance.defaults.endpointStyles[n]||e.instance.defaults.endpointStyle;null==c.fill&&null!=e.paintStyle&&(c.fill=e.paintStyle.stroke),null==c.outlineStroke&&null!=e.paintStyle&&(c.outlineStroke=e.paintStyle.outlineStroke),null==c.outlineWidth&&null!=e.paintStyle&&(c.outlineWidth=e.paintStyle.outlineWidth);var u=e.endpointHoverStyles[n]||e.endpointHoverStyle||e.endpointHoverStyle||e.instance.defaults.endpointHoverStyles[n]||e.instance.defaults.endpointHoverStyle;null!=e.hoverPaintStyle&&(null==u&&(u={}),null==u.fill&&(u.fill=e.hoverPaintStyle.stroke));var h=e.uuids?e.uuids[n]:null;i=null!=i?i:null!=e.instance.defaults.anchors?e.instance.defaults.anchors[n]:e.instance.defaults.anchor,a=e.instance._internal_newEndpoint({paintStyle:c,hoverPaintStyle:u,endpoint:l,connections:[e],uuid:h,element:o,scope:e.scope,anchor:i,reattachConnections:e.reattach||e.instance.defaults.reattachConnections,connectionsDetachable:e.detachable||e.instance.defaults.connectionsDetachable}),e.instance._refreshEndpoint(a),null==t&&(a.deleteOnEmpty=!0),e.endpoints[n]=a}return a}var Wt=e("v",function(e){X(i,e);var n=J(i);function i(e,o){var s;t(this,i),(s=n.call(this,e,o)).instance=e,W(N(s),"connector",void 0),W(N(s),"defaultLabelLocation",.5),W(N(s),"scope",void 0),W(N(s),"typeId","_jsplumb_connection"),W(N(s),"previousConnection",void 0),W(N(s),"sourceId",void 0),W(N(s),"targetId",void 0),W(N(s),"source",void 0),W(N(s),"target",void 0),W(N(s),"detachable",!0),W(N(s),"reattach",!1),W(N(s),"uuids",void 0),W(N(s),"cost",1),W(N(s),"directed",void 0),W(N(s),"endpoints",[null,null]),W(N(s),"endpointStyles",void 0),W(N(s),"endpointSpec",void 0),W(N(s),"endpointsSpec",void 0),W(N(s),"endpointStyle",{}),W(N(s),"endpointHoverStyle",{}),W(N(s),"endpointHoverStyles",void 0),W(N(s),"suspendedEndpoint",void 0),W(N(s),"suspendedIndex",void 0),W(N(s),"suspendedElement",void 0),W(N(s),"suspendedElementId",void 0),W(N(s),"suspendedElementType",void 0),W(N(s),"_forceReattach",void 0),W(N(s),"_forceDetach",void 0),W(N(s),"proxies",[]),W(N(s),"pending",!1),s.id=o.id,s.previousConnection=o.previousConnection,s.source=o.source,s.target=o.target,o.sourceEndpoint?(s.source=o.sourceEndpoint.element,s.sourceId=o.sourceEndpoint.elementId):s.sourceId=e.getId(s.source),o.targetEndpoint?(s.target=o.targetEndpoint.element,s.targetId=o.targetEndpoint.elementId):s.targetId=e.getId(s.target),s.scope=o.scope;var r=o.anchors?o.anchors[0]:o.anchor,l=o.anchors?o.anchors[1]:o.anchor;e.manage(s.source),e.manage(s.target),s.visible=!0,s.params={cssClass:o.cssClass,hoverClass:o.hoverClass,"pointer-events":o["pointer-events"],overlays:o.overlays},s.lastPaintedAt=null,o.type&&(o.endpoints=o.endpoints||s.instance._deriveEndpointAndAnchorSpec(o.type).endpoints),s.endpointSpec=o.endpoint,s.endpointsSpec=o.endpoints||[null,null],s.endpointStyle=o.endpointStyle,s.endpointHoverStyle=o.endpointHoverStyle,s.endpointStyles=o.endpointStyles||[null,null],s.endpointHoverStyles=o.endpointHoverStyles||[null,null],s.paintStyle=o.paintStyle,s.hoverPaintStyle=o.hoverPaintStyle,s.uuids=o.uuids,s.makeEndpoint(!0,s.source,s.sourceId,r,o.sourceEndpoint),s.makeEndpoint(!1,s.target,s.targetId,l,o.targetEndpoint),s.scope||(s.scope=s.endpoints[0].scope),null!=o.deleteEndpointsOnEmpty&&(s.endpoints[0].deleteOnEmpty=o.deleteEndpointsOnEmpty,s.endpoints[1].deleteOnEmpty=o.deleteEndpointsOnEmpty);var c=s.instance.defaults.connectionsDetachable;!1===o.detachable&&(c=!1),!1===s.endpoints[0].connectionsDetachable&&(c=!1),!1===s.endpoints[1].connectionsDetachable&&(c=!1),s.endpointsSpec=o.endpoints||[null,null],s.endpointSpec=o.endpoint||null;var u=o.reattach||s.endpoints[0].reattachConnections||s.endpoints[1].reattachConnections||s.instance.defaults.reattachConnections,d=h({},s.endpoints[0].connectorStyle||s.endpoints[1].connectorStyle||o.paintStyle||s.instance.defaults.paintStyle);if(s.appendToDefaultType({detachable:c,reattach:u,paintStyle:d,hoverPaintStyle:h({},s.endpoints[0].connectorHoverStyle||s.endpoints[1].connectorHoverStyle||o.hoverPaintStyle||s.instance.defaults.hoverPaintStyle)}),o.outlineWidth&&(d.outlineWidth=o.outlineWidth),o.outlineColor&&(d.outlineStroke=o.outlineColor),o.lineWidth&&(d.strokeWidth=o.lineWidth),o.color&&(d.stroke=o.color),!s.instance._suspendDrawing){var y=s.instance._suspendedAt||a();s.instance._paintEndpoint(s.endpoints[0],{timestamp:y}),s.instance._paintEndpoint(s.endpoints[1],{timestamp:y})}s.cost=o.cost||s.endpoints[0].connectionCost,s.directed=o.directed,null==o.directed&&(s.directed=s.endpoints[0].connectionsDirected);var v=h({},s.endpoints[1].parameters);h(v,s.endpoints[0].parameters),h(v,s.parameters),s.parameters=v,s.paintStyleInUse=s.getPaintStyle()||{},s._setConnector(s.endpoints[0].connector||s.endpoints[1].connector||o.connector||s.instance.defaults.connector,!0);var f=null!=o.data&&p(o.data)?o.data:{};s.setData(f);var g=[B,s.endpoints[0].edgeType,s.endpoints[1].edgeType,o.type].join(" ");return/[^\s]/.test(g)&&s.addType(g,o.data),s}return H(i,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return"connectionOverlays"}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(e,t,n,i,o){return n=n||this.instance.getId(t),Ht(this,o,e?0:1,i,t)}},{key:"getTypeDescriptor",value:function(){return i.type}},{key:"isDetachable",value:function(e){return!1!==this.detachable&&(null!=e?!0===e.connectionsDetachable:!0===this.detachable)}},{key:"setDetachable",value:function(e){this.detachable=!0===e}},{key:"isReattach",value:function(){return!0===this.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections}},{key:"setReattach",value:function(e){this.reattach=!0===e}},{key:"applyType",value:function(e,t){var n=null;null!=e.connector&&(null==(n=this.getCachedTypeItem(Ut,t.connector))&&(n=this.prepareConnector(e.connector,t.connector),this.cacheTypeItem(Ut,n,t.connector)),this.setPreparedConnector(n)),K(Y(i.prototype),"applyType",this).call(this,e,t),null!=e.detachable&&this.setDetachable(e.detachable),null!=e.reattach&&this.setReattach(e.reattach),e.scope&&(this.scope=e.scope);var o=null;e.anchor?null==(o=this.getCachedTypeItem(Vt,t.anchor))&&(o=[Dt(e.anchor),Dt(e.anchor)],this.cacheTypeItem(Vt,o,t.anchor)):e.anchors&&null==(o=this.getCachedTypeItem(Vt,t.anchors))&&(o=[Dt(e.anchors[0]),Dt(e.anchors[1])],this.cacheTypeItem(Vt,o,t.anchors)),null!=o&&(this.instance.router.setConnectionAnchors(this,o),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,e)}},{key:"addClass",value:function(e,t){K(Y(i.prototype),"addClass",this).call(this,e),t&&(this.endpoints[0].addClass(e),this.endpoints[1].addClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(e)),this.connector&&this.instance.addConnectorClass(this.connector,e)}},{key:"removeClass",value:function(e,t){K(Y(i.prototype),"removeClass",this).call(this,e),t&&(this.endpoints[0].removeClass(e),this.endpoints[1].removeClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(e)),this.connector&&this.instance.removeConnectorClass(this.connector,e)}},{key:"setVisible",value:function(e){K(Y(i.prototype),"setVisible",this).call(this,e),this.connector&&this.instance.setConnectorVisible(this.connector,e),this.instance._paintConnection(this)}},{key:"destroy",value:function(){K(Y(i.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(e,t){var n,i={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]};if(d(e))n=this.instance._makeConnector(this,e,i);else{var o=e;n=this.instance._makeConnector(this,o.type,y(o.options||{},i))}return null!=t&&(n.typeId=t),n}},{key:"setPreparedConnector",value:function(e,t,n,i){if(this.connector!==e){var o,s="";if(null!=this.connector&&(o=this.connector,s=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=e,i&&this.cacheTypeItem(Ut,e,i),this.addClass(s),null!=o){var r=this.getOverlays();for(var a in r)this.instance.reattachOverlay(r[a],this)}t||this.instance._paintConnection(this)}}},{key:"_setConnector",value:function(e,t,n,i){var o=this.prepareConnector(e,i);this.setPreparedConnector(o,t,n,i)}},{key:"replaceEndpoint",value:function(e,t){var n=this.endpoints[e],i=(n.elementId,this.instance.getEndpoints(n.element)),o=i.indexOf(n),s=Ht(this,null,e,null,n.element,0,t);this.endpoints[e]=s,i.splice(o,1,s),n.detachFromConnection(this),this.instance.deleteEndpoint(n),this.instance.fire("endpoint:replaced",{previous:n,current:s})}}]),i}(ut));W(Wt,"type","connection");var Xt=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],Yt=e("J",function(e){X(i,e);var n=J(i);function i(e,o){var s;t(this,i),(s=n.call(this,e,o)).instance=e,W(N(s),"connections",[]),W(N(s),"endpoint",void 0),W(N(s),"element",void 0),W(N(s),"elementId",void 0),W(N(s),"dragAllowedWhenFull",!0),W(N(s),"timestamp",void 0),W(N(s),"portId",void 0),W(N(s),"maxConnections",void 0),W(N(s),"proxiedBy",void 0),W(N(s),"connectorClass",void 0),W(N(s),"connectorHoverClass",void 0),W(N(s),"finalEndpoint",void 0),W(N(s),"enabled",!0),W(N(s),"isSource",void 0),W(N(s),"isTarget",void 0),W(N(s),"isTemporarySource",void 0),W(N(s),"connectionCost",1),W(N(s),"connectionsDirected",void 0),W(N(s),"connectionsDetachable",void 0),W(N(s),"reattachConnections",void 0),W(N(s),"currentAnchorClass",void 0),W(N(s),"referenceEndpoint",void 0),W(N(s),"edgeType",void 0),W(N(s),"connector",void 0),W(N(s),"connectorOverlays",void 0),W(N(s),"connectorStyle",void 0),W(N(s),"connectorHoverStyle",void 0),W(N(s),"deleteOnEmpty",void 0),W(N(s),"uuid",void 0),W(N(s),"scope",void 0),W(N(s),"_anchor",void 0),W(N(s),"defaultLabelLocation",[.5,.5]),s.appendToDefaultType({edgeType:o.edgeType,maxConnections:null==o.maxConnections?s.instance.defaults.maxConnections:o.maxConnections,paintStyle:o.paintStyle||s.instance.defaults.endpointStyle,hoverPaintStyle:o.hoverPaintStyle||s.instance.defaults.endpointHoverStyle,connectorStyle:o.connectorStyle,connectorHoverStyle:o.connectorHoverStyle,connectorClass:o.connectorClass,connectorHoverClass:o.connectorHoverClass,connectorOverlays:o.connectorOverlays,connector:o.connector}),s.enabled=!(!1===o.enabled),s.visible=!0,s.element=o.element,s.uuid=o.uuid,s.portId=o.portId,s.elementId=o.elementId,s.connectionCost=null==o.connectionCost?1:o.connectionCost,s.connectionsDirected=o.connectionsDirected,s.currentAnchorClass="",s.events={},s.connectorOverlays=o.connectorOverlays,s.connectorStyle=o.connectorStyle,s.connectorHoverStyle=o.connectorHoverStyle,s.connector=o.connector,s.edgeType=o.edgeType,s.connectorClass=o.connectorClass,s.connectorHoverClass=o.connectorHoverClass,s.deleteOnEmpty=!0===o.deleteOnEmpty,s.isSource=o.source||!1,s.isTemporarySource=o.isTemporarySource||!1,s.isTarget=o.target||!1,s.connections=o.connections||[],s.scope=o.scope||e.defaultScope,s.timestamp=null,s.reattachConnections=o.reattachConnections||e.defaults.reattachConnections,s.connectionsDetachable=e.defaults.connectionsDetachable,!1===o.connectionsDetachable&&(s.connectionsDetachable=!1),s.dragAllowedWhenFull=!1!==o.dragAllowedWhenFull,o.onMaxConnections&&s.bind(Be,o.onMaxConnections);var r=o.endpoint||o.existingEndpoint||e.defaults.endpoint;if(s.setEndpoint(r),null!=o.preparedAnchor)s.setPreparedAnchor(o.preparedAnchor);else{var a=o.anchor?o.anchor:o.anchors?o.anchors:e.defaults.anchor||R.Top;s.setAnchor(a)}var l=[B,o.type||""].join(" ");return s.addType(l,o.data),s}return H(i,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var e=this._anchor&&this._anchor.cssClass;if(null!=e&&e.length>0){var t=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=e;var n=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");t!==n&&(this.removeClass(t),this.addClass(n),this.instance.removeClass(this.element,t),this.instance.addClass(this.element,n))}}},{key:"setPreparedAnchor",value:function(e){return this.instance.router.setAnchor(this,e),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(e){this.fire("anchor:changed",{endpoint:this,anchor:e}),this._updateAnchorClass()}},{key:"setAnchor",value:function(e){var t=this.instance.router.prepareAnchor(e);return this.setPreparedAnchor(t),this}},{key:"addConnection",value:function(e){this.connections.push(e),this.instance._refreshEndpoint(this)}},{key:"detachFromConnection",value:function(e,t,n){(t=null==t?this.connections.indexOf(e):t)>=0&&(this.connections.splice(t,1),this.instance._refreshEndpoint(this)),!n&&this.deleteOnEmpty&&0===this.connections.length&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(e){for(var t=this.connections.length,n=0;n<t;n++)this.instance.deleteConnection(this.connections[0],e)}},{key:"detachFrom",value:function(e){for(var t=[],n=0;n<this.connections.length;n++)this.connections[n].endpoints[1]!==e&&this.connections[n].endpoints[0]!==e||t.push(this.connections[n]);for(var i=0,o=t.length;i<o;i++)this.instance.deleteConnection(t[0]);return this}},{key:"setVisible",value:function(e,t,n){if(K(Y(i.prototype),"setVisible",this).call(this,e),this.endpoint.setVisible(e),e?this.showOverlays():this.hideOverlays(),!t)for(var o=0;o<this.connections.length;o++)if(this.connections[o].setVisible(e),!n){var s=this===this.connections[o].endpoints[0]?1:0;1===this.connections[o].endpoints[s].connections.length&&this.connections[o].endpoints[s].setVisible(e,!0,!0)}}},{key:"applyType",value:function(e,t){K(Y(i.prototype),"applyType",this).call(this,e,t),this.setPaintStyle(e.endpointStyle||e.paintStyle),this.setHoverPaintStyle(e.endpointHoverStyle||e.hoverPaintStyle),this.connectorStyle=e.connectorStyle,this.connectorHoverStyle=e.connectorHoverStyle,this.connector=e.connector,this.connectorOverlays=e.connectorOverlays,this.edgeType=e.edgeType,null!=e.maxConnections&&(this.maxConnections=e.maxConnections),e.scope&&(this.scope=e.scope),h(e,Xt),this.instance.applyEndpointType(this,e)}},{key:"destroy",value:function(){K(Y(i.prototype),"destroy",this).call(this),this.deleted=!0,null!=this.endpoint&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return 0===this.maxConnections||!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(e){var t=!1;if(e)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===e||this.connections[n].endpoints[0]===e){t=!0;break}return t}},{key:"setDragAllowedWhenFull",value:function(e){this.dragAllowedWhenFull=e}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(e,t){var n,i={cssClass:this.cssClass,endpoint:this};if(v(e,se)){var o=e;(n=oe.clone(o)).classes=i.cssClass.split(" ")}else if(d(e))n=oe.get(this,e,i);else{var s=e;h(i,s.options||{}),n=oe.get(this,s.type,i)}return n.typeId=t,n}},{key:"setEndpoint",value:function(e){var t=this.prepareEndpoint(e);this.setPreparedEndpoint(t)}},{key:"setPreparedEndpoint",value:function(e){null!=this.endpoint&&this.instance.destroyEndpoint(this),this.endpoint=e}},{key:"addClass",value:function(e,t){K(Y(i.prototype),"addClass",this).call(this,e,t),null!=this.endpoint&&this.endpoint.addClass(e)}},{key:"removeClass",value:function(e,t){K(Y(i.prototype),"removeClass",this).call(this,e,t),null!=this.endpoint&&this.endpoint.removeClass(e)}}]),i}(ut)),zt=function e(n,i){t(this,e),this.instance=n,this.el=i,W(this,"group",void 0)},Nt=function(e){X(o,e);var i=J(o);function o(e,n,s){var r;t(this,o),(r=i.call(this,e,n)).instance=e,W(N(r),"children",[]),W(N(r),"collapsed",!1),W(N(r),"droppable",void 0),W(N(r),"enabled",void 0),W(N(r),"orphan",void 0),W(N(r),"constrain",void 0),W(N(r),"proxied",void 0),W(N(r),"ghost",void 0),W(N(r),"revert",void 0),W(N(r),"prune",void 0),W(N(r),"dropOverride",void 0),W(N(r),"anchor",void 0),W(N(r),"endpoint",void 0),W(N(r),"connections",{source:[],target:[],internal:[]}),W(N(r),"manager",void 0),W(N(r),"id",void 0),W(N(r),"elId",void 0);var l=r.el;return l._isJsPlumbGroup=!0,l._jsPlumbGroup=N(r),r.elId=e.getId(n),r.orphan=!0===s.orphan,r.revert=!0!==r.orphan&&!1!==s.revert,r.droppable=!1!==s.droppable,r.ghost=!0===s.ghost,r.enabled=!1!==s.enabled,r.prune=!0!==r.orphan&&!0===s.prune,r.constrain=r.ghost||!0===s.constrain,r.proxied=!1!==s.proxied,r.id=s.id||a(),r.dropOverride=!0===s.dropOverride,r.anchor=s.anchor,r.endpoint=s.endpoint,r.anchor=s.anchor,e.setAttribute(n,Ce,""),r}return H(o,[{key:"contentArea",get:function(){return this.instance.getGroupContentArea(this)}},{key:"overrideDrop",value:function(e,t){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(e,t){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(e,t){return this.endpoint||{type:re.type,options:{radius:10}}}},{key:"add",value:function(e,t){var n=this.instance.getGroupContentArea(this),i=e;if(null!=i._jsPlumbParentGroup){if(i._jsPlumbParentGroup===this)return;i._jsPlumbParentGroup.remove(e,!0,t,!1)}i._jsPlumbParentGroup=this,this.children.push(new zt(this.instance,e)),this.instance._appendElement(i,n),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(e){return null==e?null:f(this.children,(function(t){return t.el===e}))}},{key:"remove",value:function(e,t,n,i,o){var s=this.resolveNode(e);null!=s&&this._doRemove(s,t,n,i,o)}},{key:"_doRemove",value:function(e,t,i,o,s){var r=e.el;if(delete r._jsPlumbParentGroup,g(this.children,(function(t){return t===e})),t)try{this.instance.getGroupContentArea(this).removeChild(r)}catch(l){n("Could not remove element from Group "+l)}if(!i){var a={group:this,el:r};s&&(a.targetGroup=s),this.instance.fire("group:member:removed",a)}o||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(e,t){for(var n=0,i=this.children.length;n<i;n++){var o=this.children[0];this._doRemove(o,e,t,!0),this.instance.unmanage(o.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var e={},t=0;t<this.children.length;t++){var n=this.manager.orphan(this.children[t].el,!1);e[n.id]=n.pos}return this.children.length=0,e}},{key:"addGroup",value:function(e){if(this.instance.allowNestedGroups&&e!==this){if(this.instance.groupManager.isAncestor(this,e))return!1;null!=e.group&&e.group.removeGroup(e);var t=this.instance.getId(e.el);this.instance.getManagedElements()[t].group=this.elId;var n=this.instance.getOffsetRelativeToRoot(e.el),i=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this));e.el._jsPlumbParentGroup=this,this.children.push(e),this.instance._appendElementToGroup(this,e.el),e.group=this;var o={x:n.x-i.x,y:n.y-i.y};return this.instance.setPosition(e.el,o),this.instance.fire("group:nested:added",{parent:this,child:e}),!0}return!1}},{key:"removeGroup",value:function(e){if(e.group===this){var t=e.el,n=this.instance.getGroupContentArea(this);n===t.parentNode&&n.removeChild(e.el);var i=this.instance.getId(e.el),o=this.instance.getManagedElements()[i];o&&delete o.group,this.children=this.children.filter((function(t){return t.id!==e.id})),delete e.group,delete t._jsPlumbParentGroup,this.instance.fire("group:nested:removed",{parent:this,child:e})}}},{key:"getGroups",value:function(){return this.children.filter((function(e){return e.constructor===o}))}},{key:"getNodes",value:function(){return this.children.filter((function(e){return e.constructor===zt}))}},{key:"collapseParent",get:function(){var e=null;if(null==this.group)return null;for(var t=this.group;null!=t;)t.collapsed&&(e=t),t=t.group;return e}}]),o}(zt),qt=function(){function e(n){var i=this;t(this,e),this.instance=n,W(this,"groupMap",{}),W(this,"_connectionSourceMap",{}),W(this,"_connectionTargetMap",{}),n.bind(Me,(function(e){var t=i.getGroupFor(e.source),n=i.getGroupFor(e.target);null!=t&&null!=n&&t===n?(i._connectionSourceMap[e.connection.id]=t,i._connectionTargetMap[e.connection.id]=t,m(t.connections.internal,e.connection)):(null!=t&&(e.target._jsPlumbGroup===t?m(t.connections.internal,e.connection):m(t.connections.source,e.connection),i._connectionSourceMap[e.connection.id]=t),null!=n&&(e.source._jsPlumbGroup===n?m(n.connections.internal,e.connection):m(n.connections.target,e.connection),i._connectionTargetMap[e.connection.id]=n))})),n.bind(Fe,(function(e){i._cleanupDetachedConnection(e.connection)})),n.bind(Le,(function(e){var t=e.originalEndpoint.element,n=i.getGroupFor(t),o=e.connection.endpoints[e.index].element,s=i.getGroupFor(o),r=0===e.index?i._connectionSourceMap:i._connectionTargetMap,a=0===e.index?i._connectionTargetMap:i._connectionSourceMap;null!=s?(r[e.connection.id]=s,e.connection.source===e.connection.target&&(a[e.connection.id]=s)):(delete r[e.connection.id],e.connection.source===e.connection.target&&delete a[e.connection.id]),null!=n&&i._updateConnectionsForGroup(n),null!=s&&i._updateConnectionsForGroup(s)}))}return H(e,[{key:"_cleanupDetachedConnection",value:function(e){e.proxies.length=0;var t,n=this._connectionSourceMap[e.id];null!=n&&(t=function(t){return t.id===e.id},g(n.connections.source,t),g(n.connections.target,t),g(n.connections.internal,t),delete this._connectionSourceMap[e.id]),null!=(n=this._connectionTargetMap[e.id])&&(t=function(t){return t.id===e.id},g(n.connections.source,t),g(n.connections.target,t),g(n.connections.internal,t),delete this._connectionTargetMap[e.id])}},{key:"addGroup",value:function(e){var t=e.el;if(null!=this.groupMap[e.id])throw new Error("cannot create Group ["+e.id+"]; a Group with that ID exists");if(null!=t._isJsPlumbGroup)throw new Error("cannot create Group ["+e.id+"]; the given element is already a Group");var n=new Nt(this.instance,e.el,e);return this.groupMap[n.id]=n,e.collapsed&&this.collapseGroup(n),this.instance.manage(n.el),this.instance.addClass(n.el,Ie),n.manager=this,this._updateConnectionsForGroup(n),this.instance.fire("group:added",{group:n}),n}},{key:"getGroup",value:function(e){var t=e;if(d(e)&&null==(t=this.groupMap[e]))throw new Error("No such group ["+e+"]");return t}},{key:"getGroupFor",value:function(e){for(var t=e,n=this.instance.getContainer(),i=!1,o=null;!i;)null==t||t===n?i=!0:t._jsPlumbParentGroup?(o=t._jsPlumbParentGroup,i=!0):t=t.parentNode;return o}},{key:"getGroups",value:function(){var e=[];for(var t in this.groupMap)e.push(this.groupMap[t]);return e}},{key:"removeGroup",value:function(e,t,n,i){var o=this,s=this.getGroup(e);this.expandGroup(s,!0);var r={};return x(s.children,(function(e){var t=o.instance.getManagedElements()[o.instance.getId(e.el)];t&&delete t.group})),t?(x(s.getGroups(),(function(e){return o.removeGroup(e,t,n)})),s.removeAll(n,i)):(s.group&&x(s.children,(function(e){return s.group.add(e.el)})),r=s.orphanAll()),s.group&&s.group.removeGroup(s),this.instance.unmanage(s.el,!0),delete this.groupMap[s.id],this.instance.fire("group:removed",{group:s}),r}},{key:"removeAllGroups",value:function(e,t,n){for(var i in this.groupMap)this.removeGroup(this.groupMap[i],e,t,n)}},{key:"forEach",value:function(e){for(var t in this.groupMap)e(this.groupMap[t])}},{key:"orphan",value:function(e,t){var n=e;if(n._jsPlumbParentGroup){var i=n._jsPlumbParentGroup,o=this.instance.getId(n),s=this.instance.getOffset(e);return!0!==t&&i.group?this.instance._appendElementToGroup(i.group,e):this.instance._appendElementToContainer(e),this.instance.setPosition(e,s),delete n._jsPlumbParentGroup,{id:o,pos:s}}}},{key:"_updateConnectionsForGroup",value:function(e){var t=this;e.connections.source.length=0,e.connections.target.length=0,e.connections.internal.length=0;var n=e.children.slice().map((function(e){return e.el})),i=[];if(x(n,(function(e){Array.prototype.push.apply(i,t.instance.getSelector(e,We))})),Array.prototype.push.apply(n,i),n.length>0){var o,s,r=this.instance.getConnections({source:n,scope:V},!0),a=this.instance.getConnections({target:n,scope:V},!0),l={},c=function(n){for(var i=0;i<n.length;i++)l[n[i].id]||(l[n[i].id]=!0,o=t.getGroupFor(n[i].source),s=t.getGroupFor(n[i].target),n[i].source===e.el&&s===e||n[i].target===e.el&&o===e?e.connections.internal.push(n[i]):o===e?(s!==e?e.connections.source.push(n[i]):e.connections.internal.push(n[i]),t._connectionSourceMap[n[i].id]=e):s===e&&(e.connections.target.push(n[i]),t._connectionTargetMap[n[i].id]=e))};c(r),c(a)}}},{key:"_collapseConnection",value:function(e,t,n){var i=e.endpoints[0===t?1:0].element;if(i._jsPlumbParentGroup&&!i._jsPlumbParentGroup.proxied&&i._jsPlumbParentGroup.collapsed)return!1;var o=e.endpoints[0].element._jsPlumbParentGroup,s=null!=o?o.collapseParent||o:null,r=e.endpoints[1].element._jsPlumbParentGroup,a=null!=r?r.collapseParent||r:null;if(null==s||null==a||s.id!==a.id){var l=n.el;return this.instance.getId(l),this.instance.proxyConnection(e,t,l,(function(e,t){return n.getEndpoint(e,t)}),(function(e,t){return n.getAnchor(e,t)})),!0}return!1}},{key:"_expandConnection",value:function(e,t,n){this.instance.unproxyConnection(e,t)}},{key:"isElementDescendant",value:function(e,t){for(var n=this.instance.getContainer();;){if(null==e||e===n)return!1;if(e===t)return!0;e=e.parentNode}}},{key:"collapseGroup",value:function(e){var t=this,n=this.getGroup(e);if(null!=n&&!n.collapsed){var i=n.el;if(null==n.collapseParent){if(this.instance.setGroupVisible(n,!1),n.collapsed=!0,this.instance.removeClass(i,Ie),this.instance.addClass(i,Ae),n.proxied){var o=new Set,s=function(e,i){for(var s=0;s<e.length;s++){var r=e[s];!0===t._collapseConnection(r,i,n)&&o.add(r.id)}};s(n.connections.source,0),s(n.connections.target,1),x(n.getGroups(),(function(e){t.cascadeCollapse(n,e,o)}))}this.instance.revalidate(i),this.repaintGroup(n),this.instance.fire("group:collapse",{group:n})}else n.collapsed=!0,this.instance.removeClass(i,Ie),this.instance.addClass(i,Ae)}}},{key:"cascadeCollapse",value:function(e,t,n){var i=this;if(e.proxied){var o=function(t,o){for(var s=0;s<t.length;s++){var r=t[s];n.has(r.id)||!0===i._collapseConnection(r,o,e)&&n.add(r.id)}};o(t.connections.source,0),o(t.connections.target,1)}x(t.getGroups(),(function(t){i.cascadeCollapse(e,t,n)}))}},{key:"expandGroup",value:function(e,t){var n=this,i=this.getGroup(e);if(null!=i){var o=i.el;if(null==i.collapseParent){if(this.instance.setGroupVisible(i,!0),i.collapsed=!1,this.instance.addClass(o,Ie),this.instance.removeClass(o,Ae),i.proxied){var s=function(e,t){for(var o=0;o<e.length;o++){var s=e[o];n._expandConnection(s,t,i)}};s(i.connections.source,0),s(i.connections.target,1),x(i.getGroups(),(function e(t,i){if(i||t.collapsed){var o=function(e,i){for(var o=0;o<e.length;o++){var s=e[o];n._collapseConnection(s,i,t.collapseParent||t)}};o(t.connections.source,0),o(t.connections.target,1),x(t.connections.internal,(function(e){return e.setVisible(!1)})),x(t.getGroups(),(function(t){return e(t,!0)}))}else n.expandGroup(t,!0)}))}this.instance.revalidate(o),this.repaintGroup(i),t||this.instance.fire("group:expand",{group:i})}else i.collapsed=!1,this.instance.addClass(o,Ie),this.instance.removeClass(o,Ae)}}},{key:"toggleGroup",value:function(e){null!=(e=this.getGroup(e))&&(e.collapsed?this.expandGroup(e):this.collapseGroup(e))}},{key:"repaintGroup",value:function(e){for(var t=this.getGroup(e).children,n=0;n<t.length;n++)this.instance.revalidate(t[n].el)}},{key:"addToGroup",value:function(e,t){var n=this,i=this.getGroup(e);if(i){for(var o=i.el,s=function(e){var s=e,r=null!=s._isJsPlumbGroup,a=s._jsPlumbGroup,l=s._jsPlumbParentGroup;if(l!==i){var c=n.instance.manage(e),u=n.instance.getOffset(e),h=i.collapsed?n.instance.getOffsetRelativeToRoot(o):n.instance.getOffset(n.instance.getGroupContentArea(i));c.group=i.elId,null!=l&&(l.remove(e,!1,t,!1,i),n._updateConnectionsForGroup(l)),r?i.addGroup(a):i.add(e,t);var d=function(e,t){var o=0===t?1:0;e.each((function(e){e.setVisible(!1),e.endpoints[o].element._jsPlumbGroup===i?(e.endpoints[o].setVisible(!1),n._expandConnection(e,o,i)):(e.endpoints[t].setVisible(!1),n._collapseConnection(e,t,i))}))};i.collapsed&&(d(n.instance.select({source:e}),0),d(n.instance.select({target:e}),1)),n.instance.getId(e);var p={x:u.x-h.x,y:u.y-h.y};if(n.instance.setPosition(e,p),n._updateConnectionsForGroup(i),n.instance.revalidate(e),!t){var y={group:i,el:e,pos:p};l&&(y.sourceGroup=l),n.instance.fire(je,y)}}},r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];x(a,s)}}},{key:"removeFromGroup",value:function(e,t){var n=this,i=this.getGroup(e);if(i){for(var o=function(e){if(i.collapsed){var o=function(t,o){for(var s=0;s<t.length;s++){var r=t[s];if(r.proxies)for(var a=0;a<r.proxies.length;a++)if(null!=r.proxies[a]){var l=r.proxies[a].originalEp.element;(l===e||n.isElementDescendant(l,e))&&n._expandConnection(r,o,i)}}};o(i.connections.source.slice(),0),o(i.connections.target.slice(),1)}i.remove(e,null,t);var s=n.instance.getManagedElements()[n.instance.getId(e)];s&&delete s.group},s=arguments.length,r=new Array(s>2?s-2:0),a=2;a<s;a++)r[a-2]=arguments[a];x(r,o)}}},{key:"getAncestors",value:function(e){for(var t=[],n=e.group;null!=n;)t.push(n),n=n.group;return t}},{key:"isAncestor",value:function(e,t){return null!=e&&null!=t&&-1!==this.getAncestors(e).indexOf(t)}},{key:"getDescendants",value:function(e){var t=[];return function e(n){var i=n.getGroups();t.push.apply(t,$(i)),x(i,e)}(e),t}},{key:"isDescendant",value:function(e,t){return null!=e&&null!=t&&-1!==this.getDescendants(t).indexOf(e)}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),e}(),Jt=function(){function e(n,i){t(this,e),this.instance=n,this.entries=i}return H(e,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(e){return x(this.entries,(function(t){return e(t)})),this}},{key:"get",value:function(e){return this.entries[e]}},{key:"addClass",value:function(e,t){return this.each((function(n){return n.addClass(e,t)})),this}},{key:"removeClass",value:function(e,t){return this.each((function(n){return n.removeClass(e,t)})),this}},{key:"removeAllOverlays",value:function(){return this.each((function(e){return e.removeAllOverlays()})),this}},{key:"setLabel",value:function(e){return this.each((function(t){return t.setLabel(e)})),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(e){var t=[];return this.each((function(n){return t.push(e(n))})),t}},{key:"addOverlay",value:function(e){return this.each((function(t){return t.addOverlay(e)})),this}},{key:"removeOverlay",value:function(e){return this.each((function(t){return t.removeOverlay(e)})),this}},{key:"removeOverlays",value:function(){return this.each((function(e){return e.removeOverlays()})),this}},{key:"showOverlay",value:function(e){return this.each((function(t){return t.showOverlay(e)})),this}},{key:"hideOverlay",value:function(e){return this.each((function(t){return t.hideOverlay(e)})),this}},{key:"setPaintStyle",value:function(e){return this.each((function(t){return t.setPaintStyle(e)})),this}},{key:"setHoverPaintStyle",value:function(e){return this.each((function(t){return t.setHoverPaintStyle(e)})),this}},{key:"setSuspendEvents",value:function(e){return this.each((function(t){return t.setSuspendEvents(e)})),this}},{key:"setParameter",value:function(e,t){return this.each((function(n){return n.parameters[e]=t})),this}},{key:"setParameters",value:function(e){return this.each((function(t){return t.parameters=e})),this}},{key:"setVisible",value:function(e){return this.each((function(t){return t.setVisible(e)})),this}},{key:"addType",value:function(e){return this.each((function(t){return t.addType(e)})),this}},{key:"toggleType",value:function(e){return this.each((function(t){return t.toggleType(e)})),this}},{key:"removeType",value:function(e){return this.each((function(t){return t.removeType(e)})),this}},{key:"bind",value:function(e,t){return this.each((function(n){return n.bind(e,t)})),this}},{key:"unbind",value:function(e,t){return this.each((function(n){return n.unbind(e,t)})),this}},{key:"setHover",value:function(e){var t=this;return this.each((function(n){return t.instance.setHover(n,e)})),this}}]),e}(),Kt=function(e){X(i,e);var n=J(i);function i(){return t(this,i),n.apply(this,arguments)}return H(i,[{key:"setEnabled",value:function(e){return this.each((function(t){return t.enabled=e})),this}},{key:"setAnchor",value:function(e){return this.each((function(t){return t.setAnchor(e)})),this}},{key:"deleteEveryConnection",value:function(){return this.each((function(e){return e.deleteEveryConnection()})),this}},{key:"deleteAll",value:function(){var e=this;return this.each((function(t){return e.instance.deleteEndpoint(t)})),this.clear(),this}}]),i}(Jt),Zt=function(e){X(i,e);var n=J(i);function i(){return t(this,i),n.apply(this,arguments)}return H(i,[{key:"setDetachable",value:function(e){return this.each((function(t){return t.setDetachable(e)})),this}},{key:"setReattach",value:function(e){return this.each((function(t){return t.setReattach(e)})),this}},{key:"setConnector",value:function(e){return this.each((function(t){return t._setConnector(e)})),this}},{key:"deleteAll",value:function(){var e=this;this.each((function(t){return e.instance.deleteConnection(t)})),this.clear()}},{key:"repaint",value:function(){var e=this;return this.each((function(t){return e.instance._paintConnection(t)})),this}}]),i}(Jt),$t=function e(){t(this,e),W(this,"affectedElements",new Set)};function Qt(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}var en=function(e,t){var n=0;return t[1]>e[1]?n=-1:t[1]<e[1]&&(n=1),n},tn=function(e,t){return-1*en(e,t)};function nn(e,t,n,i){M([e,t],n,en,i)}function on(e,t){var n=_(t,(function(t){return t[0]===e}));n>-1&&t.splice(n,1)}var sn,rn=function(e){X(i,e);var n=J(i);function i(e){var o;return t(this,i),(o=n.call(this)).instance=e,W(N(o),"_currentTransaction",null),W(N(o),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),W(N(o),"_elementMap",new Map),W(N(o),"_transformedElementMap",new Map),W(N(o),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),o}return H(i,[{key:"_updateBounds",value:function(e,t,n){null!=t&&(on(e,this._sortedElements.xmin),on(e,this._sortedElements.xmax),on(e,this._sortedElements.ymin),on(e,this._sortedElements.ymax),nn(e,t.t.x,this._sortedElements.xmin,!1),nn(e,t.t.x+t.t.w,this._sortedElements.xmax,!0),nn(e,t.t.y,this._sortedElements.ymin,!1),nn(e,t.t.y+t.t.h,this._sortedElements.ymax,!0),!0!==n&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var e=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach((function(t,n){e._sortedElements.xmin.push([n,t.t.x]),e._sortedElements.xmax.push([n,t.t.x+t.t.w]),e._sortedElements.ymin.push([n,t.t.y]),e._sortedElements.ymax.push([n,t.t.y+t.t.h])})),this._sortedElements.xmin.sort(en),this._sortedElements.ymin.sort(en),this._sortedElements.xmax.sort(tn),this._sortedElements.ymax.sort(tn),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(e,t,n){var i,o,s,r,a,l,c,u,h,d,p,y,v,f,g,m,x,k,_;t.t=(i=t.x,o=t.y,s=t.w,r=t.h,a=t.r,l=i+s/2,c=o+r/2,u=Math.cos(a/360*Math.PI*2),h=Math.sin(a/360*Math.PI*2),d=function(e,t){return{x:l+Math.round((e-l)*u-(t-c)*h),y:c+Math.round((t-c)*u-(e-l)*h)}},p=d(i,o),y=d(i+s,o),v=d(i+s,o+r),f=d(i,o+r),g=d(i+s/2,o+r/2),m=Math.min(p.x,y.x,v.x,f.x),x=Math.max(p.x,y.x,v.x,f.x),k=Math.min(p.y,y.y,v.y,f.y),_=Math.max(p.y,y.y,v.y,f.y),{x:m,y:k,w:x-m,h:_-k,c:g,r:a,x2:x,y2:_,cr:u,sr:h}),this._transformedElementMap.set(e,t.t),!0!==n&&this._updateBounds(e,t,n)}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"startTransaction",value:function(){if(null!=this._currentTransaction)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new $t}},{key:"endTransaction",value:function(){var e=this;null!=this._currentTransaction&&(this._currentTransaction.affectedElements.forEach((function(t){var n=e.getPosition(t);e._finaliseUpdate(t,n,!0)})),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(e){var t=this;x(e,(function(e){return t.updateElement(e.id,e.x,e.y,e.width,e.height,e.rotation)}))}},{key:"updateElement",value:function(e,t,n,i,o,s,r){var a=k(this._elementMap,e,Qt);return a.dirty=null==t&&null==a.x||null==n&&null==a.y||null==i&&null==a.w||null==o&&null==a.h,null!=t&&(a.x=t),null!=n&&(a.y=n),null!=i&&(a.w=i),null!=o&&(a.h=o),null!=s&&(a.r=s||0),a.c.x=a.x+a.w/2,a.c.y=a.y+a.h/2,a.x2=a.x+a.w,a.y2=a.y+a.h,null==this._currentTransaction?this._finaliseUpdate(e,a,r):this._currentTransaction.affectedElements.add(e),a}},{key:"refreshElement",value:function(e,t){var n=this.instance.getManagedElements(),i=n[e]?n[e].el:null;if(null!=i){var o=this.getSize(i),s=this.getOffset(i);return this.updateElement(e,s.x,s.y,o.w,o.h,null,t)}return null}},{key:"getSize",value:function(e){return this.instance.getSize(e)}},{key:"getOffset",value:function(e){return this.instance.getOffset(e)}},{key:"registerElement",value:function(e,t){return this.updateElement(e,0,0,0,0,0,t)}},{key:"addElement",value:function(e,t,n,i,o,s){return this.updateElement(e,t,n,i,o,s)}},{key:"rotateElement",value:function(e,t){var n=k(this._elementMap,e,Qt);return n.r=t||0,this._finaliseUpdate(e,n),n}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(e,t,n){if(this._elementMap.has(e))return this.updateElement(e,null,null,t,n,null)}},{key:"setPosition",value:function(e,t,n){if(this._elementMap.has(e))return this.updateElement(e,t,n,null,null,null)}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(e){on(e,this._sortedElements.xmin),on(e,this._sortedElements.xmax),on(e,this._sortedElements.ymin),on(e,this._sortedElements.ymax),this._elementMap.delete(e),this._transformedElementMap.delete(e),this._recalculateBounds()}},{key:"getPosition",value:function(e){return this._elementMap.get(e)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return 0===this._elementMap.size}}]),i}(l);function an(e,t){return t.theta-e.theta}function ln(e,t){return(e.theta<0?-Math.PI-e.theta:Math.PI-e.theta)-(t.theta<0?-Math.PI-t.theta:Math.PI-t.theta)}var cn=(W(sn={},ht,ln),W(sn,pt,an),W(sn,yt,an),W(sn,dt,ln),sn);function un(e){return!0===e.isContinuous}function hn(e){return!0===e.isContinuous}function dn(e){return e.locations.length>1}function pn(e){return[e.currentLocation,e.locations[e.currentLocation]]}var yn=function(){function e(n){var i=this;t(this,e),this.instance=n,W(this,"anchorLists",new Map),W(this,"anchorLocations",new Map),n.bind(Fe,(function(e){e.sourceEndpoint._anchor.isContinuous&&i._removeEndpointFromAnchorLists(e.sourceEndpoint),e.targetEndpoint._anchor.isContinuous&&i._removeEndpointFromAnchorLists(e.targetEndpoint)})),n.bind(De,(function(e){i._removeEndpointFromAnchorLists(e)}))}return H(e,[{key:"getAnchorOrientation",value:function(e){var t=this.anchorLocations.get(e.id);return t?[t.ox,t.oy]:[0,0]}},{key:"_distance",value:function(e,t,n,i,o,s,r){var a=i.x+e.x*o.w,l=i.y+e.y*o.h,c=i.x+o.w/2,u=i.y+o.h/2;if(null!=s&&s.length>0){var h=this.instance._applyRotations([a,l,0,0],s);a=h.x,l=h.y}return Math.sqrt(Math.pow(t-a,2)+Math.pow(n-l,2))+Math.sqrt(Math.pow(c-a,2)+Math.pow(u-l,2))}},{key:"_anchorSelector",value:function(e,t,n,i,o,s,r){for(var a=n.x+i.w/2,l=n.y+i.h/2,c=-1,u=1/0,h=0;h<r.length;h++){var d=this._distance(r[h],a,l,e,t,o,s);d<u&&(c=h+0,u=d)}return[c,r[c]]}},{key:"_floatingAnchorCompute",value:function(e,t){var n=t.xy,i={curX:n.x+e.size.w/2,curY:n.y+e.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(e,i)}},{key:"_setComputedPosition",value:function(e,t,n){return this.anchorLocations.set(e.id,t),e.computedPosition=t,n&&(e.timestamp=n),t}},{key:"_computeSingleLocation",value:function(e,t,n,i){var o,s=i.rotation,r={curX:t.x+e.x*n.w+e.offx,curY:t.y+e.y*n.h+e.offy,x:e.x,y:e.y,ox:0,oy:0};if(null!=s&&s.length>0){var a=[e.iox,e.ioy],l={x:r.curX,y:r.curY,cr:0,sr:0};x(s,(function(e){l=G(l,e.c,e.r);var t=[Math.round(a[0]*l.cr-a[1]*l.sr),Math.round(a[1]*l.cr+a[0]*l.sr)];a=t.slice()})),e.ox=a[0],e.oy=a[1],o={curX:l.x,curY:l.y,x:e.x,y:e.y,ox:a[0],oy:a[1]}}else e.ox=e.iox,e.oy=e.ioy,o=h({ox:e.iox,oy:e.ioy},r);return o}},{key:"_singleAnchorCompute",value:function(e,t){var n=t.xy,i=t.wh,o=t.timestamp,s=this.anchorLocations.get(e.id);if(null!=s&&o&&o===e.timestamp)return s;var r=Z(pn(e),2);r[0];var a=r[1];return s=this._computeSingleLocation(a,n,i,t),this._setComputedPosition(e,s,o)}},{key:"_defaultAnchorCompute",value:function(e,t){var n;if(1===e.locations.length)return this._singleAnchorCompute(e,t);var i=t.xy,o=t.wh,s=t.txy,r=t.twh,a=Z(pn(e),2),l=a[0],c=a[1];if(e.locked||null==s||null==r)n=this._computeSingleLocation(c,i,o,t);else{var u=Z(this._anchorSelector(i,o,s,r,t.rotation,t.tRotation,e.locations),2),h=u[0],d=u[1];e.currentLocation=h,h!==l&&(e.cssClass=d.cls||e.cssClass,t.element._anchorLocationChanged(e)),n=this._computeSingleLocation(d,i,o,t)}return this._setComputedPosition(e,n,t.timestamp)}},{key:"_placeAnchors",value:function(e,t){var n=this,i=this.instance.viewport.getPosition(e),o=function(t,o,s,r,a,l){if(s.length>0)for(var c=s.sort(cn[t]),u=function(e,t,n,i,o){for(var s=n?e.w:e.h,r=n?e.h:e.w,a=[],l=s/(t.length+1),c=0;c<t.length;c++){var u=(c+1)*l,h=i*r;o&&(u=s-u);var d=n?u:h,p=e.x+d,y=d/e.w,v=n?h:u,f=e.y+v,g=v/e.h;if(0!==e.r&&null!=e.r){var m=G({x:p,y:f},e.c,e.r);p=m.x,f=m.y}a.push({x:p,y:f,xLoc:y,yLoc:g,c:t[c].c})}return a}(i,c,r,a,t===pt||t===ht),h=0;h<u.length;h++){var d=u[h].c,p=d.endpoints[0].elementId===e?d.endpoints[0]:d.endpoints[1];n._setComputedPosition(p._anchor,{curX:u[h].x,curY:u[h].y,x:u[h].xLoc,y:u[h].yLoc,ox:l[0],oy:l[1]})}};o(yt,0,t.bottom,!0,1,[0,1]),o(ht,0,t.top,!0,0,[0,-1]),o(dt,0,t.left,!1,0,[-1,0]),o(pt,0,t.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(e,t,n,i,o,s,r,a,l,c,u){var h,d=i.endpoints[r],p=d.id,y=[1,0][r],v={theta:t,order:n,c:i,b:o,elId:s,epId:p},f=e[l],g=d._continuousAnchorEdge?e[d._continuousAnchorEdge]:null;if(g){var m=_(g,(function(e){return e.epId===p}));if(-1!==m){g.splice(m,1);for(var x=0;x<g.length;x++)!0!==(h=g[x].c).placeholder&&c.add(h),u.add(g[x].c.endpoints[r]),u.add(g[x].c.endpoints[y])}}for(var k=0;k<f.length;k++)!0!==(h=f[k].c).placeholder&&c.add(h),u.add(f[k].c.endpoints[r]),u.add(f[k].c.endpoints[y]);var C=a?0:f.length;f.splice(C,0,v),d._continuousAnchorEdge=l}},{key:"_removeEndpointFromAnchorLists",value:function(e){var t=this.anchorLists.get(e.elementId),n=0;!function(e,t){if(e){var i=function(e){return e.epId===t};g(e.top,i),g(e.left,i),g(e.bottom,i),g(e.right,i),n+=e.top.length,n+=e.left.length,n+=e.bottom.length,n+=e.right.length}}(t,e.id),0===n&&this.anchorLists.delete(e.elementId),this.anchorLocations.delete(e._anchor.id)}},{key:"computeAnchorLocation",value:function(e,t){var n;return n=un(e)?this.anchorLocations.get(e.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:hn(e)?this._floatingAnchorCompute(e,t):this._defaultAnchorCompute(e,t),e.timestamp=t.timestamp,n}},{key:"computePath",value:function(e,t){var n=this.instance.viewport.getPosition(e.sourceId),i=this.instance.viewport.getPosition(e.targetId),o=e.endpoints[0],s=e.endpoints[1],r=this.getEndpointLocation(o,{xy:n,wh:n,element:o,timestamp:t,rotation:this.instance._getRotations(e.sourceId)}),a=this.getEndpointLocation(s,{xy:i,wh:i,element:s,timestamp:t,rotation:this.instance._getRotations(e.targetId)});e.connector.resetBounds(),e.connector.compute({sourcePos:r,targetPos:a,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1],strokeWidth:e.paintStyleInUse.strokeWidth,sourceInfo:n,targetInfo:i})}},{key:"getEndpointLocation",value:function(e,t){t=t||{};var n=e._anchor,i=this.anchorLocations.get(n.id);return(null==i||null!=t.timestamp&&n.timestamp!==t.timestamp)&&(i=this.computeAnchorLocation(n,t),this._setComputedPosition(n,i,t.timestamp)),i}},{key:"getEndpointOrientation",value:function(e){return e._anchor?this.getAnchorOrientation(e._anchor):[0,0]}},{key:"setAnchorOrientation",value:function(e,t){var n=this.anchorLocations.get(e.id);null!=n&&(n.ox=t[0],n.oy=t[1])}},{key:"isDynamicAnchor",value:function(e){return!!e._anchor&&!un(e._anchor)&&e._anchor.locations.length>1}},{key:"isFloating",value:function(e){return!!e._anchor&&hn(e._anchor)}},{key:"prepareAnchor",value:function(e){return Dt(e)}},{key:"redraw",value:function(e,t,n){var i=this,o=new Set,s=new Set,r=new Set;if(!this.instance._suspendDrawing){var l=this.instance.endpointsByElement[e]||[];t=t||a();for(var c,u,h={},d=0;d<l.length;d++)if(u=l[d],s.add(u),c=u._anchor,0===u.connections.length)un(c)&&(this.anchorLists.has(e)||this.anchorLists.set(e,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(e),-Math.PI/2,0,{endpoints:[u,u],placeholder:!0},!1,e,0,!1,_t(c),o,s),r.add(e));else for(var p=0;p<u.connections.length;p++){var y=u.connections[p],v=y.sourceId,f=y.targetId,g=un(y.endpoints[0]._anchor),m=un(y.endpoints[1]._anchor);if(g||m){var x=[v,(y.endpoints[0]._anchor.faces||[]).join("-"),f,(y.endpoints[1]._anchor.faces||[]).join("-")].join("-"),k=h[x],_=y.sourceId===e?1:0;g&&!this.anchorLists.has(v)&&this.anchorLists.set(v,{top:[],right:[],bottom:[],left:[]}),m&&!this.anchorLists.has(f)&&this.anchorLists.set(f,{top:[],right:[],bottom:[],left:[]});var C=this.instance.viewport.getPosition(f),b=this.instance.viewport.getPosition(v);if(f===v&&(g||m))this._updateAnchorList(this.anchorLists.get(v),-Math.PI/2,0,y,!1,f,0,!1,ht,o,s),this._updateAnchorList(this.anchorLists.get(f),-Math.PI/2,0,y,!1,v,1,!1,ht,o,s);else{var E=this.instance._getRotations(v),S=this.instance._getRotations(f);k||(k=this._calculateOrientation(v,f,b,C,y.endpoints[0]._anchor,y.endpoints[1]._anchor,E,S),h[x]=k),g&&this._updateAnchorList(this.anchorLists.get(v),k.theta,0,y,!1,f,0,!1,k.a[0],o,s),m&&this._updateAnchorList(this.anchorLists.get(f),k.theta2,-1,y,!0,v,1,!0,k.a[1],o,s)}g&&r.add(v),m&&r.add(f),o.add(y),(g&&0===_||m&&1===_)&&s.add(y.endpoints[_])}else{var P=u.connections[p].endpoints[y.sourceId===e?1:0];if(dn(P._anchor)){this.instance._paintEndpoint(P,{elementWithPrecedence:e,timestamp:t}),o.add(u.connections[p]);for(var w=0;w<P.connections.length;w++)P.connections[w]!==u.connections[p]&&o.add(P.connections[w])}else o.add(u.connections[p])}}r.forEach((function(e){i._placeAnchors(e,i.anchorLists.get(e))})),s.forEach((function(e){var n=i.instance.viewport.getPosition(e.elementId);i.instance._paintEndpoint(e,{timestamp:t,offset:n})})),o.forEach((function(e){i.instance._paintConnection(e,{timestamp:t})}))}return{c:o,e:s}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(e,t){null!=t&&(e._anchor=t)}},{key:"setConnectionAnchors",value:function(e,t){e.endpoints[0]._anchor=t[0],e.endpoints[1]._anchor=t[1]}},{key:"_calculateOrientation",value:function(e,t,n,i,o,s,a,l){var c=this;if(e===t)return{orientation:"identity",a:[ht,ht]};var u=Math.atan2(i.c.y-n.c.y,i.c.x-n.c.x),h=Math.atan2(n.c.y-i.c.y,n.c.x-i.c.x),d=[],p={};!function(e,t){for(var n=0;n<e.length;n++){var i;if(p[e[n]]=(W(i={},dt,{x:t[n][0].x,y:t[n][0].c.y}),W(i,pt,{x:t[n][0].x+t[n][0].w,y:t[n][0].c.y}),W(i,ht,{x:t[n][0].c.x,y:t[n][0].y}),W(i,yt,{x:t[n][0].c.x,y:t[n][0].y+t[n][0].h}),i),null!=t[n][1]&&t[n][1].length>0)for(var o in p[e[n]])p[e[n]][o]=c.instance._applyRotationsXY(p[e[n]][o],t[n][1])}}([me,xe],[[n,a],[i,l]]);for(var y=[ht,dt,pt,yt],v=0;v<y.length;v++)for(var f=0;f<y.length;f++)d.push({source:y[v],target:y[f],dist:r(p.source[y[v]],p.target[y[f]])});d.sort((function(e,t){if(e.dist<t.dist)return-1;if(t.dist<e.dist)return 1;var n,i=(W(n={},dt,0),W(n,ht,1),W(n,pt,2),W(n,yt,3),n),o=i[e.source],s=i[t.source],r=i[e.target],a=i[t.target];return o<s?-1:s<o?1:r<a?-1:a<r?1:0}));for(var g=d[0].source,m=d[0].target,x=0;x<d.length&&(g=un(o)&&o.locked?o.currentFace:!o.isContinuous||bt(o,d[x].source)?d[x].source:null,m=s.isContinuous&&s.locked?s.currentFace:!s.isContinuous||bt(s,d[x].target)?d[x].target:null,null==g||null==m);x++);return o.isContinuous&&this.setCurrentFace(o,g),s.isContinuous&&this.setCurrentFace(s,m),{a:[g,m],theta:u,theta2:h}}},{key:"setCurrentFace",value:function(e,t,n){e.currentFace=t,n&&null!=e.lockedFace&&(e.lockedFace=e.currentFace)}},{key:"lock",value:function(e){e.locked=!0,un(e)&&(e.lockedFace=e.currentFace)}},{key:"unlock",value:function(e){e.locked=!1,un(e)&&(e.lockedFace=null)}},{key:"selectAnchorLocation",value:function(e,t){var n=_(e.locations,(function(e){return e.x===t.x&&e.y===t.y}));return-1!==n&&(e.currentLocation=n,!0)}},{key:"lockCurrentAxis",value:function(e){null!=e.currentFace&&(e.lockedAxis=e.currentFace===dt||e.currentFace===pt?vt:ft)}},{key:"unlockCurrentAxis",value:function(e){e.lockedAxis=null}},{key:"anchorsEqual",value:function(e,t){if(!e||!t)return!1;var n=e.locations[e.currentLocation],i=t.locations[t.currentLocation];return n.x===i.x&&n.y===i.y&&n.offx===i.offx&&n.offy===i.offy&&n.ox===i.ox&&n.oy===i.oy}}]),e}(),vn=function(){function e(n,i){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t(this,e),this.selector=n,this.def=i,this.exclude=o,W(this,"id",void 0),W(this,"redrop",void 0),this.id=a(),this.redrop=i.def.redrop||fn}return H(e,[{key:"setEnabled",value:function(e){this.def.enabled=e}},{key:"isEnabled",value:function(){return!1!==this.def.enabled}}]),e}(),fn=e("j","strict");function gn(e,t,n){var i=[],o=function(t){return d(t)?t:e.getId(t)};if(t)if("string"==typeof t){if("*"===t)return t;i.push(t)}else{var s;n?i=t:null!=t.length?(s=i).push.apply(s,$($(t).map(o))):i.push(o(t))}return i}function mn(e,t,n){null!=t&&(t.connections.push(e),1===t.connections.length&&e.instance.addClass(e.source,e.instance.connectedClass)),null!=n&&(null!=t&&e.sourceId===e.targetId||(n.connections.push(e),1===n.connections.length&&e.instance.addClass(e.target,e.instance.connectedClass)))}function xn(e,t,n){if(null!=t){var i=t.connections.length;g(t.connections,(function(t){return e.id===t.id})),i>0&&0===t.connections.length&&e.instance.removeClass(e.source,e.instance.connectedClass)}if(null!=n){var o=n.connections.length;null!=t&&e.sourceId===e.targetId||g(n.connections,(function(t){return e.id===t.id})),o>0&&0===n.connections.length&&e.instance.removeClass(e.target,e.instance.connectedClass)}}function kn(e){var t=Math.floor(e),n=Math.ceil(e);return e-t<1e-10?t:n-e<1e-10?n:e}e("R","any"),e("k","anySource"),e("l","anyTarget"),e("m","anySourceOrTarget"),e("K",function(e){X(o,e);var i=J(o);function o(e,n){var s;return t(this,o),(s=i.call(this))._instanceIndex=e,W(N(s),"defaults",void 0),W(N(s),"_initialDefaults",{}),W(N(s),"isConnectionBeingDragged",!1),W(N(s),"currentlyDragging",!1),W(N(s),"hoverSuspended",!1),W(N(s),"_suspendDrawing",!1),W(N(s),"_suspendedAt",null),W(N(s),"connectorClass",Se),W(N(s),"connectorOutlineClass","jtk-connector-outline"),W(N(s),"connectedClass","jtk-connected"),W(N(s),"endpointClass",Pe),W(N(s),"endpointConnectedClass","jtk-endpoint-connected"),W(N(s),"endpointFullClass","jtk-endpoint-full"),W(N(s),"endpointFloatingClass",we),W(N(s),"endpointDropAllowedClass","jtk-endpoint-drop-allowed"),W(N(s),"endpointDropForbiddenClass","jtk-endpoint-drop-forbidden"),W(N(s),"endpointAnchorClassPrefix","jtk-endpoint-anchor"),W(N(s),"overlayClass",Te),W(N(s),"connections",[]),W(N(s),"endpointsByElement",{}),W(N(s),"endpointsByUUID",new Map),W(N(s),"sourceSelectors",[]),W(N(s),"targetSelectors",[]),W(N(s),"allowNestedGroups",void 0),W(N(s),"_curIdStamp",1),W(N(s),"viewport",new rn(N(s))),W(N(s),"router",void 0),W(N(s),"groupManager",void 0),W(N(s),"_connectionTypes",new Map),W(N(s),"_endpointTypes",new Map),W(N(s),"_container",void 0),W(N(s),"_managedElements",{}),W(N(s),"DEFAULT_SCOPE",void 0),W(N(s),"_zoom",1),s.defaults={anchor:R.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:ye.type,container:null,endpoint:re.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},n&&h(s.defaults,n),h(s._initialDefaults,s.defaults),null!=s._initialDefaults[Xe]&&(s._initialDefaults[Xe].strokeWidth=s._initialDefaults[Xe].strokeWidth||2),s.DEFAULT_SCOPE=s.defaults.scope,s.allowNestedGroups=!1!==s._initialDefaults.allowNestedGroups,s.router=new yn(N(s)),s.groupManager=new qt(N(s)),s.setContainer(s._initialDefaults.container),s}return H(o,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function(e){return null!=e&&null!=e[0]&&null!=e[1]}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(e,t){return this._zoom=e,this.fire(Re,this._zoom),t&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(e,t){var i=this.getListener(e),o=!0;if(i&&i.length>0){var s=Array.prototype.slice.call(arguments,1);try{for(var r=0,a=i.length;r<a;r++)o=o&&i[r].apply(i[r],s)}catch(l){n("cannot check condition ["+e+"]"+l)}}return o}},{key:"getId",value:function(e,t){if(null==e)return null;var n=this.getAttribute(e,be);return n&&"undefined"!==n||(2===arguments.length&&void 0!==arguments[1]?n=t:(1===arguments.length||3===arguments.length&&!arguments[2])&&(n="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(e,be,n)),n}},{key:"getConnections",value:function(e,t){e?e.constructor===String&&(e={scope:e}):e={};for(var n=gn(this,e.scope||this.defaultScope,!0),i=gn(this,e.source),o=gn(this,e.target),s=!t&&n.length>1?{}:[],r=function(e,i){if(!t&&n.length>1){var o=s[e];null==o&&(o=s[e]=[]),o.push(i)}else s.push(i)},a=0,l=this.connections.length;a<l;a++){var c=this.connections[a],u=c.proxies&&c.proxies[0]?c.proxies[0].originalEp.elementId:c.sourceId,h=c.proxies&&c.proxies[1]?c.proxies[1].originalEp.elementId:c.targetId;C(n,c.scope)&&C(i,u)&&C(o,h)&&r(c.scope,c)}return s}},{key:"select",value:function(e){return(e=e||{}).scope=e.scope||"*",new Zt(this,e.connections||this.getConnections(e,!0))}},{key:"selectEndpoints",value:function(e){(e=e||{}).scope=e.scope||V;var t=!e.element&&!e.source&&!e.target,n=t?V:gn(this,e.element),i=t?V:gn(this,e.source),o=t?V:gn(this,e.target),s=gn(this,e.scope,!0),r=[];for(var a in this.endpointsByElement){var l=C(n,a,!0),c=C(i,a,!0),u="*"!==i,h=C(o,a,!0),d="*"!==o;if(l||c||h)e:for(var p=0,y=this.endpointsByElement[a].length;p<y;p++){var v=this.endpointsByElement[a][p];if(C(s,v.scope,!0)){var f=u&&i.length>0&&!v.isSource,g=d&&o.length>0&&!v.isTarget;if(f||g)continue e;r.push(v)}}}return new Kt(this,r)}},{key:"setContainer",value:function(e){this._container=e,this.fire("container:change",this._container)}},{key:"_set",value:function(e,t,n){var i,o,s=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}][n],r=e[s.elId],a=e.endpoints[n],l={index:n,originalEndpoint:a,originalSourceId:0===n?r:e.sourceId,newSourceId:e.sourceId,originalTargetId:1===n?r:e.targetId,newTargetId:e.targetId,connection:e,newEndpoint:a};return t instanceof Yt?(i=t).addConnection(e):i=(o=this.getId(t))===e[s.elId]?null:e.makeEndpoint(0===n,t,o),null!=i&&(l.newEndpoint=i,a.detachFromConnection(e),e.endpoints[n]=i,e[s.el]=i.element,e[s.elId]=i.elementId,l[0===n?"newSourceId":"newTargetId"]=i.elementId,this.fireMoveEvent(l),this._paintConnection(e)),l}},{key:"setSource",value:function(e,t){xn(e,this._managedElements[e.sourceId]);var n=this._set(e,t,0);mn(e,this._managedElements[n.newSourceId])}},{key:"setTarget",value:function(e,t){xn(e,this._managedElements[e.targetId]);var n=this._set(e,t,1);mn(e,this._managedElements[n.newTargetId])}},{key:"setConnectionType",value:function(e,t,n){e.setType(t,n),this._paintConnection(e)}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(e,t){var n=this._suspendDrawing;return this._suspendDrawing=e,e?this._suspendedAt=""+(new Date).getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),t&&this.repaintEverything(),n}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(e,t){var n=!0===this._suspendDrawing;n||this.setSuspendDrawing(!0),e(),n||this.setSuspendDrawing(!1,!t)}},{key:"each",value:function(e,t){if(null!=e){if(null!=e.length)for(var n=0;n<e.length;n++)t(e[n]);else t(e);return this}}},{key:"updateOffset",value:function(e){var t=e.elId;return e.recalc?this.viewport.refreshElement(t):this.viewport.getPosition(t)}},{key:"deleteConnection",value:function(e,t){if(null!=e&&!0!==e.deleted&&((t=t||{}).force||b(!0,!1,[[e.endpoints[0],Ve,[e]],[e.endpoints[1],Ve,[e]],[e,Ve,[e]],[this,Ee,[He,e]]]))){xn(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this.fireDetachEvent(e,!e.pending&&!1!==t.fireEvent,t.originalEvent);var n=e.endpoints[0],i=e.endpoints[1];return n!==t.endpointToIgnore&&n.detachFromConnection(e,null,!0),i!==t.endpointToIgnore&&i.detachFromConnection(e,null,!0),g(this.connections,(function(t){return e.id===t.id})),e.destroy(),n!==t.endpointToIgnore&&n.deleteOnEmpty&&0===n.connections.length&&this.deleteEndpoint(n),i!==t.endpointToIgnore&&i.deleteOnEmpty&&0===i.connections.length&&this.deleteEndpoint(i),!0}return!1}},{key:"deleteEveryConnection",value:function(e){var t=this;e=e||{};var n=this.connections.length,i=0;return this.batch((function(){for(var o=0;o<n;o++)i+=t.deleteConnection(t.connections[0],e)?1:0})),i}},{key:"deleteConnectionsForElement",value:function(e,t){var n=this.getId(e),i=this._managedElements[n];if(i)for(var o=i.connections.length,s=0;s<o;s++)this.deleteConnection(i.connections[0],t);return this}},{key:"fireDetachEvent",value:function(e,t,n){var i=null!=e.id?{connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]}:e;t&&this.fire(Ge,i,n),this.fire(Fe,i,n)}},{key:"fireMoveEvent",value:function(e,t){this.fire(Le,e,t)}},{key:"manageAll",value:function(e,t){for(var n=d(e)?this.getSelector(this.getContainer(),e):e,i=0;i<n.length;i++)this.manage(n[i],null,t)}},{key:"manage",value:function(e,t,n){null==this.getAttribute(e,be)&&(t=t||this.getAttribute(e,"id")||a(),this.setAttribute(e,be,t));var i=this.getId(e);if(this._managedElements[i])n&&(this._managedElements[i].viewportElement=this.updateOffset({elId:i,timestamp:null,recalc:!0}));else{var o={el:e,endpoints:[],connections:[],rotation:0,data:{}};this._managedElements[i]=o,this._suspendDrawing?o.viewportElement=this.viewport.registerElement(i,!0):o.viewportElement=this.updateOffset({elId:i,recalc:!0}),this.fire("element:manage",{el:e})}return this._managedElements[i]}},{key:"getManagedData",value:function(e,t,n){if(this._managedElements[e]){var i=this._managedElements[e].data[t];return null!=i?i[n]:null}}},{key:"setManagedData",value:function(e,t,n,i){this._managedElements[e]&&(this._managedElements[e].data[t]=this._managedElements[e].data[t]||{},this._managedElements[e].data[t][n]=i)}},{key:"getManagedElement",value:function(e){return this._managedElements[e]?this._managedElements[e].el:null}},{key:"unmanage",value:function(e,t){var n=this;this.removeAllEndpoints(e,!0);var i=function(e){var i=n.getId(e);n.removeAttribute(e,be),delete n._managedElements[i],n.viewport.remove(i),n.fire("element:unmanage",{el:e,id:i}),e&&t&&n._removeElement(e)};this._getAssociatedElements(e).map(i),i(e)}},{key:"rotate",value:function(e,t,n){var i=this.getId(e);return this._managedElements[i]&&(this._managedElements[i].rotation=t,this.viewport.rotateElement(i,t),!0!==n)?this.revalidate(e):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(e){var t=this._managedElements[e];return null!=t&&t.rotation||0}},{key:"_getRotations",value:function(e){var t=this,n=[],i=this._managedElements[e];return null!=i&&(n.push({r:i.viewportElement.r||0,c:i.viewportElement.c}),function e(i){if(null!=i.group){var o=t._managedElements[i.group];null!=o&&(n.push({r:o.viewportElement.r,c:o.viewportElement.c}),e(o))}}(i)),n}},{key:"_applyRotations",value:function(e,t){var n=e.slice(),i={x:n[0],y:n[1],cr:0,sr:0};return x(t,(function(e){i=G(i,e.c,e.r)})),i}},{key:"_applyRotationsXY",value:function(e,t){return x(t,(function(t){e=G(e,t.c,t.r)})),e}},{key:"_internal_newEndpoint",value:function(e){var t=h({},e),n=this.manage(t.element);t.elementId=this.getId(t.element),t.id="ep_"+this._idstamp();var i=new Yt(this,t);return function(e,t){null!=e&&e.endpoints.push(t)}(n,i),e.uuid&&this.endpointsByUUID.set(e.uuid,i),E(this.endpointsByElement,i.elementId,i),this._suspendDrawing||this._paintEndpoint(i,{timestamp:this._suspendedAt}),i}},{key:"_deriveEndpointAndAnchorSpec",value:function(e,t){for(var n=((t?"":"default ")+e).split(/[\s]/),i=null,o=null,s=null,r=null,a=0;a<n.length;a++){var l=this.getConnectionType(n[a]);l&&(l.endpoints&&(i=l.endpoints),l.endpoint&&(o=l.endpoint),l.anchors&&(r=l.anchors),l.anchor&&(s=l.anchor))}return{endpoints:i||[o,o],anchors:r||[s,s]}}},{key:"revalidate",value:function(e,t){var n=this.getId(e);return this.updateOffset({elId:n,recalc:!0,timestamp:t}),this.repaint(e)}},{key:"repaintEverything",value:function(){var e,t=a();for(e in this._managedElements)this.viewport.refreshElement(e,!0);for(e in this.viewport.recomputeBounds(),this._managedElements)this.repaint(this._managedElements[e].el,t,!0);return this}},{key:"setElementPosition",value:function(e,t,n){var i=this.getId(e);return this.viewport.setPosition(i,t,n),this.repaint(e)}},{key:"repaint",value:function(e,t,n){var i={c:new Set,e:new Set},o=function(e){e.c.forEach((function(e){return i.c.add(e)})),e.e.forEach((function(e){return i.e.add(e)}))};if(!this._suspendDrawing){var s=this.getId(e);if(null!=e){var r=this._getAssociatedElements(e);if(null==t&&(t=a()),!n)for(var l=0;l<r.length;l++)this.updateOffset({elId:this.getId(r[l]),recalc:!0,timestamp:t});if(o(this.router.redraw(s,t,null)),r.length>0)for(var c=0;c<r.length;c++)o(this.router.redraw(this.getId(r[c]),t,null))}}return i}},{key:"unregisterEndpoint",value:function(e){var t=e.getUuid();t&&this.endpointsByUUID.delete(t),function(e,t){null!=e&&g(e.endpoints,(function(e){return e===t}))}(this._managedElements[e.elementId],e);var n=this.endpointsByElement[e.elementId];null!=n&&(n.length>1?this.endpointsByElement[e.elementId]=n.filter((function(t){return t!==e})):delete this.endpointsByElement[e.elementId]),this.fire(De,e)}},{key:"_maybePruneEndpoint",value:function(e){return!(!e.deleteOnEmpty||0!==e.connections.length||(this.deleteEndpoint(e),0))}},{key:"deleteEndpoint",value:function(e){var t=this,n="string"==typeof e?this.endpointsByUUID.get(e):e;if(n){var i=n.proxiedBy,o=n.connections.slice();x(o,(function(e){n.detachFromConnection(e,null,!0)})),this.unregisterEndpoint(n),n.destroy(),x(o,(function(e){t.deleteConnection(e,{force:!0,endpointToIgnore:n})})),null!=i&&this.deleteEndpoint(i)}return this}},{key:"addEndpoint",value:function(e,t,n){var i=h({},n=n||{});h(i,t||{});var o=h({element:e},i);return this._internal_newEndpoint(o)}},{key:"addEndpoints",value:function(e,t,n){for(var i=[],o=0,s=t.length;o<s;o++)i.push(this.addEndpoint(e,t[o],n));return i}},{key:"reset",value:function(){var e=this;this.silently((function(){e.endpointsByElement={},e._managedElements={},e.endpointsByUUID.clear(),e.viewport.reset(),e.router.reset(),e.groupManager.reset(),e.connections.length=0}))}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(e){return this.endpointsByElement[this.getId(e)]||[]}},{key:"getEndpoint",value:function(e){return this.endpointsByUUID.get(e)}},{key:"setEndpointUuid",value:function(e,t){e.uuid&&this.endpointsByUUID.delete(e.uuid),e.uuid=t,this.endpointsByUUID.set(t,e)}},{key:"connect",value:function(e,t){try{var i=this._prepareConnectionParams(e,t),o=this._newConnection(i);return this._finaliseConnection(o,i),o}catch(s){return void n(s)}}},{key:"_prepareConnectionParams",value:function(e,t){var n=h({},e);t&&h(n,t);var i=n;if(i.source&&i.source.endpoint&&(i.sourceEndpoint=i.source),i.target&&i.target.endpoint&&(i.targetEndpoint=i.target),e.uuids&&(i.sourceEndpoint=this.getEndpoint(e.uuids[0]),i.targetEndpoint=this.getEndpoint(e.uuids[1])),null!=i.sourceEndpoint){if(i.sourceEndpoint.isFull())throw"Cannot establish connection: source endpoint is full";if(i.type||(i.type=i.sourceEndpoint.edgeType),i.sourceEndpoint.connectorOverlays){i.overlays=i.overlays||[];for(var o=0,s=i.sourceEndpoint.connectorOverlays.length;o<s;o++)i.overlays.push(i.sourceEndpoint.connectorOverlays[o])}i.sourceEndpoint.scope&&(i.scope=i.sourceEndpoint.scope)}else if(null==i.source)throw"Cannot establish connection: source does not exist";if(null!=i.targetEndpoint){if(i.targetEndpoint.isFull())throw"Cannot establish connection: target endpoint is full"}else if(null==i.target)throw"Cannot establish connection: target does not exist";if(i.sourceEndpoint&&i.targetEndpoint&&!function(e,t){for(var n=e.scope.split(/\s/),i=t.scope.split(/\s/),o=0;o<n.length;o++)for(var s=0;s<i.length;s++)if(i[s]===n[o])return!0;return!1}(i.sourceEndpoint,i.targetEndpoint))throw"Cannot establish connection: scopes do not match";return i}},{key:"_newConnection",value:function(e){e.id="con_"+this._idstamp();var t=new Wt(this,e);return mn(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this._paintConnection(t),t}},{key:"_finaliseConnection",value:function(e,t,n){t=t||{},e.suspendedEndpoint||this.connections.push(e),e.pending=null,e.endpoints[0].isTemporarySource=!1,this.repaint(e.source);var i={connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]};this.fire(Me,i,n),t.doNotFireConnectionEvent||!1===t.fireEvent||this.fire(Oe,i,n)}},{key:"removeAllEndpoints",value:function(e,t){var n=this,i=function(e){var t,i,o=n.getId(e),s=n.endpointsByElement[o];if(s)for(t=0,i=s.length;t<i;t++)n.deleteEndpoint(s[t]);delete n.endpointsByElement[o]};return t&&this._getAssociatedElements(e).map(i),i(e),this}},{key:"_createSourceDefinition",value:function(e,t){var n=h({},t);h(n,e),n.edgeType=n.edgeType||B;var i=this._deriveEndpointAndAnchorSpec(n.edgeType);n.endpoint=n.endpoint||i.endpoints[0],n.anchor=n.anchor||i.anchors[0];var o=n.maxConnections||-1;return{def:h({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:o,enabled:!0,endpoint:null}}},{key:"addSourceSelector",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createSourceDefinition(t),o=new vn(e,i,n);return this.sourceSelectors.push(o),o}},{key:"removeSourceSelector",value:function(e){g(this.sourceSelectors,(function(t){return t===e}))}},{key:"removeTargetSelector",value:function(e){g(this.targetSelectors,(function(t){return t===e}))}},{key:"addTargetSelector",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createTargetDefinition(t),o=new vn(e,i,n);return this.targetSelectors.push(o),o}},{key:"_createTargetDefinition",value:function(e,t){var n=h({},t);h(n,e),n.edgeType=n.edgeType||B;var i=n.maxConnections||-1;return{def:h({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:i,enabled:!0,endpoint:null}}},{key:"show",value:function(e,t){return this._setVisible(e,ke,t)}},{key:"hide",value:function(e,t){return this._setVisible(e,_e,t)}},{key:"_setVisible",value:function(e,t,n){var i=t===ke,o=null;n&&(o=function(e){e.setVisible(i,!0,!0)});var s=this.getId(e);return this._operation(e,(function(e){if(i&&n){var t=e.sourceId===s?1:0;e.endpoints[t].isVisible()&&e.setVisible(!0)}else e.setVisible(i)}),o),this}},{key:"toggleVisible",value:function(e,t){var n=null;t&&(n=function(e){var t=e.isVisible();e.setVisible(!t)}),this._operation(e,(function(e){var t=e.isVisible();e.setVisible(!t)}),n)}},{key:"_operation",value:function(e,t,n){var i=this.getId(e),o=this.endpointsByElement[i];if(o&&o.length)for(var s=0,r=o.length;s<r;s++){for(var a=0,l=o[s].connections.length;a<l;a++)if(t(o[s].connections[a]))return;n&&n(o[s])}}},{key:"registerConnectionType",value:function(e,t){if(this._connectionTypes.set(e,h({},t)),t.overlays){for(var n={},i=0;i<t.overlays.length;i++){var o=Ye(t.overlays[i]);n[o.options.id]=o}this._connectionTypes.get(e).overlays=n}}},{key:"registerConnectionTypes",value:function(e){for(var t in e)this.registerConnectionType(t,e[t])}},{key:"registerEndpointType",value:function(e,t){if(this._endpointTypes.set(e,h({},t)),t.overlays){for(var n={},i=0;i<t.overlays.length;i++){var o=Ye(t.overlays[i]);n[o.options.id]=o}this._endpointTypes.get(e).overlays=n}}},{key:"registerEndpointTypes",value:function(e){for(var t in e)this.registerEndpointType(t,e[t])}},{key:"getType",value:function(e,t){return"connection"===t?this.getConnectionType(e):this.getEndpointType(e)}},{key:"getConnectionType",value:function(e){return this._connectionTypes.get(e)}},{key:"getEndpointType",value:function(e){return this._endpointTypes.get(e)}},{key:"importDefaults",value:function(e){for(var t in e)this.defaults[t]=e[t];return null!=this.defaults[Xe]&&(this.defaults[Xe].strokeWidth=this.defaults[Xe].strokeWidth||2),e.container&&this.setContainer(e.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=h({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(e,t,n,i,o){var s,r=null!=e.proxies[t],a=r?e.proxies[t].originalEp.elementId:e.endpoints[t].elementId,l=r?e.proxies[t].originalEp:e.endpoints[t],c=this.getId(n);e.proxies[t]?e.proxies[t].ep.elementId===c?s=e.proxies[t].ep:(e.proxies[t].ep.detachFromConnection(e,t),s=this._internal_newEndpoint({element:n,endpoint:i(e,t),anchor:o(e,t),parameters:{isProxyEndpoint:!0}})):s=this._internal_newEndpoint({element:n,endpoint:i(e,t),anchor:o(e,t),parameters:{isProxyEndpoint:!0}}),s.deleteOnEmpty=!0,e.proxies[t]={ep:s,originalEp:l},this.sourceOrTargetChanged(a,c,e,n,t),l.detachFromConnection(e,null,!0),s.connections=[e],e.endpoints[t]=s,l.proxiedBy=s,l.setVisible(!1),e.setVisible(!0),this.revalidate(n)}},{key:"unproxyConnection",value:function(e,t){if(null!=e.proxies&&null!=e.proxies[t]){var n=e.proxies[t].originalEp.element,i=e.proxies[t].originalEp.elementId,o=e.proxies[t].ep.elementId;e.endpoints[t]=e.proxies[t].originalEp,delete e.proxies[t].originalEp.proxiedBy,this.sourceOrTargetChanged(o,i,e,n,t),e.proxies[t].ep.detachFromConnection(e,null),e.proxies[t].originalEp.addConnection(e),e.isVisible()&&e.proxies[t].originalEp.setVisible(!0),e.proxies[t]=null,-1===_(e.proxies,(function(e){return null!=e}))&&(e.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function(e,t,n,i,o){e!==t&&(0===o?(n.sourceId=t,n.source=i):1===o&&(n.targetId=t,n.target=i),xn(n,this._managedElements[e]),mn(n,this._managedElements[t]))}},{key:"getGroup",value:function(e){return this.groupManager.getGroup(e)}},{key:"getGroupFor",value:function(e){return this.groupManager.getGroupFor(e)}},{key:"addGroup",value:function(e){return this.groupManager.addGroup(e)}},{key:"addToGroup",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return(t=this.groupManager).addToGroup.apply(t,[e,!1].concat(i))}},{key:"collapseGroup",value:function(e){this.groupManager.collapseGroup(e)}},{key:"expandGroup",value:function(e){this.groupManager.expandGroup(e)}},{key:"toggleGroup",value:function(e){this.groupManager.toggleGroup(e)}},{key:"removeGroup",value:function(e,t,n,i){return this.groupManager.removeGroup(e,t,n,i)}},{key:"removeAllGroups",value:function(e,t){this.groupManager.removeAllGroups(e,t,!1)}},{key:"removeFromGroup",value:function(e,t,n){this.groupManager.removeFromGroup(e,n,t),this._appendElement(t,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(t)})}},{key:"_paintEndpoint",value:function(e,t){var n=(t=t||{}).timestamp,i=!(!1===t.recalc);if(!n||e.timestamp!==n){var o=this.viewport.getPosition(e.elementId),s=t.offset?{x:t.offset.x,y:t.offset.y}:{x:o.x,y:o.y};if(null!=s){var r=t.anchorLoc;if(null==r){var a={xy:s,wh:o,element:e,timestamp:n};if(i&&this.router.isDynamicAnchor(e)&&e.connections.length>0){var l=function(e){var n=0;if(null!=t.elementWithPrecedence)for(var i=0;i<e.connections.length;i++)if(e.connections[i].sourceId===t.elementWithPrecedence||e.connections[i].targetId===t.elementWithPrecedence){n=i;break}return e.connections[n]}(e),c=l.endpoints[0]===e?1:0,u=0===c?l.sourceId:l.targetId,h=this.viewport.getPosition(u);a.index=0===c?1:0,a.connection=l,a.txy=h,a.twh=h,a.tElement=l.endpoints[c],a.tRotation=this._getRotations(u)}else e.connections.length>0&&(a.connection=e.connections[0]);a.rotation=this._getRotations(e.elementId),r=this.router.computeAnchorLocation(e._anchor,a)}for(var d in e.endpoint.compute(r,this.router.getEndpointOrientation(e),e.paintStyleInUse),this.renderEndpoint(e,e.paintStyleInUse),e.timestamp=n,e.overlays)if(e.overlays.hasOwnProperty(d)){var p=e.overlays[d];p.isVisible()&&(e.overlayPlacements[d]=this.drawOverlay(p,e.endpoint,e.paintStyleInUse,e.getAbsoluteOverlayPosition(p)),this._paintOverlay(p,e.overlayPlacements[d],{xmin:0,ymin:0}))}}}}},{key:"_paintConnection",value:function(e,t){if(!this._suspendDrawing&&!1!==e.visible){var n=(t=t||{}).timestamp;if(null!=n&&n===e.lastPaintedAt)return;if(null==n||n!==e.lastPaintedAt){this.router.computePath(e,n);var i={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(var o in e.overlays)if(e.overlays.hasOwnProperty(o)){var s=e.overlays[o];s.isVisible()&&(e.overlayPlacements[o]=this.drawOverlay(s,e.connector,e.paintStyleInUse,e.getAbsoluteOverlayPosition(s)),i.xmin=Math.min(i.xmin,e.overlayPlacements[o].xmin),i.xmax=Math.max(i.xmax,e.overlayPlacements[o].xmax),i.ymin=Math.min(i.ymin,e.overlayPlacements[o].ymin),i.ymax=Math.max(i.ymax,e.overlayPlacements[o].ymax))}var r=parseFloat(""+e.paintStyleInUse.strokeWidth||"1")/2,a=parseFloat(""+e.paintStyleInUse.strokeWidth||"0"),l={xmin:Math.min(e.connector.bounds.xmin-(r+a),i.xmin),ymin:Math.min(e.connector.bounds.ymin-(r+a),i.ymin),xmax:Math.max(e.connector.bounds.xmax+(r+a),i.xmax),ymax:Math.max(e.connector.bounds.ymax+(r+a),i.ymax)};for(var c in this.paintConnector(e.connector,e.paintStyleInUse,l),e.overlays)if(e.overlays.hasOwnProperty(c)){var u=e.overlays[c];u.isVisible()&&this._paintOverlay(u,e.overlayPlacements[c],l)}}e.lastPaintedAt=n}}},{key:"_refreshEndpoint",value:function(e){e._anchor.isFloating||(e.connections.length>0?this.addEndpointClass(e,this.endpointConnectedClass):this.removeEndpointClass(e,this.endpointConnectedClass),e.isFull()?this.addEndpointClass(e,this.endpointFullClass):this.removeEndpointClass(e,this.endpointFullClass))}},{key:"_makeConnector",value:function(e,t,n){return fe.get(e,t,n)}},{key:"addOverlay",value:function(e,t,n){if(e.addOverlay(t),!n){var i=e instanceof Yt?e.element:e.source;this.revalidate(i)}}},{key:"removeOverlay",value:function(e,t){e.removeOverlay(t);var n=e instanceof Yt?e.element:e.source;this.revalidate(n)}},{key:"setOutlineColor",value:function(e,t){e.paintStyleInUse.outlineStroke=t,this._paintConnection(e)}},{key:"setOutlineWidth",value:function(e,t){e.paintStyleInUse.outlineWidth=t,this._paintConnection(e)}},{key:"setColor",value:function(e,t){e.paintStyleInUse.stroke=t,this._paintConnection(e)}},{key:"setLineWidth",value:function(e,t){e.paintStyleInUse.strokeWidth=t,this._paintConnection(e)}},{key:"setLineStyle",value:function(e,t){null!=t.lineWidth&&(e.paintStyleInUse.strokeWidth=t.lineWidth),null!=t.outlineWidth&&(e.paintStyleInUse.outlineWidth=t.outlineWidth),null!=t.color&&(e.paintStyleInUse.stroke=t.color),null!=t.outlineColor&&(e.paintStyleInUse.outlineStroke=t.outlineColor),this._paintConnection(e)}},{key:"getPathData",value:function(e){for(var t="",n=0;n<e.segments.length;n++)t+=e.segments[n].getPath(0===n),t+=" ";return t}}]),o}(l));var _n=e("W",function(e){X(i,e);var n=J(i);function i(e){var o;t(this,i),W(N(o=n.call(this,e)),"type",i.segmentType),W(N(o),"cx",void 0),W(N(o),"cy",void 0),W(N(o),"radius",void 0),W(N(o),"anticlockwise",void 0),W(N(o),"startAngle",void 0),W(N(o),"endAngle",void 0),W(N(o),"sweep",void 0),W(N(o),"length",void 0),W(N(o),"circumference",void 0),W(N(o),"frac",void 0),o.cx=e.cx,o.cy=e.cy,o.radius=e.r,o.anticlockwise=e.ac,e.startAngle&&e.endAngle?(o.startAngle=e.startAngle,o.endAngle=e.endAngle,o.x1=o.cx+o.radius*Math.cos(o.startAngle),o.y1=o.cy+o.radius*Math.sin(o.startAngle),o.x2=o.cx+o.radius*Math.cos(o.endAngle),o.y2=o.cy+o.radius*Math.sin(o.endAngle)):(o.startAngle=o._calcAngle(o.x1,o.y1),o.endAngle=o._calcAngle(o.x2,o.y2)),o.endAngle<0&&(o.endAngle+=S),o.startAngle<0&&(o.startAngle+=S);var s=o.endAngle<o.startAngle?o.endAngle+S:o.endAngle;return o.sweep=Math.abs(s-o.startAngle),o.anticlockwise&&(o.sweep=S-o.sweep),o.circumference=2*Math.PI*o.radius,o.frac=o.sweep/S,o.length=o.circumference*o.frac,o.extents={xmin:o.cx-o.radius,xmax:o.cx+o.radius,ymin:o.cy-o.radius,ymax:o.cy+o.radius},o}return H(i,[{key:"_calcAngle",value:function(e,t){return P({x:this.cx,y:this.cy},{x:e,y:t})}},{key:"_calcAngleForLocation",value:function(e,t){if(e.anticlockwise){var n=e.startAngle<e.endAngle?e.startAngle+S:e.startAngle;return n-Math.abs(n-e.endAngle)*t}var i=e.endAngle<e.startAngle?e.endAngle+S:e.endAngle,o=Math.abs(i-e.startAngle);return e.startAngle+o*t}},{key:"getPath",value:function(e){var t=this.sweep>Math.PI?1:0,n=this.anticlockwise?0:1;return(e?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+t+","+n+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(e,t){if(0===e)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===e)return{x:this.x2,y:this.y2,theta:this.endAngle};t&&(e/=length);var n=this._calcAngleForLocation(this,e),i=this.cx+this.radius*Math.cos(n),o=this.cy+this.radius*Math.sin(n);return{x:kn(i),y:kn(o),theta:n}}},{key:"gradientAtPoint",value:function(e,t){var n=this.pointOnPath(e,t),i=w({x:this.cx,y:this.cy},n);return this.anticlockwise||i!==1/0&&i!==-1/0||(i*=-1),i}},{key:"pointAlongPathFrom",value:function(e,t,n){var i=this.pointOnPath(e,n),o=t/this.circumference*2*Math.PI,s=this.anticlockwise?-1:1,r=i.theta+s*o;return{x:this.cx+this.radius*Math.cos(r),y:this.cy+this.radius*Math.sin(r)}}}]),i}(j));W(_n,"segmentType","Arc");var Cn=function(e){X(i,e);var n=J(i);function i(e,o,s){var r;return t(this,i),(r=n.call(this,e,o,s)).instance=e,r.component=o,W(N(r),"width",void 0),W(N(r),"length",void 0),W(N(r),"foldback",void 0),W(N(r),"direction",void 0),W(N(r),"location",.5),W(N(r),"paintStyle",void 0),W(N(r),"type",i.type),W(N(r),"cachedDimensions",void 0),s=s||{},r.width=s.width||20,r.length=s.length||20,r.direction=(s.direction||1)<0?-1:1,r.foldback=s.foldback||.623,r.paintStyle=s.paintStyle||{strokeWidth:1},r.location=null==s.location?r.location:Array.isArray(s.location)?s.location[0]:s.location,r}return H(i,[{key:"draw",value:function(e,t,n){if(e instanceof de){var i,o,r,a,l=e;if(this.location>1||this.location<0){var c=this.location<0?1:0;i=l.pointAlongPathFrom(c,this.location,!1),o=l.pointAlongPathFrom(c,this.location-this.direction*this.length/2,!1),r=s(i,o,this.length)}else if(1===this.location){if(i=l.pointOnPath(this.location),o=l.pointAlongPathFrom(this.location,-this.length),r=s(i,o,this.length),-1===this.direction){var u=r;r=i,i=u}}else if(0===this.location){if(r=l.pointOnPath(this.location),o=l.pointAlongPathFrom(this.location,this.length),i=s(r,o,this.length),-1===this.direction){var h=r;r=i,i=h}}else i=l.pointAlongPathFrom(this.location,this.direction*this.length/2),o=l.pointOnPath(this.location),r=s(i,o,this.length);var d={hxy:i,tail:a=A(i,r,this.width),cxy:s(i,r,this.foldback*this.length)},p=this.paintStyle.stroke||t.stroke,y=this.paintStyle.fill||t.stroke;return{component:e,d:d,"stroke-width":this.paintStyle.strokeWidth||t.strokeWidth,stroke:p,fill:y,xmin:Math.min(i.x,a[0].x,a[1].x),xmax:Math.max(i.x,a[0].x,a[1].x),ymin:Math.min(i.y,a[0].y,a[1].y),ymax:Math.max(i.y,a[0].y,a[1].y)}}}},{key:"updateFrom",value:function(e){}}]),i}(ze);W(Cn,"type","Arrow"),Je(Cn.type,Cn);var bn=function(e){X(i,e);var n=J(i);function i(e,o,s){var r;return t(this,i),(r=n.call(this,e,o,s)).instance=e,W(N(r),"type",i.type),r.foldback=1,r}return i}(Cn);W(bn,"type","PlainArrow"),Je("PlainArrow",bn);var En=function(e){X(i,e);var n=J(i);function i(e,o,s){var r;return t(this,i),(r=n.call(this,e,o,s)).instance=e,W(N(r),"type",i.type),r.length=r.length/2,r.foldback=2,r}return i}(Cn);W(En,"type","Diamond"),Je(En.type,En);var Sn=function(e){X(i,e);var n=J(i);function i(e,o,s){var r;return t(this,i),(r=n.call(this,e,o,s)).instance=e,r.component=o,W(N(r),"create",void 0),W(N(r),"type",i.type),r.create=s.create,r}return H(i,[{key:"updateFrom",value:function(e){}}]),i}(ze);W(Sn,"type","Custom"),Je(Sn.type,Sn),oe.registerHandler(ae),oe.registerHandler(he),oe.registerHandler(ce),fe.register(ye.type,ye)}}}));
//# sourceMappingURL=core-legacy-3789fada.js.map
