System.register(["./core-legacy-3789fada.js","./util-legacy-b5c07987.js","./common-legacy-1cf8cb8a.js"],(function(e,t){"use strict";var n,i,r,o,s,a,l,c,u,h,d,p,g,f,v,_,m,y,b,k,E,x,C,P,D,S,j,w,M,T,A,G,I,O,F,N,L,H,z,R,B,V,W,Z,q,J,X,Y,U,K,Q,$,ee,te,ne,ie,re,oe,se,ae,le,ce,ue,he,de,pe,ge,fe,ve,_e,me,ye;return{setters:[e=>{n=e.c,i=e.a,r=e.C,o=e.b,s=e.A,a=e.d,l=e.E,c=e.S,u=e.e,h=e.f,d=e.T,p=e.I,g=e.g,f=e.h,v=e.i,_=e.R,m=e.j,y=e.k,b=e.l,k=e.m,E=e.n,x=e.o,C=e.p,P=e.q,D=e.r,S=e.s,j=e.t,w=e.N,M=e.O,T=e.B,A=e.u,G=e.v,I=e.w,O=e.F,F=e.x,N=e.y,L=e.z,H=e.D,z=e.G,R=e.H,B=e.J,V=e.K,W=e.L,Z=e.M,q=e.P,J=e.Q,X=e.U},e=>{Y=e.r,U=e.u,K=e.s,Q=e.i,$=e.e,ee=e.f,te=e.a,ne=e.w,ie=e.g,re=e.m,oe=e.b,se=e.c,ae=e.d,le=e.h,ce=e.j,ue=e.l,he=e.k,de=e.n,pe=e.o,ge=e.p,fe=e.q},e=>{ve=e.F,_e=e.T,me=e.U,ye=e.W}],execute:function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ke(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ee(e,t,n){return t&&ke(e.prototype,t),n&&ke(e,n),e}function xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&De(e,t)}function Pe(e){return Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Pe(e)}function De(e,t){return De=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},De(e,t)}function Se(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function je(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?Se(e):t}function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Pe(e);if(t){var r=Pe(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return je(this,n)}}function Me(e,t,n){return Me="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pe(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}},Me(e,t,n||e)}function Te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(l){a=!0,r=l}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return o}}(e,t)||Ge(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ae(e){return function(e){if(Array.isArray(e))return Ie(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ge(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ge(e,t){if(e){if("string"==typeof e)return Ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ie(e,t):void 0}}function Ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Oe(e,t,n){for(var i=(n=n||e.parentNode).querySelectorAll(t),r=0;r<i.length;r++)if(i[r]===e)return!0;return!1}function Fe(e,t){e.stopPropagation?e.stopPropagation():e.returnValue=!1,!t&&e.preventDefault&&e.preventDefault()}function Ne(e,t,n,i){if(i&&Oe(e,t,n))return e;for(e=e.parentNode;null!=e&&e!==n;){if(Oe(e,t))return e;e=e.parentNode}}function Le(e){return e.srcElement||e.target}function He(e){return null!=e.className?void 0===e.className.baseVal?e.className:e.className.baseVal:""}function ze(e,t,n){var i=null==t?[]:Array.isArray(t)?t:t.split(/\s+/),r=null==n?[]:Array.isArray(n)?n:n.split(/\s+/),o=He(e).split(/\s+/),s=function(e,t){for(var n=0;n<t.length;n++)if(e)-1===o.indexOf(t[n])&&o.push(t[n]);else{var i=o.indexOf(t[n]);-1!==i&&o.splice(i,1)}};s(!0,i),s(!1,r),function(e,t,n){t=fe(t),void 0!==e.className.baseVal?e.className.baseVal=t:e.className=t;try{var i=e.classList;if(null!=i){for(;i.length>0;)i.remove(i.item(0));for(var r=0;r<n.length;r++)n[r]&&i.add(n[r])}}catch(o){ue("WARN: cannot set class list",o)}}(e,o.join(" "),o)}function Re(e){return!Q(e)&&!Array.isArray(e)&&null!=e.length&&null==e.documentElement&&null==e.nodeType}function Be(e,t){var n=function(e,t){if(null!=e&&null!=t&&t.length>0)if(e.classList){var n=fe(t).split(/\s+/);ee(n,(function(t){e.classList.add(t)}))}else ze(e,t)};Re(e)?ee(e,(function(e){return n(e,t)})):n(e,t)}function Ve(e,t){var n=function(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?fe(t).split(/\s+/).forEach((function(t){e.classList.remove(t)})):ze(e,null,t))};Re(e)?ee(e,(function(e){return n(e,t)})):n(e,t)}function We(e,t,n,i){return Ze(null,e,t,n,i)}function Ze(e,t,n,i,r){var o,s=null==e?document.createElement(t):document.createElementNS(e,t);for(o in n=n||{})s.style[o]=n[o];for(o in i&&(s.className=i),r=r||{})s.setAttribute(o,""+r[o]);return s}function qe(e){var t=e.getBoundingClientRect(),n=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||n.scrollTop,o=window.pageXOffset||i.scrollLeft||n.scrollLeft,s=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,l=t.top+r-s,c=t.left+o-a;return{x:Math.round(c),y:Math.round(l)}}function Je(e,t){var n=t.getContainer().getBoundingClientRect(),i=e.getBoundingClientRect(),r=t.currentZoom;return{x:(i.left-n.left)/r,y:(i.top-n.top)/r}}function Xe(e,t){var n=e.getBoundingClientRect(),i=t.currentZoom;return{w:n.width/i,h:n.height/i}}var Ye;function Ue(e){return e instanceof SVGElement?Ye.SVG:Ye.HTML}e({g:We,i:Ci,n:function(e){return new Gi((t=Oi+1,Oi++,t),e);var t},r:function(e){!function t(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?e():setTimeout(t,9)}()}}),function(e){e.SVG="SVG",e.HTML="HTML"}(Ye||(Ye={}));var Ke={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},Qe="stroke-dasharray",$e="dashstyle",et="svg",tt="path",nt={svg:"http://www.w3.org/2000/svg"};function it(e,t){for(var n in t)e.setAttribute(n,""+t[n])}function rt(e,t){return(t=t||{}).version="1.1",t.xmlns=nt.svg,Ze(nt.svg,e,null,null,t)}function ot(e){return"position:absolute;left:"+e[0]+"px;top:"+e[1]+"px"}function st(e,t,n){if(t.setAttribute("fill",n.fill?n.fill:w),t.setAttribute("stroke",n.stroke?n.stroke:w),n.strokeWidth&&t.setAttribute("stroke-width",n.strokeWidth),n[$e]&&n.strokeWidth&&!n[Qe]){var i=-1===n[$e].indexOf(",")?" ":",",r=n[$e].split(i),o="";ee(r,(function(e){o+=Math.floor(e*n.strokeWidth)+i})),t.setAttribute(Qe,o)}else n[Qe]&&t.setAttribute(Qe,n[Qe]);for(var s in Ke)n[s]&&t.setAttribute(Ke[s],n[s])}function at(e,t,n){e.childNodes.length>n?e.insertBefore(t,e.childNodes[n]):e.appendChild(t)}function lt(e,t,n){var i=[e,t];return n&&i.push(n),i.join(":")}e("s",{attr:it,node:rt,ns:nt});var ct="data-jtk-container",ut="data-jtk-enabled",ht="data-jtk-scope",dt="endpoint",pt="element",gt="connection",ft="click",vt="contextmenu",_t="dblclick",mt="dbltap",yt="mousedown",bt="mouseenter",kt="mouseexit",Et="mousemove",xt="mouseup",Ct="mouseout",Pt="mouseover",Dt="tap",St=e("a","drag:move"),jt="revert",wt=e("E","connection:abort"),Mt=e("f","connection:drag"),Tt=lt(pt,ft),At=lt(pt,_t),Gt=lt(pt,mt),It=lt(pt,Ct),Ot=lt(pt,Pt),Ft=lt(pt,Et),Nt=lt(pt,xt),Lt=lt(pt,yt),Ht=lt(pt,vt),zt=lt(pt,Dt),Rt=e("h",lt(dt,ft)),Bt=lt(dt,_t);lt(dt,mt);var Vt=e("e",lt(dt,Ct)),Wt=e("d",lt(dt,Pt)),Zt=lt(dt,xt),qt=lt(dt,yt);lt(dt,Dt);var Jt,Xt,Yt=lt(gt,ft),Ut=lt(gt,_t),Kt=lt(gt,mt),Qt=e("c",lt(gt,Ct)),$t=e("b",lt(gt,Pt)),en=lt(gt,xt),tn=lt(gt,yt),nn=lt(gt,vt),rn=lt(gt,Dt),on="position",sn=n(r),an=n(o),ln=i(s),cn=i("data-jtk-group-content"),un=n(a);function hn(e,t,n,i,r,o,s){return function(){var e=[];return e.push.apply(e,arguments),e.item=function(e){return this[e]},e}(function(e,t,n,i,r,o,s){return new Touch({target:e,identifier:U(),pageX:t,pageY:n,screenX:i,screenY:r,clientX:o||i,clientY:s||r})}(e,t,n,i,r,o,s))}function dn(e,t,n){for(var i=(n=n||e.parentNode).querySelectorAll(t),r=0;r<i.length;r++)if(i[r]===e)return!0;return!1}function pn(e){return e.srcElement||e.target}function gn(e,t,n,i){if(i){var r=e.composedPath?e.composedPath():e.path;if(void 0!==r&&r.indexOf)return{path:r,end:r.indexOf(n)};var o={path:[],end:-1};return function e(t){o.path.push(t),t===n?o.end=o.path.length-1:null!=t.parentNode&&e(t.parentNode)}(t),o}return{path:[t],end:1}}var fn=1;function vn(){return"ontouchstart"in document.documentElement||null!=navigator.maxTouchPoints&&navigator.maxTouchPoints>0}function _n(){return"onmousedown"in document.documentElement}var mn=(xe(Jt={},yt,"touchstart"),xe(Jt,xt,"touchend"),xe(Jt,Et,"touchmove"),Jt);function yn(e,t){if(null==e)return{x:0,y:0};var n=function(e,t){return e.item?e.item(t):e[t]}(kn(e),0);return{x:n[t+"X"],y:n[t+"Y"]}}function bn(e){return yn(e,"page")}function kn(e){return e.touches&&e.touches.length>0?e.touches:e.changedTouches&&e.changedTouches.length>0?e.changedTouches:e.targetTouches&&e.targetTouches.length>0?e.targetTouches:[e]}function En(e,t,n,i,r){if(Pn(e,t,n),i.__tauid=n.__tauid,e.addEventListener)e.addEventListener(t,n,!1,r);else if(e.attachEvent){var o=t+n.__tauid;e["e"+o]=n,e[o]=function(){e["e"+o]&&e["e"+o](window.event)},e.attachEvent("on"+t,e[o])}}function xn(e,t,n){var i=this;null!=n&&Cn(e,(function(r){if(function(e,t,n){if(e.__ta&&e.__ta[t]&&delete e.__ta[t][n.__tauid],n.__taExtra){for(var i=0;i<n.__taExtra.length;i++)xn(e,n.__taExtra[i][0],n.__taExtra[i][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(r,t,n),null!=n.__tauid)if(r.removeEventListener)r.removeEventListener(t,n,!1),vn()&&mn[t]&&r.removeEventListener(mn[t],n,!1);else if(i.detachEvent){var o=t+n.__tauid;r[o]&&r.detachEvent("on"+t,r[o]),r[o]=null,r["e"+o]=null}n.__taTouchProxy&&xn(e,n.__taTouchProxy[1],n.__taTouchProxy[0])}))}function Cn(e,t){if(null!=e)for(var n="string"==typeof e?document.querySelectorAll(e):null!=e.length?e:[e],i=0;i<n.length;i++)t(n[i])}function Pn(e,t,n){var i=fn++;return e.__ta=e.__ta||{},e.__ta[t]=e.__ta[t]||{},e.__ta[t][i]=n,n.__tauid=i,i}var Dn=/:not\(([^)]+)\)/;function Sn(e,t,n,i){if(null==e)return n;var r=e.split(","),o=[],s=[];ee(r,(function(e){var t=e.match(Dn);null!=t?s.push(t[1]):o.push(e)})),s.length>0&&0===o.length&&o.push(ye);var a=function i(r){i.__tauid=n.__tauid;var a=pn(r),l=!1,c=a,u=gn(r,a,t,null!=e);if(-1!=u.end)for(var h=0;!l&&h<u.end;h++){c=u.path[h];for(var d=0;d<s.length;d++)if(dn(c,s[d],t))return;for(var p=0;!l&&p<o.length;p++)if(dn(c,o[p],t)){n.apply(c,[r,c]),l=!0;break}}};return function(e,t,n){e.__taExtra=e.__taExtra||[],e.__taExtra.push([t,n])}(n,i,a),a}var jn=function(e,t,n,i,r){if(vn()&&mn[t]){var o=Sn(i,e,n,mn[t]);En(e,mn[t],o,n,r)}"focus"===t&&null==e.getAttribute(J)&&e.setAttribute(J,"1"),En(e,t,Sn(i,e,n,t),n,r)},wn=(xe(Xt={},Dt,{touches:1,taps:1}),xe(Xt,mt,{touches:1,taps:2}),xe(Xt,vt,{touches:2,taps:1}),Xt);function Mn(e,t,n,i){for(var r in n.__tamee[e])n.__tamee[e].hasOwnProperty(r)&&n.__tamee[e][r].apply(i,[t])}var Tn=function(){function e(){be(this,e)}return Ee(e,null,[{key:"generate",value:function(e,t){return function(n,i,r,o){if(i==vt&&_n())jn(n,i,r,o);else{if(null==n.__taTapHandler){var s=n.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},a=function(i){for(var r=pn(i),a=gn(i,r,n,null!=o),l=!1,h=0;h<a.end;h++){if(l)return;r=a.path[h];for(var d=0;d<s.downSelectors.length;d++)if(null==s.downSelectors[d]||dn(r,s.downSelectors[d],n)){s.down=!0,setTimeout(c,e),setTimeout(u,t),l=!0;break}}},l=function(e){if(s.down){var t,i,r=pn(e);s.taps++;var o=function(e){return kn(e).length}(e);for(var a in wn)if(wn.hasOwnProperty(a)){var l=wn[a];if(l.touches===o&&(1===l.taps||l.taps===s.taps))for(var c=0;c<s[a].length;c++){i=gn(e,r,n,null!=s[a][c][1]);for(var u=0;u<i.end;u++)if(t=i.path[u],null==s[a][c][1]||dn(t,s[a][c][1],n)){s[a][c][0].apply(t,[e,t]);break}}}}},c=function(){s.down=!1},u=function(){s.taps=0};n.__taTapHandler.downHandler=a,n.__taTapHandler.upHandler=l,jn(n,yt,a),jn(n,xt,l)}n.__taTapHandler.downSelectors.push(o),n.__taTapHandler[i].push([r,o]),r.__taUnstore=function(){null!=n.__taTapHandler&&(Y(n.__taTapHandler.downSelectors,(function(e){return e===o})),function(e,t){var n,i=0;for(i=0,n=e.length;i<n&&e[i][0]!==t;i++);i<e.length&&e.splice(i,1)}(n.__taTapHandler[i],r),0===n.__taTapHandler.downSelectors.length&&(xn(n,yt,n.__taTapHandler.downHandler),xn(n,xt,n.__taTapHandler.upHandler),delete n.__taTapHandler))}}}}}]),e}(),An=function(){function e(){be(this,e)}return Ee(e,null,[{key:"generate",value:function(){var e=[];return function(t,n,i,r){if(!t.__tamee){t.__tamee={over:!1,mouseenter:[],mouseexit:[]};var o=function(n){var i=pn(n);(null==r&&i==t&&!t.__tamee.over||dn(i,r,t)&&(null==i.__tamee||!i.__tamee.over))&&(Mn(bt,n,t,i),i.__tamee=i.__tamee||{},i.__tamee.over=!0,e.push(i))},s=function(n){for(var i=pn(n),r=0;r<e.length;r++)i!=e[r]||dn(n.relatedTarget||n.toElement,"*",i)||(i.__tamee.over=!1,e.splice(r,1),Mn(kt,n,t,i))};En(t,Pt,Sn(r,t,o,Pt),o),En(t,Ct,Sn(r,t,s,Ct),s)}i.__taUnstore=function(){delete t.__tamee[n][i.__tauid]},Pn(t,n,i),t.__tamee[n][i.__tauid]=i}}}]),e}(),Gn=function(){function e(t){be(this,e),xe(this,"clickThreshold",void 0),xe(this,"dblClickThreshold",void 0),xe(this,"tapHandler",void 0),xe(this,"mouseEnterExitHandler",void 0),t=t||{},this.clickThreshold=t.clickThreshold||250,this.dblClickThreshold=t.dblClickThreshold||450,this.mouseEnterExitHandler=An.generate(),this.tapHandler=Tn.generate(this.clickThreshold,this.dblClickThreshold)}return Ee(e,[{key:"_doBind",value:function(e,t,n,i,r){if(null!=n){var o=e;t===Dt||t===mt||t===vt?this.tapHandler(o,t,n,i,r):t===bt||t==kt?this.mouseEnterExitHandler(o,t,n,i,r):jn(o,t,n,i,r)}}},{key:"on",value:function(e,t,n,i,r){var o=null==i?null:n,s=null==i?n:i;return this._doBind(e,t,s,o,r),this}},{key:"off",value:function(e,t,n){return xn(e,t,n),this}},{key:"trigger",value:function(e,t,n,i,r){var o=_n()&&("undefined"==typeof MouseEvent||null==n||n.constructor===MouseEvent),s=vn()&&!_n()&&mn[t]?mn[t]:t,a=!(vn()&&!_n()&&mn[t]),l=bn(n),c=yn(n,"screen"),u=function(e){return yn(e,"client")}(n);return Cn(e,(function(e){var h;n=n||{screenX:c.x,screenY:c.y,clientX:u.x,clientY:u.y};var d,p={TouchEvent:function(t){var n=hn(e,l.x,l.y,c.x,c.y,u.x,u.y);(t.initTouchEvent||t.initEvent)(s,!0,!0,window,null,c.x,c.y,u.x,u.y,!1,!1,!1,!1,n,n,n,1,0)},MouseEvents:function(t){t.initMouseEvent(s,!0,!0,window,null==r?1:r,c.x,c.y,u.x,u.y,!1,!1,!1,!1,1,e)}},g=!a&&!o&&vn()&&mn[t]?"TouchEvent":"MouseEvents";h=document.createEvent(g),p[g](h),d=h,i&&(d.payload=i),e.dispatchEvent(h)})),this}}]),e}();function In(e,t,n){if(Oe(t,n,e))return t;for(var i=t.parentNode;null!=i&&i!==e;){if(Oe(i,n,e))return i;i=i.parentNode}}function On(e,t,n){var i=t.parentNode,r=e.getSize(i),o=e.getSize(t),s=n.x,a=s+o.w,l=n.y,c=l+o.h;return a>0&&s<r.w&&c>0&&l<r.h}var Fn,Nn="start",Ln="beforeStart",Hn="drag",zn="stop",Rn="katavorio-draggable",Bn=function(){return!0},Vn=function(){return!1},Wn="katavorio-delegated-draggable",Zn="katavorio-drag-no-select",qn="katavorio-ghost-proxy",Jn="katavorio-clone-drag";!function(e){e.absolutePosition="absolutePosition",e.transform="transform",e.xyAttributes="xyAttributes"}(Fn||(Fn={}));var Xn=new Map;Xn.set(Fn.absolutePosition,(function(e,t){e.style.left="".concat(t.x,"px"),e.style.top="".concat(t.y,"px")})),Xn.set(Fn.xyAttributes,(function(e,t){e.setAttribute("x","".concat(t.x)),e.setAttribute("y","".concat(t.y))}));var Yn=new Map;Yn.set(Fn.absolutePosition,(function(e){return{x:e.offsetLeft,y:e.offsetTop}})),Yn.set(Fn.xyAttributes,(function(e){return{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y"))}}));var Un=new Map;Un.set(Fn.absolutePosition,(function(e,t){e.style.width="".concat(t.w,"px"),e.style.height="".concat(t.h,"px")})),Un.set(Fn.xyAttributes,(function(e,t){e.setAttribute("width","".concat(t.w)),e.setAttribute("height","".concat(t.h))}));var Kn=new Map;Kn.set(Fn.absolutePosition,(function(e){return{w:e.offsetWidth,h:e.offsetHeight}})),Kn.set(Fn.xyAttributes,(function(e){return{w:parseFloat(e.getAttribute("width")),h:parseFloat(e.getAttribute("height"))}}));var Qn,$n=[zn,Nn,Hn,"drop","over","out",Ln],ei=function(){},ti=function(e,t){if(null!=e){e=Q(e)||null!=e.tagName||null==e.length?[e]:e;for(var n=0;n<e.length;n++)t.apply(e[n],[e[n]])}},ni=function(){function e(t,n){be(this,e),this.el=t,this.manager=n,xe(this,"_class",void 0),xe(this,"uuid",U()),xe(this,"enabled",!0),xe(this,"scopes",[]),xe(this,"eventManager",void 0),this.eventManager=n.eventManager}return Ee(e,[{key:"setEnabled",value:function(e){this.enabled=e}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(e){var t={};for(var n in ti(this.scopes,(function(e){t[e]=!0})),ti(e?e.split(/\s+/):[],(function(e){t[e]=!0})),this.scopes.length=0,t)this.scopes.push(n)}},{key:"removeScope",value:function(e){var t={};for(var n in ti(this.scopes,(function(e){t[e]=!0})),ti(e?e.split(/\s+/):[],(function(e){delete t[e]})),this.scopes.length=0,t)this.scopes.push(n)}},{key:"toggleScope",value:function(e){var t={};for(var n in ti(this.scopes,(function(e){t[e]=!0})),ti(e?e.split(/\s+/):[],(function(e){t[e]?delete t[e]:t[e]=!0})),this.scopes.length=0,t)this.scopes.push(n)}}]),e}();!function(e){e.notNegative="notNegative",e.parent="parent",e.parentEnclosed="parentEnclosed"}(Qn||(Qn={}));var ii=function(e){Ce(n,e);var t=we(n);function n(e,i,r){var o;if(be(this,n),xe(Se(o=t.call(this,e,r)),"_class",void 0),xe(Se(o),"rightButtonCanDrag",void 0),xe(Se(o),"consumeStartEvent",void 0),xe(Se(o),"clone",void 0),xe(Se(o),"scroll",void 0),xe(Se(o),"trackScroll",void 0),xe(Se(o),"_downAt",void 0),xe(Se(o),"_posAtDown",void 0),xe(Se(o),"_pagePosAtDown",void 0),xe(Se(o),"_pageDelta",{x:0,y:0}),xe(Se(o),"_moving",void 0),xe(Se(o),"_lastPosition",void 0),xe(Se(o),"_lastScrollValues",{x:0,y:0}),xe(Se(o),"_initialScroll",{x:0,y:0}),xe(Se(o),"_size",void 0),xe(Se(o),"_currentParentPosition",void 0),xe(Se(o),"_ghostParentPosition",void 0),xe(Se(o),"_dragEl",void 0),xe(Se(o),"_multipleDrop",void 0),xe(Se(o),"_ghostProxyOffsets",void 0),xe(Se(o),"_ghostDx",void 0),xe(Se(o),"_ghostDy",void 0),xe(Se(o),"_isConstrained",!1),xe(Se(o),"_ghostProxyParent",void 0),xe(Se(o),"_useGhostProxy",void 0),xe(Se(o),"_ghostProxyFunction",void 0),xe(Se(o),"_activeSelectorParams",void 0),xe(Se(o),"_availableSelectors",[]),xe(Se(o),"_canDrag",void 0),xe(Se(o),"_consumeFilteredEvents",void 0),xe(Se(o),"_parent",void 0),xe(Se(o),"_ignoreZoom",void 0),xe(Se(o),"_filters",{}),xe(Se(o),"_constrainRect",void 0),xe(Se(o),"_elementToDrag",void 0),xe(Se(o),"downListener",void 0),xe(Se(o),"moveListener",void 0),xe(Se(o),"upListener",void 0),xe(Se(o),"scrollTracker",void 0),xe(Se(o),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),o._class=o.manager.css.draggable,Be(o.el,o._class),o.downListener=o._downListener.bind(Se(o)),o.upListener=o._upListener.bind(Se(o)),o.moveListener=o._moveListener.bind(Se(o)),o.rightButtonCanDrag=!0===i.rightButtonCanDrag,o.consumeStartEvent=!1!==i.consumeStartEvent,o._dragEl=o.el,o.clone=!0===i.clone,o.scroll=!0===i.scroll,o.trackScroll=!1!==i.trackScroll,o._multipleDrop=!1!==i.multipleDrop,o._canDrag=i.canDrag||Bn,o._consumeFilteredEvents=i.consumeFilteredEvents,o._parent=i.parent,o._ignoreZoom=!0===i.ignoreZoom,o._ghostProxyParent=i.ghostProxyParent,o.trackScroll&&(o.scrollTracker=o._trackScroll.bind(Se(o)),document.addEventListener("scroll",o.scrollTracker)),!0===i.ghostProxy?o._useGhostProxy=Bn:i.ghostProxy&&"function"==typeof i.ghostProxy?o._useGhostProxy=i.ghostProxy:o._useGhostProxy=function(e,t){return!(!o._activeSelectorParams||!o._activeSelectorParams.useGhostProxy)&&o._activeSelectorParams.useGhostProxy(e,t)},i.makeGhostProxy?o._ghostProxyFunction=i.makeGhostProxy:o._ghostProxyFunction=function(e){return o._activeSelectorParams&&o._activeSelectorParams.makeGhostProxy?o._activeSelectorParams.makeGhostProxy(e):e.cloneNode(!0)},i.selector){var s=o.el.getAttribute(Rn);null==s&&(s=""+(new Date).getTime(),o.el.setAttribute("katavorio-draggable",s)),o._availableSelectors.push(i)}return o.eventManager.on(o.el,yt,o.downListener),o}return Ee(n,[{key:"_trackScroll",value:function(e){if(this._moving){var t={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},n=t.x-this._lastScrollValues.x,i=t.y-this._lastScrollValues.y,r={x:n+this._lastPosition.x,y:i+this._lastPosition.y},o=r.x-this._downAt.x,s=r.y-this._downAt.y,a=this._ignoreZoom?1:this.manager.getZoom();this._dragEl&&this._dragEl.parentNode&&(o+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,s+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),o/=a,s/=a,this.moveBy(o,s,e),this._lastPosition=r,this._lastScrollValues=t}}},{key:"on",value:function(e,t){this.listeners[e]&&this.listeners[e].push(t)}},{key:"off",value:function(e,t){if(this.listeners[e]){for(var n=[],i=0;i<this.listeners[e].length;i++)this.listeners[e][i]!==t&&n.push(this.listeners[e][i]);this.listeners[e]=n}}},{key:"_upListener",value:function(e){this._downAt&&(this._downAt=null,this.eventManager.off(document,Et,this.moveListener),this.eventManager.off(document,xt,this.upListener),Ve(document.body,Zn),this.unmark(e),this.stop(e),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&!0===this._activeSelectorParams.revertFunction(this._dragEl,this.manager.getPosition(this._dragEl))&&(this.manager.setPosition(this._dragEl,this._posAtDown),this._dispatch(jt,this._dragEl)))}},{key:"_downListener",value:function(e){if(!e.defaultPrevented&&(this.rightButtonCanDrag||3!==e.which&&2!==e.button)&&this.isEnabled()&&this._canDrag()){var t=this._testFilter(e)&&function(e,t,n){return!Oe(e.srcElement||e.target,n.getInputFilterSelector(),t)}(e,this.el,this.manager);if(t){this._activeSelectorParams=null,this._elementToDrag=null,0===this._availableSelectors.length&&console.log("JSPLUMB: no available drag selectors");var n=e.target||e.srcElement,i=function(e,t,n){for(var i=null,r=t.getAttribute("katavorio-draggable"),o=null!=r?"[katavorio-draggable='"+r+"'] ":"",s=0;s<e.length;s++)if(null!=(i=In(t,n,o+e[s].selector))){if(e[s].filter){var a=Oe(n,e[s].filter,i);if(!0===e[s].filterExclude&&!a||a)return null}return[e[s],i]}return null}(this._availableSelectors,this.el,n);if(null!=i&&(this._activeSelectorParams=i[0],this._elementToDrag=i[1]),null==this._activeSelectorParams||null==this._elementToDrag)return;var r=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag,e):null;if(null!=r&&(this._elementToDrag=r),this.clone)if(this._dragEl=this._elementToDrag.cloneNode(!0),Be(this._dragEl,Jn),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",null!=this._parent){var o=this.manager.getPosition(this.el);this._dragEl.style.left=o.x+"px",this._dragEl.style.top=o.y+"px",this._parent.appendChild(this._dragEl)}else{var s=qe(this._elementToDrag);this._dragEl.style.left=s.x+"px",this._dragEl.style.top=s.y+"px",document.body.appendChild(this._dragEl)}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&Fe(e),this._downAt=bn(e),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=qe(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),this.eventManager.on(document,Et,this.moveListener),this.eventManager.on(document,xt,this.upListener),Be(document.body,Zn),this._dispatch(Ln,{el:this.el,pos:this._posAtDown,e:e,drag:this,size:this._size})}else this._consumeFilteredEvents&&Fe(e)}}},{key:"_moveListener",value:function(e){if(this._downAt){if(!this._moving){var t=this._dispatch(Nn,{el:this.el,pos:this._posAtDown,e:e,drag:this,size:this._size});if(!1!==t){if(!this._downAt)return;this.mark(t),this._moving=!0}else this.abort()}if(this._downAt){var n=bn(e),i=n.x-this._downAt.x,r=n.y-this._downAt.y,o=this._ignoreZoom?1:this.manager.getZoom();this._lastPosition={x:n.x,y:n.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(i+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,r+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),i/=o,r/=o,this.moveBy(i,r,e)}}}},{key:"getDragDelta",value:function(){return null!=this._posAtDown&&null!=this._downAt?{x:this._downAt.x-this._posAtDown.x,y:this._downAt.y-this._posAtDown.y}:{x:0,y:0}}},{key:"mark",value:function(e){var t;this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=qe(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),Be(this._dragEl,this.manager.css.drag),this._constrainRect={w:(t=this._dragEl).parentNode.offsetWidth+t.parentNode.scrollLeft,h:t.parentNode.offsetHeight+t.parentNode.scrollTop},this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(e){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,Ve(this._dragEl,this.manager.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(e,t,n){var i=this.toGrid({x:this._posAtDown.x+e,y:this._posAtDown.y+t}),r=this._doConstrain(i,this._dragEl,this._constrainRect,this._size,n);if(null!=r){if(this._useGhostProxy(this.el,this._dragEl))if(i.x!==r.x||i.y!==r.y){if(!this._isConstrained){var o=this._ghostProxyFunction(this._elementToDrag);Be(o,qn),this._ghostProxyParent?(this._ghostProxyParent.appendChild(o),this._currentParentPosition=qe(this._elementToDrag.parentNode),this._ghostParentPosition=qe(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(o),this._dragEl=o,this._isConstrained=!0}r=i}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0);this.manager.setPosition(this._dragEl,{x:r.x+this._ghostDx,y:r.y+this._ghostDy}),this._dispatch(Hn,{el:this.el,pos:r,e:n,drag:this,size:this._size,originalPos:this._posAtDown})}}},{key:"abort",value:function(){null!=this._downAt&&this._upListener()}},{key:"getDragElement",value:function(e){return e?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(e,t){if(t||this._moving){var n=[],i=this.manager.getPosition(this._dragEl);n.push([this._dragEl,i,this,this._size]),this._dispatch(zn,{el:this._dragEl,pos:this._ghostProxyOffsets||i,finalPos:i,e:e,drag:this,selection:n,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else this._moving||this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function(e,t){var n=null;if(this._activeSelectorParams&&this._activeSelectorParams[e])n=this._activeSelectorParams[e](t);else if(this.listeners[e])for(var i=0;i<this.listeners[e].length;i++)try{var r=this.listeners[e][i](t);null!=r&&(n=r)}catch(o){}return n}},{key:"resolveGrid",value:function(){var e={grid:null,thresholdX:5,thresholdY:5};return null!=this._activeSelectorParams&&null!=this._activeSelectorParams.grid&&(e.grid=this._activeSelectorParams.grid,null!=this._activeSelectorParams.snapThreshold&&(e.thresholdX=this._activeSelectorParams.snapThreshold,e.thresholdY=this._activeSelectorParams.snapThreshold)),e}},{key:"toGrid",value:function(e){var t=this.resolveGrid(),n=t.grid,i=t.thresholdX,r=t.thresholdY;if(null==n)return e;var o=n?n.w/2:i,s=n?n.h/2:r;return K(e,n,o,s)}},{key:"setUseGhostProxy",value:function(e){this._useGhostProxy=e?Bn:Vn}},{key:"_doConstrain",value:function(e,t,n,i,r){return null!=this._activeSelectorParams&&this._activeSelectorParams.constrainFunction&&"function"==typeof this._activeSelectorParams.constrainFunction?this._activeSelectorParams.constrainFunction(e,t,n,i,r):e}},{key:"_testFilter",value:function(e){for(var t in this._filters){var n=this._filters[t],i=n[0](e);if(n[1]&&(i=!i),!i)return!1}return!0}},{key:"addFilter",value:function(e,t){var n,i=this;if(e){var r="function"==typeof(n=e)?(n._katavorioId=U(),n._katavorioId):n;this._filters[r]=[function(t){var n,r=t.srcElement||t.target;return Q(e)?n=Oe(r,e,i.el):"function"==typeof e&&(n=e(t,i.el)),n},!1!==t]}}},{key:"removeFilter",value:function(e){var t="function"==typeof e?e._katavorioId:e;delete this._filters[t]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(e,t){e.selector&&(t?this._availableSelectors.unshift(e):this._availableSelectors.push(e))}},{key:"destroy",value:function(){this.eventManager.off(this.el,yt,this.downListener),this.eventManager.off(document,Et,this.moveListener),this.eventManager.off(document,xt,this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null,null!=this.scrollTracker&&document.removeEventListener("scroll",this.scrollTracker)}}]),n}(ni),ri=["input","textarea","select","button","option"].join(","),oi=function(){function e(t){be(this,e),xe(this,"eventManager",void 0),xe(this,"zoom",1),xe(this,"css",{}),xe(this,"inputFilterSelector",void 0),xe(this,"positioningStrategy",void 0),xe(this,"_positionSetter",void 0),xe(this,"_positionGetter",void 0),xe(this,"_sizeSetter",void 0),xe(this,"_sizeGetter",void 0),t=t||{},this.inputFilterSelector=t.inputFilterSelector||ri,this.eventManager=new Gn,this.zoom=t.zoom||1,this.positioningStrategy=t.positioningStrategy||Fn.absolutePosition,this._positionGetter=Yn.get(this.positioningStrategy),this._positionSetter=Xn.get(this.positioningStrategy),this._sizeGetter=Kn.get(this.positioningStrategy),this._sizeSetter=Un.get(this.positioningStrategy);var n=t.css||{};$(this.css,n)}return Ee(e,[{key:"getPosition",value:function(e){return this._positionGetter(e)}},{key:"setPosition",value:function(e,t){this._positionSetter(e,t)}},{key:"getSize",value:function(e){return this._sizeGetter(e)}},{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(e){this.zoom=e}},{key:"_prepareParams",value:function(e){e=e||{};var t,n={events:{}};for(t in e)n[t]=e[t];for(t=0;t<$n.length;t++)n.events[$n[t]]=e[$n[t]]||ei;return n}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(e){return this.inputFilterSelector=e,this}},{key:"draggable",value:function(e,t){if(null==e._katavorioDrag){var n=this._prepareParams(t),i=new ii(e,n,this);return Be(e,Wn),e._katavorioDrag=i,i}return e._katavorioDrag}},{key:"destroyDraggable",value:function(e){e._katavorioDrag&&(e._katavorioDrag.destroy(),delete e._katavorioDrag)}}]),e}(),si="jtk-drag-selected",ai=function(){function e(t){be(this,e),this.instance=t,xe(this,"_dragSelection",[]),xe(this,"_dragSizes",new Map),xe(this,"_dragElements",new Map),xe(this,"_dragElementStartPositions",new Map),xe(this,"_dragElementPositions",new Map),xe(this,"__activeSet",void 0)}return Ee(e,[{key:"_activeSet",get:function(){return null==this.__activeSet?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(e){var t=this;this.__activeSet=[],ee(this._dragSelection,(function(n){e(n)&&t.__activeSet.push(n)}))}},{key:"clear",value:function(){var e=this;this.reset(),ee(this._dragSelection,(function(t){return e.instance.removeClass(t.jel,si)})),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var e=this;ee(this._activeSet,(function(t){var n=e.instance.viewport.getPosition(t.id),i={x:parseInt(""+t.jel.offsetLeft,10),y:parseInt(""+t.jel.offsetTop,10)};e._dragElementStartPositions.set(t.id,i),e._dragElementPositions.set(t.id,i),e._dragSizes.set(t.id,{w:n.w,h:n.h})}))}},{key:"updatePositions",value:function(e,t,n){var i=this,r=e.x-t.x,o=e.y-t.y;ee(this._activeSet,(function(e){var t=i._dragElementStartPositions.get(e.id);if(t){var s=t.x+r,a=t.y+o,l=i._dragSizes.get(e.id),c={x:s,y:a,w:l.w,h:l.h};if(e.jel._jsPlumbParentGroup&&e.jel._jsPlumbParentGroup.constrain){var u={w:e.jel.parentNode.offsetWidth+e.jel.parentNode.scrollLeft,h:e.jel.parentNode.offsetHeight+e.jel.parentNode.scrollTop};c.x=Math.max(c.x,0),c.y=Math.max(c.y,0),c.x=Math.min(c.x,u.w-l.w),c.y=Math.min(c.y,u.h-l.h)}i._dragElementPositions.set(e.id,{x:s,y:a}),e.jel.style.left=c.x+"px",e.jel.style.top=c.y+"px",n(e.jel,e.id,l,c)}}))}},{key:"each",value:function(e){var t=this;ee(this._activeSet,(function(n){var i=t._dragSizes.get(n.id),r=t._dragElementPositions.get(n.id),o=t._dragElementStartPositions.get(n.id);e(n.jel,n.id,r,i,o)}))}},{key:"add",value:function(e,t){var n=e;t=t||this.instance.getId(n),-1===te(this._dragSelection,(function(e){return e.id===t}))&&(this.instance.addClass(e,si),this._dragSelection.push({id:t,jel:n}))}},{key:"remove",value:function(e){var t=this,n=e;this._dragSelection=this._dragSelection.filter((function(e){var i=e.jel!==n;return i||t.instance.removeClass(e.jel,si),i}))}},{key:"toggle",value:function(e){var t=e;-1!==te(this._dragSelection,(function(e){return e.jel===t}))?this.remove(t):this.add(e)}}]),e}(),li="jtk-drag-active",ci="jtk-drag-hover",ui=function(){function e(t,n,i){var r=this;be(this,e),this.instance=t,this.dragSelection=n,xe(this,"collicat",void 0),xe(this,"drag",void 0),xe(this,"_draggables",{}),xe(this,"_dlist",[]),xe(this,"_elementsWithEndpoints",{}),xe(this,"_draggablesForElements",{}),xe(this,"handlers",[]),xe(this,"_trackScroll",void 0),xe(this,"_filtersToAdd",[]),this.collicat=new oi({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:"jtk-delegated-draggable",draggable:"jtk-draggable",drag:"jtk-drag",selected:si,active:li,hover:ci,ghostProxy:"jtk-ghost-proxy"}}),this.instance.bind(l,(function(e){r.collicat.setZoom(e)})),i=i||{},this._trackScroll=!1!==i.trackScroll}return Ee(e,[{key:"addHandler",value:function(e,t){var n=this,i=$({selector:e.selector},t||{});i.start=ne(i.start,(function(t){return e.onStart(t)}),!1),i.drag=ne(i.drag,(function(t){return e.onDrag(t)})),i.stop=ne(i.stop,(function(t){return e.onStop(t)}));var r=(e.onBeforeStart||function(e){}).bind(e);if(i.beforeStart=ne(i.beforeStart,(function(e){return r(e)})),i.dragInit=function(t,n){return e.onDragInit(t,n)},i.dragAbort=function(t){return e.onDragAbort(t)},e.useGhostProxy&&(i.useGhostProxy=e.useGhostProxy,i.makeGhostProxy=e.makeGhostProxy),null==i.constrainFunction&&null!=i.containment)switch(i.containment){case Qn.notNegative:i.constrainFunction=function(e,t,n,i){return{x:Math.max(0,Math.min(e.x)),y:Math.max(0,Math.min(e.y))}};break;case Qn.parent:var o=i.containmentPadding||5;i.constrainFunction=function(e,t,n,i){return{x:e.x<0?0:e.x>n.w-o?n.w-o:e.x,y:e.y<0?0:e.y>n.h-o?n.h-o:e.y}};break;case Qn.parentEnclosed:i.constrainFunction=function(e,t,n,i){return{x:e.x<0?0:e.x+i.w>n.w?n.w-i.w:e.x,y:e.y<0?0:e.y+i.h>n.h?n.h-i.h:e.y}}}null==this.drag?(i.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),i),ee(this._filtersToAdd,(function(e){return n.drag.addFilter(e[0],e[1])})),this.drag.on(jt,(function(e){n.instance.revalidate(e)}))):this.drag.addSelector(i),this.handlers.push({handler:e,options:i}),e.init(this.drag)}},{key:"addSelector",value:function(e,t){this.drag&&this.drag.addSelector(e,t)}},{key:"addFilter",value:function(e,t){null==this.drag?this._filtersToAdd.push([e,!0===t]):this.drag.addFilter(e,t)}},{key:"removeFilter",value:function(e){null!=this.drag&&this.drag.removeFilter(e)}},{key:"setFilters",value:function(e){var t=this;ee(e,(function(e){t.drag.addFilter(e[0],e[1])}))}},{key:"reset",value:function(){var e=[];if(ee(this.handlers,(function(e){e.handler.reset()})),this.handlers.length=0,null!=this.drag){var t=this.drag._filters;for(var n in t)e.push([n,t[n][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,e}},{key:"setOption",value:function(e,t){var n=ie(this.handlers,(function(t){return t.handler===e}));null!=n&&$(n.options,t||{})}}]),e}();function hi(e,t){return Q(t)?{id:t,active:!0}:{id:t.id,active:t.active}}var di=function(){function e(t,i){be(this,e),this.instance=t,this._dragSelection=i,xe(this,"selector","> "+c+":not("+n(a)+")"),xe(this,"_dragOffset",null),xe(this,"_groupLocations",[]),xe(this,"_intersectingGroups",[]),xe(this,"_currentDragParentGroup",null),xe(this,"_dragGroupByElementIdMap",{}),xe(this,"_dragGroupMap",{}),xe(this,"_currentDragGroup",null),xe(this,"_currentDragGroupOffsets",new Map),xe(this,"_currentDragGroupSizes",new Map),xe(this,"_currentDragGroupOriginalPositions",new Map),xe(this,"_dragPayload",null),xe(this,"drag",void 0),xe(this,"originalPosition",void 0)}return Ee(e,[{key:"onDragInit",value:function(e){return null}},{key:"onDragAbort",value:function(e){return null}},{key:"getDropGroup",value:function(){var e=null;if(this._intersectingGroups.length>0){var t=this._intersectingGroups[0].groupLoc.group,n=this._intersectingGroups[0].intersectingElement,i=n._jsPlumbParentGroup;i!==t&&(null!=i&&i.overrideDrop(n,t)||(e=this._intersectingGroups[0]))}return e}},{key:"onStop",value:function(e){var t,n=this,i=e.drag.getDragElement(),r=this.getDropGroup(),o=[];function s(e,t,n,i,s){var a=n.x,l=n.y;if(e._jsPlumbParentGroup&&e._jsPlumbParentGroup.constrain){var c={w:e.parentNode.offsetWidth+e.parentNode.scrollLeft,h:e.parentNode.offsetHeight+e.parentNode.scrollTop};a=Math.max(a,0),l=Math.max(l,0),a=Math.min(a,c.w-i.w),l=Math.min(l,c.h-i.h),n.x=a,n.y=l}o.push({el:e,id:t,pos:n,originalPos:s,originalGroup:e._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:null==r?void 0:r.groupLoc.group})}if(o.push({el:i,id:this.instance.getId(i),pos:e.finalPos,originalGroup:i._jsPlumbParentGroup,redrawResult:null,originalPos:e.originalPos,reverted:!1,dropGroup:null!=r?r.groupLoc.group:null}),this._dragSelection.each((function(t,n,i,r,o){t!==e.el&&s(t,n,{x:i.x,y:i.y},r,o)})),null===(t=this._currentDragGroup)||void 0===t||t.members.forEach((function(t){if(t.el!==e.el){var i=n._currentDragGroupOffsets.get(t.elId),r=n._currentDragGroupSizes.get(t.elId),o={x:e.finalPos.x+i[0].x,y:e.finalPos.y+i[0].y};s(t.el,t.elId,o,r,n._currentDragGroupOriginalPositions.get(t.elId))}})),ee(o,(function(e){var t=null!=e.originalGroup,i=t&&On(n.instance,e.el,e.pos),o={x:0,y:0};if(t&&!i){if(null==r){var s=n._pruneOrOrphan(e,!0,!0);null!=s.pos?e.pos=s.pos.pos:!s.pruned&&e.originalGroup.revert&&(e.pos=e.originalPos,e.reverted=!0)}}else t&&i&&(o=n._computeOffsetByParentGroup(e.originalGroup));null==r||i?e.dropGroup=null:n.instance.groupManager.addToGroup(r.groupLoc.group,!1,e.el),e.reverted&&n.instance.setPosition(e.el,e.pos),e.redrawResult=n.instance.setElementPosition(e.el,e.pos.x+o.x,e.pos.y+o.y),n.instance.removeClass(e.el,"jtk-dragged"),n.instance.select({source:e.el}).removeClass(n.instance.elementDraggingClass+" "+n.instance.sourceElementDraggingClass,!0),n.instance.select({target:e.el}).removeClass(n.instance.elementDraggingClass+" "+n.instance.targetElementDraggingClass,!0)})),null!=o[0].originalGroup){var a=i._jsPlumbParentGroup;if(a!==o[0].originalGroup){var l=e.drag.getDragElement(!0);if(o[0].originalGroup.ghost){var c=this.instance.getPosition(this.instance.getGroupContentArea(a)),u=this.instance.getPosition(this.instance.getGroupContentArea(o[0].originalGroup)),h={x:u.x+e.pos.x-c.x,y:u.y+e.pos.y-c.y};l.style.left=h.x+"px",l.style.top=h.y+"px",this.instance.revalidate(l)}}}this.instance.fire("drag:stop",{elements:o,e:e.e,el:i,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var e=this;ee(this._groupLocations,(function(t){e.instance.removeClass(t.el,li),e.instance.removeClass(t.el,ci)})),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroupOriginalPositions.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(e){this.drag=e}},{key:"onDrag",value:function(e){var t=this,n=e.drag.getDragElement(),i=this.instance.getId(n),r=e.pos,o=this.instance.viewport.getPosition(i),s={x:r.x,y:r.y};this._intersectingGroups.length=0,null!=this._dragOffset&&(s.x+=this._dragOffset.x,s.y+=this._dragOffset.y);var a=function(n,i,r){if(r){var o=new Set;ee(t._groupLocations,(function(n){!o.has(n.group.id)&&ae(i,n.r)?(n.group!==t._currentDragParentGroup&&t.instance.addClass(n.el,ci),t._intersectingGroups.push({groupLoc:n,intersectingElement:e.drag.getDragElement(!0),d:0}),ee(t.instance.groupManager.getAncestors(n.group),(function(e){return o.add(e.id)}))):t.instance.removeClass(n.el,ci)}))}t.instance.setElementPosition(n,i.x,i.y),t.instance.fire(St,{el:n,e:e.e,pos:{x:i.x,y:i.y},originalPosition:t.originalPosition,payload:t._dragPayload})},l={x:s.x,y:s.y,w:o.w,h:o.h};a(n,l,!0),this._dragSelection.updatePositions(r,this.originalPosition,(function(e,t,n,i){a(e,i,!1)})),this._currentDragGroupOffsets.forEach((function(e,n){var i=t._currentDragGroupSizes.get(n),r={x:l.x+e[0].x,y:l.y+e[0].y,w:i.w,h:i.h};e[1].style.left=r.x+"px",e[1].style.top=r.y+"px",a(e[1],r,!1)}))}},{key:"_computeOffsetByParentGroup",value:function(e){var t=this.instance.getPosition(e.el),n=e.contentArea;if(n!==e.el){var i=this.instance.getPosition(n);t.x+=i.x,t.y+=i.y}if(e.el._jsPlumbParentGroup){var r=this._computeOffsetByParentGroup(e.el._jsPlumbParentGroup);t.x+=r.x,t.y+=r.y}return t}},{key:"onStart",value:function(e){var t=this,n=e.drag.getDragElement(),i=this.instance.getPosition(n);this.originalPosition={x:e.pos.x,y:e.pos.y},n._jsPlumbParentGroup&&(this._dragOffset=this._computeOffsetByParentGroup(n._jsPlumbParentGroup),this._currentDragParentGroup=n._jsPlumbParentGroup);var r=!0,o=n.getAttribute(u);if((!1===this.instance.elementsDraggable||null!=o&&o!==ve)&&(r=!1),r){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var s=e.drag.getDragElement(!0),a=s.querySelectorAll(c),l=function(e){for(var t=[],n=e._jsPlumbParentGroup;null!=n;)t.push(n.el),n=n.group;return t}(s),h=[];Array.prototype.push.apply(h,a),Array.prototype.push.apply(h,l),this._dragSelection.filterActiveSet((function(e){return-1===h.indexOf(e.jel)})),this._dragSelection.initialisePositions();var d=function(n,i,r){if(!n._isJsPlumbGroup||t.instance.allowNestedGroups){var o=!n._jsPlumbParentGroup,s=o||!0!==n._jsPlumbParentGroup.dropOverride,a=!o&&(n._jsPlumbParentGroup.ghost||!0!==n._jsPlumbParentGroup.constrain);(o||s&&a)&&(ee(t.instance.groupManager.getGroups(),(function(e){var i=n._jsPlumbGroup;if(!1!==e.droppable&&!1!==e.enabled&&n._jsPlumbGroup!==e&&!t.instance.groupManager.isDescendant(e,i)){var r=e.el,o=t.instance.getId(r),s=t.instance.viewport.getPosition(o),a={el:r,r:{x:s.x,y:s.y,w:s.w,h:s.h},group:e};t._groupLocations.push(a),e!==t._currentDragParentGroup&&t.instance.addClass(r,li)}})),t._groupLocations.sort((function(e,n){return t.instance.groupManager.isDescendant(e.group,n.group)?-1:t.instance.groupManager.isAncestor(n.group,e.group)?1:0})))}return t.instance.select({source:n}).addClass(t.instance.elementDraggingClass+" "+t.instance.sourceElementDraggingClass,!0),t.instance.select({target:n}).addClass(t.instance.elementDraggingClass+" "+t.instance.targetElementDraggingClass,!0),t.instance.fire("drag:start",{el:n,e:e.e,originalPosition:t.originalPosition,pos:t.originalPosition,dragGroup:i,dragGroupMemberSpec:r})},p=this.instance.getId(n);this._currentDragGroup=this._dragGroupByElementIdMap[p],this._currentDragGroup&&!function(e,t){var n=pe(e.members,(function(e){return e.el===t}));return null!==n&&!0===n.active}(this._currentDragGroup,n)&&(this._currentDragGroup=null);var g=d(n);if(!1===g)return this._cleanup(),!1;this._dragPayload=g,null!=this._currentDragGroup&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach((function(e){var n=t.instance.viewport.getPosition(e.elId);t._currentDragGroupOffsets.set(e.elId,[{x:n.x-i.x,y:n.y-i.y},e.el]),t._currentDragGroupSizes.set(e.elId,n),t._currentDragGroupOriginalPositions.set(e.elId,{x:n.x,y:n.y}),d(e.el,t._currentDragGroup,e)})))}return r}},{key:"addToDragGroup",value:function(e){var t=this,n=hi(this.instance,e),i=this._dragGroupMap[n.id];null==i&&(i={id:n.id,members:new Set},this._dragGroupMap[n.id]=i);for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];this.removeFromDragGroup.apply(this,o),ee(o,(function(e){var r=t.instance.getId(e);i.members.add({elId:r,el:e,active:n.active}),t._dragGroupByElementIdMap[r]=i}))}},{key:"removeFromDragGroup",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];ee(n,(function(t){var n=e.instance.getId(t),i=e._dragGroupByElementIdMap[n];if(null!=i){var r=new Set;i.members.forEach((function(e){e.el!==t&&r.add(e)})),i.members=r,delete e._dragGroupByElementIdMap[n]}}))}},{key:"setDragGroupState",value:function(e){for(var t=this,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var o=i.map((function(e){return t.instance.getId(e)}));ee(o,(function(n){var i=t._dragGroupByElementIdMap[n];if(null!=i){var r=pe(i.members,(function(e){return e.elId===n}));null!=r&&(r.active=e)}}))}},{key:"clearDragGroup",value:function(e){var t=this,n=this._dragGroupMap[e];null!=n&&(n.members.forEach((function(e){delete t._dragGroupByElementIdMap[e.elId]})),n.members.clear())}},{key:"_pruneOrOrphan",value:function(e,t,n){var i=e.el,r={pruned:!1,pos:null};if(n||!On(this.instance,i,e.pos)){var o=i._jsPlumbParentGroup;o.prune?(i._isJsPlumbGroup?this.instance.removeGroup(i._jsPlumbGroup):o.remove(e.el,!0),r.pruned=!0):o.orphan&&(r.pos=this.instance.groupManager.orphan(e.el,t),i._isJsPlumbGroup?o.removeGroup(i._jsPlumbGroup):o.remove(e.el))}return r}}]),e}();function pi(e,t,n,i,r){for(var o=e.target||e.srcElement,s=!1,a=i.getSelector(t,n),l=0;l<a.length;l++)if(a[l]===o){s=!0;break}return r?!s:s}var gi=n(li,ci),fi="sourceSelectorEndpoint",vi=function(){function e(t){be(this,e),this.instance=t,xe(this,"jpc",void 0),xe(this,"existingJpc",void 0),xe(this,"_originalAnchorSpec",void 0),xe(this,"ep",void 0),xe(this,"endpointRepresentation",void 0),xe(this,"canvasElement",void 0),xe(this,"_activeDefinition",void 0),xe(this,"placeholderInfo",{id:null,element:null}),xe(this,"floatingIndex",void 0),xe(this,"floatingId",void 0),xe(this,"floatingElement",void 0),xe(this,"floatingEndpoint",void 0),xe(this,"floatingAnchor",void 0),xe(this,"_stopped",void 0),xe(this,"inPlaceCopy",void 0),xe(this,"endpointDropTargets",[]),xe(this,"currentDropTarget",null),xe(this,"payload",void 0),xe(this,"floatingConnections",{}),xe(this,"_forceReattach",void 0),xe(this,"_forceDetach",void 0),xe(this,"mousedownHandler",void 0),xe(this,"mouseupHandler",void 0),xe(this,"selector",n(o));var i=t.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),t.on(i,yt,c,this.mousedownHandler),t.on(i,xt,[c,n(o)].join(","),this.mouseupHandler)}return Ee(e,[{key:"_resolveDragParent",value:function(e,t){var n=this.instance.getContainer(),i=Ne(t,c,n,!0);if(null!=e.parentSelector){var r=Ne(t,e.parentSelector,n,!0);return null!=r&&(i=Ne(r.parentNode,c,n,!1)),r||i}return i}},{key:"_mousedownHandler",value:function(e){var t,n;if(3!==e.which&&2!==e.button){var i=e.target||e.srcElement;if((null==(n=this._getSourceDefinition(e))||null!=(t=this._resolveDragParent(n.def.def,i))&&t.getAttribute(ut)!==ve)&&n){var r,o=e.currentTarget;if(i.getAttribute(ut)!==ve){if(Fe(e),this._activeDefinition=n,null!=(r=n.def.def).canAcceptNewConnection&&!r.canAcceptNewConnection(t,e))return!1;var s=Pi(e,t,this.instance.currentZoom),a={element:t};if($(a,r),a.isTemporarySource=!0,r.scope)a.scope=r.scope;else{var l=i.getAttribute(ht);null!=l&&(a.scope=l)}var c=r.parameterExtractor?r.parameterExtractor(t,i,e):{};if(null!=(a=re(a,c)).maxConnections&&a.maxConnections>=0&&this.instance.select({source:t}).length>=a.maxConnections)return Fe(e),r.onMaxConnections&&r.onMaxConnections({element:t,maxConnections:a.maxConnections},e),e.stopImmediatePropagation&&e.stopImmediatePropagation(),!1;if(r.anchorPositionFinder){var u=r.anchorPositionFinder(t,s,r,e);null!=u&&(a.anchor=u)}this._originalAnchorSpec=a.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor);var h=this.instance.router.prepareAnchor(this._originalAnchorSpec),d=[s.x,s.y,0,0];if(h.locations.length>0)d[2]=h.locations[0].ox,d[3]=h.locations[0].oy;else if(h.isContinuous){var p=s.x<.5?s.x:1-s.x,g=s.y<.5?s.y:1-s.y;d[2]=p<g?s.x<.5?-1:1:0,d[3]=g<p?s.y<.5?-1:1:0}a.anchor=d,a.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(a);var f={};if(r.extract){for(var v in r.extract){var _=i.getAttribute(v);_&&(f[r.extract[v]]=_)}this.ep.mergeParameters(f)}if(a.uniqueEndpoint){var m=this.ep.elementId,y=this.instance.getManagedData(m,fi,n.id);null==y?(this.instance.setManagedData(m,fi,n.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=y}o._jsPlumbOrphanedEndpoints=o._jsPlumbOrphanedEndpoints||[],o._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,yt,e,f)}}}}},{key:"_mouseupHandler",value:function(e){var t=e.currentTarget||e.srcElement;t._jsPlumbOrphanedEndpoints&&(oe(t._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),t._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(e){var t=Je(e,this.instance),n=Xe(e,this.instance);return this._makeDraggablePlaceholder(t,n),this.placeholderInfo.element.jtk=e.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(e){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(e,t){this.placeholderInfo=this.placeholderInfo||{};var n=We("div",{position:"absolute"});this.instance._appendElementToContainer(n);var i=this.instance.getId(n);return this.instance.setPosition(n,e),n.style.width=t.w+"px",n.style.height=t.h+"px",this.instance.manage(n),this.placeholderInfo.id=i,this.placeholderInfo.element=n,n}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var e=this.instance.getContainer();this.instance.off(e,xt,this.mouseupHandler),this.instance.off(e,yt,this.mousedownHandler)}},{key:"init",value:function(e){}},{key:"startNewConnectionDrag",value:function(e,t){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:e,data:t}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.ep.addClass(this.instance.draggingClass),this.instance.fire(Mt,this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var e=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.instance.fire(Mt,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[e].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,e),this.jpc.suspendedEndpoint=this.jpc.endpoints[e],this.jpc.suspendedElement=this.jpc.endpoints[e].element,this.jpc.suspendedElementId=this.jpc.endpoints[e].elementId,this.jpc.suspendedElementType=0===e?h:d,this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[e]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=e,this.instance._refreshEndpoint(this.ep)}},{key:"_shouldStartDrag",value:function(){var e=!0;this.ep.enabled||(e=!1),null!=this.jpc||this.ep.isSource||this.ep.isTemporarySource||(e=!1),!this.ep.isSource||!this.ep.isFull()||null!=this.jpc&&this.ep.dragAllowedWhenFull||(e=!1),null==this.jpc||this.jpc.isDetachable(this.ep)||(this.ep.isFull()?e=!1:this.jpc=null);var n={},i=this.instance.checkCondition(null==this.jpc?p:g,{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return!1===i?e=!1:"object"===t(i)?$(n=i,this.payload||{}):n=this.payload||{},[e,n]}},{key:"_createFloatingEndpoint",value:function(e){var t=this.ep.endpoint;null!=this.ep.edgeType&&(t=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType).endpoints[1]),this.floatingEndpoint=function(e,t,n,i,r,o){var s=X(o,i,r),a={paintStyle:e.getPaintStyle(),preparedAnchor:s,element:i,scope:e.scope,cssClass:[v,e.cssClass].join(" ")};null!=t&&(ge(t,R)?a.existingEndpoint=t:a.endpoint=t);var l=o._internal_newEndpoint(a);return o._paintEndpoint(l,{}),l}(this.ep,t,0,this.placeholderInfo.element,this.placeholderInfo.id,this.instance),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(e,t){var n,i=this,r=this.jpc&&this.jpc.endpoints[0]===this.ep,s=this.instance.getContainer().querySelectorAll([".",o,"[",f,this.ep.scope,"]:not(.",v,")"].join(""));if(ee(s,(function(t){if(!(null==i.jpc&&t===e||t===i.floatingElement||null==i.jpc&&t.jtk.endpoint.isFull())&&(r&&t.jtk.endpoint.isSource||!r&&t.jtk.endpoint.isTarget)){var o=Je(t,i.instance),s=Xe(t,i.instance);n={x:o.x,y:o.y,w:s.w,h:s.h},i.endpointDropTargets.push({el:t,targetEl:t,r:n,endpoint:t.jtk.endpoint,def:null}),i.instance.addClass(t,li)}})),r){var a=ie(this.instance.sourceSelectors,(function(e){return e.isEnabled()&&(null==e.def.def.scope||e.def.def.scope===i.ep.scope)}));if(null!=a){var l=this._findTargetZones(a);ee(l,(function(e){if(e.getAttribute(ut)!==ve){var t=e.getAttribute(ht);if(null!=t&&t!==i.ep.scope)return;var n={r:null,el:e};n.targetEl=Ne(e,c,i.instance.getContainer(),!0);var r=Je(n.el,i.instance),o=Xe(n.el,i.instance);n.r={x:r.x,y:r.y,w:o.w,h:o.h},null!=a.def.def.rank&&(n.rank=a.def.def.rank),n.def=a.def,i.endpointDropTargets.push(n),i.instance.addClass(n.targetEl,li)}}))}}else se(this.instance.targetSelectors,(function(e){return e.isEnabled()})).forEach((function(e){var n=i._findTargetZones(e);ee(n,(function(n){if(n.getAttribute(ut)!==ve){var r=n.getAttribute(ht);if(null!=r&&r!==i.ep.scope)return;var o={r:null,el:n};if(null!=e.def.def.parentSelector&&(o.targetEl=Ne(n,e.def.def.parentSelector,i.instance.getContainer(),!0)),null==o.targetEl&&(o.targetEl=Ne(n,c,i.instance.getContainer(),!0)),(!1===e.def.def.allowLoopback||i._activeDefinition&&!1===i._activeDefinition.def.def.allowLoopback)&&o.targetEl===i.ep.element)return;if(null!=e.def.def.canAcceptNewConnection&&!e.def.def.canAcceptNewConnection(o.targetEl,t))return;var s=e.def.def.maxConnections;if(null!=s&&-1!==s&&i.instance.select({target:o.targetEl}).length>=s)return;var a=Je(n,i.instance),l=Xe(n,i.instance);o.r={x:a.x,y:a.y,w:l.w,h:l.h},o.def=e.def,null!=e.def.def.rank&&(o.rank=e.def.def.rank),i.endpointDropTargets.push(o),i.instance.addClass(o.targetEl,li)}}))}));this.endpointDropTargets.sort((function(e,t){if(e.targetEl._isJsPlumbGroup&&!t.targetEl._isJsPlumbGroup)return 1;if(!e.targetEl._isJsPlumbGroup&&t.targetEl._isJsPlumbGroup)return-1;if(e.targetEl._isJsPlumbGroup&&t.targetEl._isJsPlumbGroup){if(i.instance.groupManager.isAncestor(e.targetEl._jsPlumbGroup,t.targetEl._jsPlumbGroup))return-1;if(i.instance.groupManager.isAncestor(t.targetEl._jsPlumbGroup,e.targetEl._jsPlumbGroup))return 1}else{if(null==e.rank||null==t.rank)return 0;if(e.rank>t.rank)return-1;if(e.rank<t.rank)return 1}}))}},{key:"_findTargetZones",value:function(e){var t;if(e.redrop===_){var n=this.instance.targetSelectors.map((function(e){return e.selector}));n.push.apply(n,Ae(this.instance.sourceSelectors.map((function(e){return e.selector})))),n.push(c),t=n.join(",")}else if(e.redrop===m)t=e.selector;else if(e.redrop===y)t=this.instance.sourceSelectors.map((function(e){return e.selector})).join(",");else if(e.redrop===b)t=this.instance.targetSelectors.map((function(e){return e.selector})).join(",");else if(e.redrop===k){var i=this.instance.targetSelectors.map((function(e){return e.selector}));i.push.apply(i,Ae(this.instance.sourceSelectors.map((function(e){return e.selector})))),t=i.join(",")}return this.instance.getContainer().querySelectorAll(t)}},{key:"onStart",value:function(e){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var t=e.drag.getDragElement();if(this.ep=t.jtk.endpoint,!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var n=Te(this._shouldStartDrag(),2),i=n[0],r=n[1];if(!1===i)return this._stopped=!0,!1;this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,e.e),null==this.jpc?this.startNewConnectionDrag(this.ep.scope,r):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function(e){this.payload=e.e.payload||{}}},{key:"onDrag",value:function(e){if(this._stopped)return!0;if(this.placeholderInfo.element){var t=Xe(this.floatingElement,this.instance);this.instance.setElementPosition(this.placeholderInfo.element,e.pos.x,e.pos.y);for(var n,i,r={x:e.pos.x,y:e.pos.y,w:t.w,h:t.h},o=0;o<this.endpointDropTargets.length;o++)if(ae(r,this.endpointDropTargets[o].r)){n=this.endpointDropTargets[o];break}n!==this.currentDropTarget&&null!=this.currentDropTarget&&(i=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,ci),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),null!=n&&(this.instance.addClass(n.el,ci),i=this._getFloatingAnchorIndex(),null!=n.endpoint&&(n.endpoint.isSource&&0===i||n.endpoint.isTarget&&0!==i||this.jpc.suspendedEndpoint&&n.endpoint.referenceEndpoint&&n.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id?(this.instance.checkCondition(E,{sourceEndpoint:this.jpc.endpoints[i],targetEndpoint:n.endpoint.endpoint,connection:this.jpc})?(n.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(n.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(n.endpoint),this.instance._paintConnection(this.jpc)):n=null)),this.currentDropTarget=n}}},{key:"_maybeCleanup",value:function(e){e._mtNew&&0===e.connections.length?this.instance.deleteEndpoint(e):delete e._mtNew}},{key:"_reattachOrDiscard",value:function(e){var t=null!=this.jpc.suspendedEndpoint,n=this._getFloatingAnchorIndex();return t&&this._shouldReattach()?(0===n?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(n),!0):(this._discard(n,e),!1)}},{key:"onStop",value:function(e){var t=this,n=e.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var i=x(ci,li),r=this.instance.getContainer().querySelectorAll(gi);if(ee(r,(function(e){t.instance.removeClass(e,i)})),this.jpc&&null!=this.jpc.endpoints){var o,s=null!=this.jpc.suspendedEndpoint,a=this._getFloatingAnchorIndex(),l=this.jpc.suspendedEndpoint;if(null!=this.currentDropTarget)if(null==(o=this._getDropEndpoint(e,this.jpc)))this._reattachOrDiscard(e.e);else if(l&&l.id===o.id)this._doForceReattach(a);else if(o.enabled)if(o.isFull())o.fire(C,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},n),this._reattachOrDiscard(e.e);else{0===a?(this.jpc.source=o.element,this.jpc.sourceId=o.elementId):(this.jpc.target=o.element,this.jpc.targetId=o.elementId);var c=!0;s&&this.jpc.suspendedEndpoint.id!==o.id&&(this.jpc.isDetachAllowed(this.jpc)&&this.jpc.endpoints[a].isDetachAllowed(this.jpc)&&this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)&&this.instance.checkCondition("beforeDetach",this.jpc)||(c=!1)),(c=c&&o.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,o))?this._drop(o,a,n,c):this._reattachOrDiscard(e.e)}else this._reattachOrDiscard(e.e);else this._reattachOrDiscard(e.e);this.instance._refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,null!=o&&this._maybeCleanup(o)}}},{key:"_getSourceDefinition",value:function(e){for(var t,n=this.instance.getContainer(),i=0;i<this.instance.sourceSelectors.length;i++)if((t=this.instance.sourceSelectors[i]).isEnabled()&&!1!==pi(e,n,t.selector,this.instance,t.exclude))return t}},{key:"_getDropEndpoint",value:function(e,t){var n;if(null==this.currentDropTarget.endpoint){var i=this.currentDropTarget.def,r=e.e.target||e.e.srcElement;if(null==i)return null;var o=this.currentDropTarget.targetEl,s=Pi(e.e,o,this.instance.currentZoom),a=this.instance._deriveEndpointAndAnchorSpec(t.getType().join(" "),!0),l=a.endpoints?$(e,{endpoint:i.def.endpoint||a.endpoints[1],cssClass:i.def.cssClass||"",source:!0===i.def.source,target:!0===i.def.target}):e,c=this.instance.validAnchorsSpec(a.anchors)?a.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null,u=i.def.anchor,h=i.def.anchorPositionFinder?i.def.anchorPositionFinder(o,s,i.def,e.e):null,d=null!=h?h:null!=u?u:null!=c&&null!=c[1]?c[1]:null;null!=d&&(l=$(l,{anchor:d})),null!=i.def.portId&&(l.portId=i.def.portId);var p=i.def.parameterExtractor?i.def.parameterExtractor(this.currentDropTarget.el,r,e.e):{};if((l=re(l,p)).element=o,(n=this.instance._internal_newEndpoint(l))._mtNew=!0,n.deleteOnEmpty=!0,i.def.parameters&&n.mergeParameters(i.def.parameters),i.def.extract){var g={};for(var f in i.def.extract){var v=this.currentDropTarget.el.getAttribute(f);v&&(g[i.def.extract[f]]=v)}n.mergeParameters(g)}}else n=this.currentDropTarget.endpoint;return n&&(n.removeClass(this.instance.endpointDropAllowedClass),n.removeClass(this.instance.endpointDropForbiddenClass)),n}},{key:"_doForceReattach",value:function(e){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[e]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,e),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(){if(this.jpc.isReattach()||this.jpc._forceReattach)return!0;var e=this.jpc.suspendedEndpoint,t=this.jpc.suspendedElementType==h?1:0,n=this.jpc.endpoints[t];return!le(!0,!1,[[e,P,[this.jpc]],[n,P,[this.jpc]],[this.jpc,P,[this.jpc]],[this.instance,D,[S,this.jpc]]])}},{key:"_discard",value:function(e,t){this.jpc.pending?this.instance.fire(wt,this.jpc,t):(0===e?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[e]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:t,force:!0})}},{key:"_drop",value:function(e,t,n,i){if(this.jpc.endpoints[t].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[t]=e,e.addConnection(this.jpc),this.jpc.suspendedEndpoint){var r=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:t,originalSourceId:0===t?r:this.jpc.sourceId,newSourceId:0===t?e.elementId:this.jpc.sourceId,originalTargetId:1===t?r:this.jpc.targetId,newTargetId:1===t?e.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:e},n)}1===t?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint&&(this.jpc.endpoints[0].detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc)),ce(i)&&this.jpc.mergeData(i),this._originalAnchorSpec&&(this.jpc.endpoints[0].setAnchor(this._originalAnchorSpec),this._originalAnchorSpec=null),this.instance._finaliseConnection(this.jpc,null,n),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(e,t){this.floatingConnections[e.id]=t}},{key:"_getFloatingAnchorIndex",value:function(){return null==this.floatingIndex?1:this.floatingIndex}}]),e}(),_i=function(e){Ce(n,e);var t=we(n);function n(e,i){var r;return be(this,n),(r=t.call(this,e,i)).instance=e,r.dragSelection=i,xe(Se(r),"selector",[">",ln,c].join(" ")),xe(Se(r),"doRevalidate",void 0),r.doRevalidate=r._revalidate.bind(Se(r)),r}return Ee(n,[{key:"reset",value:function(){this.drag.off(jt,this.doRevalidate)}},{key:"_revalidate",value:function(e){this.instance.revalidate(e)}},{key:"init",value:function(e){this.drag=e,e.on(jt,this.doRevalidate)}},{key:"useGhostProxy",value:function(e,t){var n=t._jsPlumbParentGroup;return null!=n&&!0===n.ghost}},{key:"makeGhostProxy",value:function(e){var t=e,n=t.cloneNode(!0);return n._jsPlumbParentGroup=t._jsPlumbParentGroup,n}}]),n}(di),mi=function(){function e(t,n){be(this,e),this.instance=t,this.overlay=n,xe(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=n}return Ee(e,null,[{key:"getElement",value:function(e,t,n){if(null==e.canvas){if(n&&t){e.canvas=n(t);var i=e.instance.overlayClass+" "+(e.cssClass?e.cssClass:"");e.instance.addClass(e.canvas,i)}else e.canvas=We("div",{},e.instance.overlayClass+" "+(e.cssClass?e.cssClass:""));for(var r in e.instance.setAttribute(e.canvas,"jtk-overlay-id",e.id),e.attributes)e.instance.setAttribute(e.canvas,r,e.attributes[r]);e.canvas.style.position=j,e.instance._appendElement(e.canvas,e.instance.getContainer()),e.instance.getId(e.canvas);var o="translate(-50%, -50%)";e.canvas.style.webkitTransform=o,e.canvas.style.mozTransform=o,e.canvas.style.msTransform=o,e.canvas.style.oTransform=o,e.canvas.style.transform=o,e.isVisible()||(e.canvas.style.display=w),e.canvas.jtk={overlay:e}}return e.canvas}},{key:"destroy",value:function(e){e.canvas&&e.canvas.parentNode&&e.canvas.parentNode.removeChild(e.canvas),delete e.canvas,delete e.cachedDimensions}},{key:"_getDimensions",value:function(e,t){return(null==e.cachedDimensions||t)&&(e.cachedDimensions={w:1,h:1}),e.cachedDimensions}}]),e}();function yi(e){if(null==e.path){var t=$({"jtk-overlay-id":e.id},e.attributes);e.path=rt(tt,t);var n=e.instance.overlayClass+" "+(e.cssClass?e.cssClass:"");e.instance.addClass(e.path,n),e.path.jtk={overlay:e}}var i=e.path.parentNode;if(null==i){if(e.component instanceof G){var r=e.component.connector;i=null!=r?r.canvas:null}else if(e.component instanceof B){var o=e.component.endpoint;i=null!=o?o.canvas:o}null!=i&&at(i,e.path,1)}return e.path}!function(e){Ce(n,e);var t=we(n);function n(){var e;be(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return xe(Se(e=t.call.apply(t,[this].concat(r))),"path",void 0),e}}(M);var bi=function(){function e(){be(this,e)}return Ee(e,null,[{key:"paint",value:function(e,t,n,i){if(null!=n){var r=[e.x,e.y],o=[e.w,e.h];if(null!=i&&(i.xmin<0&&(r[0]+=i.xmin),i.ymin<0&&(r[1]+=i.ymin),o[0]=i.xmax+(i.xmin<0?-i.xmin:0),o[1]=i.ymax+(i.ymin<0?-i.ymin:0)),isFinite(o[0])&&isFinite(o[1])){var s={width:""+(o[0]||0),height:""+(o[1]||0)};t.containerType===Ye.HTML?it(e.canvas,$(s,{style:ot([r[0],r[1]])})):it(e.canvas,$(s,{x:r[0],y:r[1]}))}}}}]),e}();function ki(e,t,n,i){!function(e,t){if(null!=t.canvas)return t.canvas;var n=rt(et,{style:"",width:"0",height:"0","pointer-events":w,position:j});t.canvas=n,e._appendElement(t.canvas,e.getContainer()),null!=t.cssClass&&e.addClass(n,t.cssClass),e.addClass(n,e.connectorClass),n.jtk=n.jtk||{},n.jtk.connector=t}(e,t),bi.paint(t,e,n,i);var r=[0,0];if(i.xmin<0&&(r[0]=-i.xmin),i.ymin<0&&(r[1]=-i.ymin),t.segments.length>0){var o={d:e.getPathData(t),transform:"translate("+r[0]+","+r[1]+")","pointer-events":"visibleStroke"},s=null;if(n.outlineStroke){var a=n.outlineWidth||1,l=n.strokeWidth+2*a;(s=$({},n)).stroke=n.outlineStroke,s.strokeWidth=l,null==t.bgPath?(t.bgPath=rt(tt,o),e.addClass(t.bgPath,e.connectorOutlineClass),at(t.canvas,t.bgPath,0)):it(t.bgPath,o),st(t.canvas,t.bgPath,s)}var c=t;null==c.path?(c.path=rt(tt,o),at(c.canvas,c.path,n.outlineStroke?1:0)):(c.path.parentNode!==c.canvas&&at(c.canvas,c.path,n.outlineStroke?1:0),it(t.path,o)),st(t.canvas,t.path,n)}}var Ei=function(){function e(){be(this,e)}return Ee(e,null,[{key:"getEndpointElement",value:function(e){if(null!=e.canvas)return e.canvas;var t=rt(et,{style:"",width:"0",height:"0","pointer-events":"all",position:j});e.canvas=t;var n=e.classes.join(" ");e.instance.addClass(t,n);for(var i=e.endpoint.scope.split(/\s/),r=0;r<i.length;r++)e.instance.setAttribute(t,f+i[r],_e);return e.instance._appendElementToContainer(t),null!=e.cssClass&&e.instance.addClass(t,e.cssClass),e.instance.addClass(t,e.instance.endpointClass),t.jtk=t.jtk||{},t.jtk.endpoint=e.endpoint,t.style.display=!1!==e.endpoint.visible?T:w,t}},{key:"paint",value:function(e,t,n){if(!0!==e.endpoint.deleted){this.getEndpointElement(e),bi.paint(e,e.instance,n);var i=$({},n);i.outlineStroke&&(i.stroke=i.outlineStroke),null==e.node?(e.node=t.makeNode(e,i),e.canvas.appendChild(e.node)):null!=t.updateNode&&t.updateNode(e,e.node),st(e.canvas,e.node,i)}}}]),e}(),xi={};function Ci(e,t){xi[e]=t}function Pi(e,n,i){var r=n,o=t(n.getBoundingClientRect)!==me?n.getBoundingClientRect():{left:0,top:0,width:0,height:0},s=document.body,a=document.documentElement,l=window.pageYOffset||a.scrollTop||s.scrollTop,c=window.pageXOffset||a.scrollLeft||s.scrollLeft,u=a.clientTop||s.clientTop||0,h=a.clientLeft||s.clientLeft||0,d=o.top+l-u+0*i,p=o.left+c-h+0*i,g=bn(e),f=o.width||r.offsetWidth*i,v=o.height||r.offsetHeight*i;return{x:(g.x-p)/f,y:(g.y-d)/v}}function Di(e){return L(e)||H(e)||z(e)}function Si(e,t){e.canvas&&(e.canvas.style.display=t?"block":"none")}function ji(e){e.canvas&&e.canvas.parentNode.removeChild(e.canvas),delete e.canvas}function wi(e){return e.canvas}function Mi(e){return mi.getElement(e)}function Ti(e){return mi.getElement(e,e.component,(function(t){var n=e.create(t);return e.instance.addClass(n,e.instance.overlayClass),n}))}function Ai(e,t,n,i){var r=e.x,o=e.y;return t._jsPlumbParentGroup&&t._jsPlumbParentGroup.constrain&&(r=Math.max(e.x,0),o=Math.max(e.y,0),r=Math.min(r,n.w-i.w),o=Math.min(o,n.h-i.h)),{x:r,y:o}}var Gi=function(e){Ce(i,e);var n=we(i);function i(e,t){var r;if(be(this,i),(r=n.call(this,e,t))._instanceIndex=e,xe(Se(r),"containerType",null),xe(Se(r),"dragSelection",void 0),xe(Se(r),"dragManager",void 0),xe(Se(r),"_connectorClick",void 0),xe(Se(r),"_connectorDblClick",void 0),xe(Se(r),"_connectorTap",void 0),xe(Se(r),"_connectorDblTap",void 0),xe(Se(r),"_endpointClick",void 0),xe(Se(r),"_endpointDblClick",void 0),xe(Se(r),"_overlayClick",void 0),xe(Se(r),"_overlayDblClick",void 0),xe(Se(r),"_overlayTap",void 0),xe(Se(r),"_overlayDblTap",void 0),xe(Se(r),"_connectorMouseover",void 0),xe(Se(r),"_connectorMouseout",void 0),xe(Se(r),"_endpointMouseover",void 0),xe(Se(r),"_endpointMouseout",void 0),xe(Se(r),"_connectorContextmenu",void 0),xe(Se(r),"_connectorMousedown",void 0),xe(Se(r),"_connectorMouseup",void 0),xe(Se(r),"_endpointMousedown",void 0),xe(Se(r),"_endpointMouseup",void 0),xe(Se(r),"_overlayMouseover",void 0),xe(Se(r),"_overlayMouseout",void 0),xe(Se(r),"_elementClick",void 0),xe(Se(r),"_elementTap",void 0),xe(Se(r),"_elementDblTap",void 0),xe(Se(r),"_elementMouseenter",void 0),xe(Se(r),"_elementMouseexit",void 0),xe(Se(r),"_elementMousemove",void 0),xe(Se(r),"_elementMouseup",void 0),xe(Se(r),"_elementMousedown",void 0),xe(Se(r),"_elementContextmenu",void 0),xe(Se(r),"_resizeObserver",void 0),xe(Se(r),"eventManager",void 0),xe(Se(r),"draggingClass","jtk-dragging"),xe(Se(r),"elementDraggingClass","jtk-element-dragging"),xe(Se(r),"hoverClass","jtk-hover"),xe(Se(r),"sourceElementDraggingClass","jtk-source-element-dragging"),xe(Se(r),"targetElementDraggingClass","jtk-target-element-dragging"),xe(Se(r),"hoverSourceClass","jtk-source-hover"),xe(Se(r),"hoverTargetClass","jtk-target-hover"),xe(Se(r),"dragSelectClass","jtk-drag-select"),xe(Se(r),"managedElementsSelector",void 0),xe(Se(r),"elementsDraggable",void 0),xe(Se(r),"elementDragHandler",void 0),xe(Se(r),"groupDragOptions",void 0),xe(Se(r),"elementDragOptions",void 0),xe(Se(r),"svg",{node:function(e,t){return rt(e,t)},attr:function(e,t){return it(e,t)},pos:function(e){return ot(e)}}),t=t||{},r.containerType=Ue(r.getContainer()),r.elementsDraggable=t&&!1!==t.elementsDraggable,r.managedElementsSelector=t&&t.managedElementsSelector||c,r.eventManager=new Gn,r.dragSelection=new ai(Se(r)),r.dragManager=new ui(Se(r),r.dragSelection),r.dragManager.addHandler(new vi(Se(r))),r.groupDragOptions={constrainFunction:Ai},r.dragManager.addHandler(new _i(Se(r),r.dragSelection),r.groupDragOptions),r.elementDragHandler=new di(Se(r),r.dragSelection),r.elementDragOptions=t&&t.dragOptions||{},r.dragManager.addHandler(r.elementDragHandler,r.elementDragOptions),t&&t.dragOptions&&t.dragOptions.filter&&r.dragManager.addFilter(t.dragOptions.filter),r._createEventListeners(),r._attachEventDelegates(),!1!==t.resizeObserver)try{r._resizeObserver=new ResizeObserver((function(e){e.filter((function(e){var t=r.getAttribute(e.target,A);if(null!=t){var n=r.viewport._elementMap.get(t);return!!n&&(n.w!==e.contentRect.width||n.h!==e.contentRect.height)}return!1})).forEach((function(e){return r.revalidate(e.target)}))}))}catch(o){ue("WARN: ResizeObserver could not be attached.")}return r}return Ee(i,[{key:"fireOverlayMethod",value:function(e,t,n){var i=lt(e.component instanceof G?gt:dt,t);n._jsPlumbOverlay=e,e.fire(t,{e:n,overlay:e}),this.fire(i,e.component,n)}},{key:"addDragFilter",value:function(e,t){this.dragManager.addFilter(e,t)}},{key:"removeDragFilter",value:function(e){this.dragManager.removeFilter(e)}},{key:"setDragGrid",value:function(e){this.dragManager.setOption(this.elementDragHandler,{grid:e})}},{key:"setDragConstrainFunction",value:function(e){this.dragManager.setOption(this.elementDragHandler,{constrainFunction:e})}},{key:"_removeElement",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"_appendElement",value:function(e,t){t&&t.appendChild(e)}},{key:"_appendElementToGroup",value:function(e,t){this.getGroupContentArea(e).appendChild(t)}},{key:"_appendElementToContainer",value:function(e){this._appendElement(e,this.getContainer())}},{key:"_getAssociatedElements",value:function(e){var t=[];if(3!==e.nodeType&&8!==e.nodeType){var n=e.querySelectorAll(c);Array.prototype.push.apply(t,n)}return t.filter((function(e){return 3!==e.nodeType&&8!==e.nodeType}))}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"getClass",value:function(e){return function(e){return He(e)}(e)}},{key:"addClass",value:function(e,t){Be(e,t)}},{key:"hasClass",value:function(e,t){return function(e,t){return e.classList?e.classList.contains(t):-1!==He(e).indexOf(t)}(e,t)}},{key:"removeClass",value:function(e,t){Ve(e,t)}},{key:"toggleClass",value:function(e,t){!function(e,t){var n=this,i=function(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?e.classList.toggle(t):n.hasClass(e,t)?n.removeClass(e,t):n.addClass(e,t))};Re(e)?ee(e,(function(e){return i(e,t)})):i(e,t)}(e,t)}},{key:"setAttribute",value:function(e,t,n){e.setAttribute(t,n)}},{key:"getAttribute",value:function(e,t){return e.getAttribute(t)}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}},{key:"removeAttribute",value:function(e,t){e.removeAttribute&&e.removeAttribute(t)}},{key:"on",value:function(e,t,n,i){var r=this,o=function(e){null==i?r.eventManager.on(e,t,n):r.eventManager.on(e,t,n,i)};return Re(e)?ee(e,(function(e){return o(e)})):o(e),this}},{key:"off",value:function(e,t,n){var i=this;return Re(e)?ee(e,(function(e){return i.eventManager.off(e,t,n)})):this.eventManager.off(e,t,n),this}},{key:"trigger",value:function(e,t,n,i,r){this.eventManager.trigger(e,t,n,i,r)}},{key:"getOffsetRelativeToRoot",value:function(e){return qe(e)}},{key:"getOffset",value:function(e){for(var t,n=e,i=this.getContainer(),r=this.getPosition(n),o=e!==i&&n.offsetParent!==i?n.offsetParent:null;null!=o;)r.x+=o.offsetLeft,r.y+=o.offsetTop,null!=(t=o)&&t!==document.body&&(t.scrollTop>0||t.scrollLeft>0)&&(r.x-=t.scrollLeft,r.y-=t.scrollTop),o=o.offsetParent===i?null:o.offsetParent;if(null!=i&&(i.scrollTop>0||i.scrollLeft>0)){var s=null!=n.offsetParent?this.getStyle(n.offsetParent,on):I,a=this.getStyle(n,on);a!==j&&a!==O&&s!==j&&s!==O&&(r.x-=i.scrollLeft,r.y-=i.scrollTop)}return r}},{key:"getSize",value:function(e){var t=e;return null!=t.offsetWidth?function(e){return{w:e.offsetWidth,h:e.offsetHeight}}(e):t.width&&t.width.baseVal?function(e){try{return{w:parseFloat(e.width.baseVal.value),h:parseFloat(e.height.baseVal.value)}}catch(t){return{w:0,h:0}}}(t):void 0}},{key:"getPosition",value:function(e){var t=e;return null!=t.offsetLeft?{x:parseFloat(t.offsetLeft),y:parseFloat(t.offsetTop)}:t.x&&t.x.baseVal?function(e){try{return{x:parseFloat(e.x.baseVal.value),y:parseFloat(e.y.baseVal.value)}}catch(t){return{x:0,y:0}}}(t):void 0}},{key:"getStyle",value:function(e,n){return t(window.getComputedStyle)!==me?getComputedStyle(e,null).getPropertyValue(n):e.currentStyle[n]}},{key:"getGroupContentArea",value:function(e){var t=this.getSelector(e.el,cn);return t&&t.length>0?t[0]:e.el}},{key:"getSelector",value:function(e,t){var n=null;if(1===arguments.length){if(!Q(e)){var i=document.createDocumentFragment();return i.appendChild(e),he(i.childNodes)}n=he(document.querySelectorAll(e))}else n=he(e.querySelectorAll(t));return n}},{key:"setPosition",value:function(e,t){var n=e;n.style.left=t.x+"px",n.style.top=t.y+"px"}},{key:"setDraggable",value:function(e,t){t?this.removeAttribute(e,u):this.setAttribute(e,u,_e)}},{key:"isDraggable",value:function(e){var t=this.getAttribute(e,u);return null==t||t===ve}},{key:"toggleDraggable",value:function(e){var t=this.isDraggable(e);return this.setDraggable(e,!t),!t}},{key:"_createEventListeners",value:function(){var e=function(e,t){if(!t.defaultPrevented&&null==t._jsPlumbOverlay){var n=Ne(Le(t),sn,this.getContainer(),!0);this.fire(e,n.jtk.connector.connection,t)}};this._connectorClick=e.bind(this,Yt),this._connectorDblClick=e.bind(this,Ut),this._connectorTap=e.bind(this,rn),this._connectorDblTap=e.bind(this,Kt);var t=function(e,t){var n=Le(t).parentNode;if(n.jtk&&n.jtk.connector){var i=n.jtk.connector,r=i.connection;this.setConnectorHover(i,e),e?(this.addClass(r.source,this.hoverSourceClass),this.addClass(r.target,this.hoverTargetClass)):(this.removeClass(r.source,this.hoverSourceClass),this.removeClass(r.target,this.hoverTargetClass)),this.fire(e?$t:Qt,n.jtk.connector.connection,t)}};this._connectorMouseover=t.bind(this,!0),this._connectorMouseout=t.bind(this,!1);var n=function(e,t){var n=Le(t).parentNode;n.jtk&&n.jtk.connector&&this.fire(e?en:tn,n.jtk.connector.connection,t)};this._connectorMouseup=n.bind(this,!0),this._connectorMousedown=n.bind(this,!1),this._connectorContextmenu=function(e){var t=Le(e).parentNode;t.jtk&&t.jtk.connector&&this.fire(nn,t.jtk.connector.connection,e)}.bind(this);var i=function(e,t,n){t.defaultPrevented||null!=t._jsPlumbOverlay||this.fire(e,n.jtk.endpoint,t)};this._endpointClick=i.bind(this,Rt),this._endpointDblClick=i.bind(this,Bt);var r=function(e,t){var n=Le(t);n.jtk&&n.jtk.endpoint&&(this.setEndpointHover(n.jtk.endpoint,e),this.fire(e?Wt:Vt,n.jtk.endpoint,t))};this._endpointMouseover=r.bind(this,!0),this._endpointMouseout=r.bind(this,!1);var o=function(e,t){var n=Le(t);n.jtk&&n.jtk.endpoint&&this.fire(e?Zt:qt,n.jtk.endpoint,t)};this._endpointMouseup=o.bind(this,!0),this._endpointMousedown=o.bind(this,!1);var s=function(e,t){var n=Ne(Le(t),un,this.getContainer(),!0).jtk.overlay;n&&this.fireOverlayMethod(n,e,t)}.bind(this);this._overlayClick=s.bind(this,ft),this._overlayDblClick=s.bind(this,_t),this._overlayTap=s.bind(this,Dt),this._overlayDblTap=s.bind(this,mt);var a=function(e,t){var n=Ne(Le(t),un,this.getContainer(),!0).jtk.overlay;n&&this.setOverlayHover(n,e)};this._overlayMouseover=a.bind(this,!0),this._overlayMouseout=a.bind(this,!1),this._elementClick=function(e,t,n){t.defaultPrevented||this.fire(1===t.detail?Tt:At,n,t)}.bind(this,Tt),this._elementTap=function(e,t,n){t.defaultPrevented||this.fire(zt,n,t)}.bind(this,zt),this._elementDblTap=function(e,t,n){t.defaultPrevented||this.fire(Gt,n,t)}.bind(this,Gt);var l=function(e,t){this.fire(e?Ot:It,Le(t),t)};this._elementMouseenter=l.bind(this,!0),this._elementMouseexit=l.bind(this,!1),this._elementMousemove=function(e){this.fire(Ft,Le(e),e)}.bind(this),this._elementMouseup=function(e){this.fire(Nt,Le(e),e)}.bind(this),this._elementMousedown=function(e){this.fire(Lt,Le(e),e)}.bind(this),this._elementContextmenu=function(e){this.fire(Ht,Le(e),e)}.bind(this)}},{key:"_attachEventDelegates",value:function(){var e=this.getContainer();this.eventManager.on(e,ft,un,this._overlayClick),this.eventManager.on(e,_t,un,this._overlayDblClick),this.eventManager.on(e,Dt,un,this._overlayTap),this.eventManager.on(e,mt,un,this._overlayDblTap),this.eventManager.on(e,ft,sn,this._connectorClick),this.eventManager.on(e,_t,sn,this._connectorDblClick),this.eventManager.on(e,Dt,sn,this._connectorTap),this.eventManager.on(e,mt,sn,this._connectorDblTap),this.eventManager.on(e,ft,an,this._endpointClick),this.eventManager.on(e,_t,an,this._endpointDblClick),this.eventManager.on(e,ft,this.managedElementsSelector,this._elementClick),this.eventManager.on(e,Dt,this.managedElementsSelector,this._elementTap),this.eventManager.on(e,mt,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(e,Pt,sn,this._connectorMouseover),this.eventManager.on(e,Ct,sn,this._connectorMouseout),this.eventManager.on(e,vt,sn,this._connectorContextmenu),this.eventManager.on(e,xt,sn,this._connectorMouseup),this.eventManager.on(e,yt,sn,this._connectorMousedown),this.eventManager.on(e,Pt,an,this._endpointMouseover),this.eventManager.on(e,Ct,an,this._endpointMouseout),this.eventManager.on(e,xt,an,this._endpointMouseup),this.eventManager.on(e,yt,an,this._endpointMousedown),this.eventManager.on(e,Pt,un,this._overlayMouseover),this.eventManager.on(e,Ct,un,this._overlayMouseout),this.eventManager.on(e,Pt,c,this._elementMouseenter),this.eventManager.on(e,Ct,c,this._elementMouseexit),this.eventManager.on(e,Et,c,this._elementMousemove),this.eventManager.on(e,xt,c,this._elementMouseup),this.eventManager.on(e,yt,c,this._elementMousedown),this.eventManager.on(e,vt,c,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function(){var e=this.getContainer();e&&(this.eventManager.off(e,ft,this._connectorClick),this.eventManager.off(e,_t,this._connectorDblClick),this.eventManager.off(e,Dt,this._connectorTap),this.eventManager.off(e,mt,this._connectorDblTap),this.eventManager.off(e,ft,this._endpointClick),this.eventManager.off(e,_t,this._endpointDblClick),this.eventManager.off(e,ft,this._overlayClick),this.eventManager.off(e,_t,this._overlayDblClick),this.eventManager.off(e,Dt,this._overlayTap),this.eventManager.off(e,mt,this._overlayDblTap),this.eventManager.off(e,ft,this._elementClick),this.eventManager.off(e,Dt,this._elementTap),this.eventManager.off(e,mt,this._elementDblTap),this.eventManager.off(e,Pt,this._connectorMouseover),this.eventManager.off(e,Ct,this._connectorMouseout),this.eventManager.off(e,vt,this._connectorContextmenu),this.eventManager.off(e,xt,this._connectorMouseup),this.eventManager.off(e,yt,this._connectorMousedown),this.eventManager.off(e,Pt,this._endpointMouseover),this.eventManager.off(e,Ct,this._endpointMouseout),this.eventManager.off(e,xt,this._endpointMouseup),this.eventManager.off(e,yt,this._endpointMousedown),this.eventManager.off(e,Pt,this._overlayMouseover),this.eventManager.off(e,Ct,this._overlayMouseout),this.eventManager.off(e,bt,this._elementMouseenter),this.eventManager.off(e,kt,this._elementMouseexit),this.eventManager.off(e,Et,this._elementMousemove),this.eventManager.off(e,xt,this._elementMouseup),this.eventManager.off(e,yt,this._elementMousedown),this.eventManager.off(e,vt,this._elementContextmenu))}},{key:"setContainer",value:function(e){var t,n=this;if(e===document||e===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates(),null!=this.dragManager&&(t=this.dragManager.reset()),this.setAttribute(e,ct,U().replace("-",""));var s=this.getContainer();if(null!=s){s.removeAttribute(ct);var l=he(s.childNodes).filter((function(e){return null!=e&&(n.hasClass(e,r)||n.hasClass(e,o)||n.hasClass(e,a)||e.getAttribute&&null!=e.getAttribute(A))}));ee(l,(function(t){e.appendChild(t)}))}Me(Pe(i.prototype),"setContainer",this).call(this,e),this.containerType=Ue(e),null!=this.eventManager&&this._attachEventDelegates(),null!=this.dragManager&&(this.dragManager.addHandler(new vi(this)),this.dragManager.addHandler(new _i(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new di(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),null!=t&&this.dragManager.setFilters(t))}},{key:"reset",value:function(){Me(Pe(i.prototype),"reset",this).call(this),this._resizeObserver&&this._resizeObserver.disconnect();var e=this.getContainer().querySelectorAll([c,an,sn,un].join(","));ee(e,(function(e){return e.parentNode&&e.parentNode.removeChild(e)}))}},{key:"destroy",value:function(){this._detachEventDelegates(),null!=this.dragManager&&this.dragManager.reset(),this.clearDragSelection(),Me(Pe(i.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(e,t){null!=this._resizeObserver&&this._resizeObserver.unobserve(e),this.removeFromDragSelection(e),Me(Pe(i.prototype),"unmanage",this).call(this,e,t)}},{key:"addToDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];ee(n,(function(t){return e.dragSelection.add(t)}))}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];ee(n,(function(t){return e.dragSelection.remove(t)}))}},{key:"toggleDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];ee(n,(function(t){return e.dragSelection.toggle(t)}))}},{key:"addToDragGroup",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=this.elementDragHandler).addToDragGroup.apply(t,[e].concat(i))}},{key:"removeFromDragGroup",value:function(){var e;(e=this.elementDragHandler).removeFromDragGroup.apply(e,arguments)}},{key:"setDragGroupState",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=this.elementDragHandler).setDragGroupState.apply(t,[e].concat(i))}},{key:"clearDragGroup",value:function(e){this.elementDragHandler.clearDragGroup(e)}},{key:"consume",value:function(e,t){Fe(e,t)}},{key:"rotate",value:function(e,t,n){var r=this.getId(e);return this._managedElements[r]?(this._managedElements[r].el.style.transform="rotate("+t+"deg)",this._managedElements[r].el.style.transformOrigin="center center",Me(Pe(i.prototype),"rotate",this).call(this,e,t,n)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(e,t){if(F(e))e.instance.addClass(Mi(e),t);else if(Di(e))e.instance.addClass(yi(e),t);else{if(!N(e))throw"Could not add class to overlay of type ["+e.type+"]";e.instance.addClass(Ti(e),t)}}},{key:"removeOverlayClass",value:function(e,t){if(F(e))e.instance.removeClass(Mi(e),t);else if(Di(e))e.instance.removeClass(yi(e),t);else{if(!N(e))throw"Could not remove class from overlay of type ["+e.type+"]";e.instance.removeClass(Ti(e),t)}}},{key:"_paintOverlay",value:function(e,t,n){if(F(e)){Mi(e);var i=e.component.getXY();e.canvas.style.left=i.x+t.d.minx+"px",e.canvas.style.top=i.y+t.d.miny+"px"}else if(Di(e))!function(e,t,n,i){yi(e);var r=[0,0];i.xmin<0&&(r[0]=-i.xmin),i.ymin<0&&(r[1]=-i.ymin);var o={d:t,stroke:n.stroke?n.stroke:null,fill:n.fill?n.fill:null,transform:"translate("+r[0]+","+r[1]+")","pointer-events":"visibleStroke"};it(e.path,o)}(e,isNaN(t.d.cxy.x)||isNaN(t.d.cxy.y)?"M 0 0":"M"+t.d.hxy.x+","+t.d.hxy.y+" L"+t.d.tail[0].x+","+t.d.tail[0].y+" L"+t.d.cxy.x+","+t.d.cxy.y+" L"+t.d.tail[1].x+","+t.d.tail[1].y+" Z",t,n);else{if(!N(e))throw"Could not paint overlay of type ["+e.type+"]";Ti(e);var r=e.component.getXY();e.canvas.style.left=r.x+t.d.minx+"px",e.canvas.style.top=r.y+t.d.miny+"px"}}},{key:"setOverlayVisible",value:function(e,t){var n=t?"block":"none";function i(e){null!=e&&(e.style.display=n)}F(e)?i(Mi(e)):N(e)?i(Ti(e)):Di(e)&&i(e.path)}},{key:"reattachOverlay",value:function(e,t){F(e)?e.instance._appendElement(Mi(e),this.getContainer()):N(e)?e.instance._appendElement(Ti(e),this.getContainer()):Di(e)&&this._appendElement(yi(e),t.connector.canvas)}},{key:"setOverlayHover",value:function(e,t){var n;F(e)?n=Mi(e):N(e)?n=Ti(e):Di(e)&&(n=yi(e)),null!=n&&(null!=this.hoverClass&&(t?this.addClass(n,this.hoverClass):this.removeClass(n,this.hoverClass)),this.setHover(e.component,t))}},{key:"destroyOverlay",value:function(e){if(F(e)){var t=Mi(e);t.parentNode.removeChild(t),delete e.canvas,delete e.cachedDimensions}else if(L(e)||H(e)||z(e))!function(e,t){var n=e;null!=n.path&&null!=n.path.parentNode&&n.path.parentNode.removeChild(n.path),null!=n.bgPath&&null!=n.bgPath.parentNode&&n.bgPath.parentNode.removeChild(n.bgPath),delete n.path,delete n.bgPath}(e);else if(N(e)){var n=Ti(e);n.parentNode.removeChild(n),delete e.canvas,delete e.cachedDimensions}}},{key:"drawOverlay",value:function(e,t,n,i){if(F(e)||N(e)){var r=mi._getDimensions(e);if(null!=r&&null!=r.w&&null!=r.h){var o={x:0,y:0};if(i)o={x:i.x,y:i.y};else if(t instanceof R){var s=Array.isArray(e.location)?e.location:[e.location,e.location];o={x:s[0]*t.w,y:s[1]*t.h}}else{var a=e.location,l=!1;(Q(e.location)||e.location<0||e.location>1)&&(a=parseInt(""+e.location,10),l=!0),o=t.pointOnPath(a,l)}var c=o.x-r.w/2,u=o.y-r.h/2;return{component:e,d:{minx:c,miny:u,td:r,cxy:o},xmin:c,xmax:c+r.w,ymin:u,ymax:u+r.h}}return{xmin:0,xmax:0,ymin:0,ymax:0}}if(L(e)||H(e)||z(e))return e.draw(t,n,i);throw"Could not draw overlay of type ["+e.type+"]"}},{key:"updateLabel",value:function(e){if(de(e.label)){var t=e.label(this);Mi(e).innerText=null!=t?t:""}else null==e.labelText&&(e.labelText=e.label,null!=e.labelText?Mi(e).innerText=e.labelText:Mi(e).innerText="")}},{key:"setHover",value:function(e,t){e._hover=t,e instanceof B&&null!=e.endpoint?this.setEndpointHover(e,t,-1):e instanceof G&&null!=e.connector&&this.setConnectorHover(e.connector,t)}},{key:"paintConnector",value:function(e,t,n){ki(this,e,t,n)}},{key:"setConnectorHover",value:function(e,t,n){if(!1===t||!this.currentlyDragging&&!this.isHoverSuspended()){var i=e.canvas;null!=i&&(null!=e.hoverClass&&(t?this.addClass(i,e.hoverClass):this.removeClass(i,e.hoverClass)),t?this.addClass(i,this.hoverClass):this.removeClass(i,this.hoverClass)),null!=e.connection.hoverPaintStyle&&(e.connection.paintStyleInUse=t?e.connection.hoverPaintStyle:e.connection.paintStyle,this._suspendDrawing||this._paintConnection(e.connection)),e.connection.endpoints[0]!==n&&this.setEndpointHover(e.connection.endpoints[0],t,0,!0),e.connection.endpoints[1]!==n&&this.setEndpointHover(e.connection.endpoints[1],t,1,!0)}}},{key:"destroyConnector",value:function(e){null!=e.connector&&ji(e.connector)}},{key:"addConnectorClass",value:function(e,t){e.canvas&&this.addClass(e.canvas,t)}},{key:"removeConnectorClass",value:function(e,t){e.canvas&&this.removeClass(e.canvas,t)}},{key:"getConnectorClass",value:function(e){return e.canvas?e.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(e,t){Si(e,t)}},{key:"applyConnectorType",value:function(e,t){if(e.canvas&&t.cssClass){var n=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(e.canvas,n.join(" "))}}},{key:"addEndpointClass",value:function(e,t){var n=wi(e.endpoint);null!=n&&this.addClass(n,t)}},{key:"applyEndpointType",value:function(e,t){if(t.cssClass){var n=wi(e.endpoint);if(n){var i=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(n,i.join(" "))}}}},{key:"destroyEndpoint",value:function(e){var t=this.endpointAnchorClassPrefix+(e.currentAnchorClass?"-"+e.currentAnchorClass:"");this.removeClass(e.element,t),ji(e.endpoint)}},{key:"renderEndpoint",value:function(e,t){var n=xi[e.endpoint.type];null!=n?Ei.paint(e.endpoint,n,t):ue("jsPlumb: no endpoint renderer found for type ["+e.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(e,t){var n=wi(e.endpoint);null!=n&&this.removeClass(n,t)}},{key:"getEndpointClass",value:function(e){var t=wi(e.endpoint);return null!=t?t.className:""}},{key:"setEndpointHover",value:function(e,t,n,i){if(null!=e&&(!1===t||!this.currentlyDragging&&!this.isHoverSuspended())){var r=wi(e.endpoint);if(null!=r&&(null!=e.hoverClass&&(t?this.addClass(r,e.hoverClass):this.removeClass(r,e.hoverClass)),0===n||1===n)){var o=0===n?this.hoverSourceClass:this.hoverTargetClass;t?this.addClass(r,o):this.removeClass(r,o)}if(null!=e.hoverPaintStyle&&(e.paintStyleInUse=t?e.hoverPaintStyle:e.paintStyle,this._suspendDrawing||this.renderEndpoint(e,e.paintStyleInUse)),!i)for(var s=0;s<e.connections.length;s++)this.setConnectorHover(e.connections[s].connector,t,e)}}},{key:"setEndpointVisible",value:function(e,t){Si(e.endpoint,t)}},{key:"setGroupVisible",value:function(e,t){for(var n=e.el.querySelectorAll(c),i=0;i<n.length;i++)t?this.show(n[i],!0):this.hide(n[i],!0)}},{key:"deleteConnection",value:function(e,t){return null!=e&&!0!==e.deleted&&(!0!==e.endpoints[0].deleted&&this.setEndpointHover(e.endpoints[0],!1,0,!0),!0!==e.endpoints[1].deleted&&this.setEndpointHover(e.endpoints[1],!1,1,!0),Me(Pe(i.prototype),"deleteConnection",this).call(this,e,t))}},{key:"addSourceSelector",value:function(e,t,n){return this.addDragFilter(e),Me(Pe(i.prototype),"addSourceSelector",this).call(this,e,t,n)}},{key:"removeSourceSelector",value:function(e){this.removeDragFilter(e.selector),Me(Pe(i.prototype),"removeSourceSelector",this).call(this,e)}},{key:"manage",value:function(e,t,n){if(this.containerType===Ye.SVG&&Ue(e)!==Ye.SVG)throw new Error("ERROR: cannot manage non-svg element when container is an SVG element.");var r=Me(Pe(i.prototype),"manage",this).call(this,e,t,n);return null!=r&&null!=this._resizeObserver&&this._resizeObserver.observe(r.el),r}}]),i}(V),Ii={width:10,height:0,fill:"transparent",stroke:"transparent"};Ci(W.type,{makeNode:function(e,t){return rt("circle",{cx:e.w/2,cy:e.h/2,r:e.radius})},updateNode:function(e,t){it(t,{cx:""+e.w/2,cy:""+e.h/2,r:""+e.radius})}}),Ci(q.type,{makeNode:function(e,t){return rt("rect",Ii)},updateNode:function(e,t){it(t,Ii)}}),Ci(Z.type,{makeNode:function(e,t){return rt("rect",{width:e.w,height:e.h})},updateNode:function(e,t){it(t,{width:e.w,height:e.h})}});var Oi=0}}}));
//# sourceMappingURL=browser-ui-legacy-dc4ca6ad.js.map
