{"version":3,"file":"RunDataSchema-8211023d.js","sources":["../../src/components/RunDataSchemaItem.vue","../../src/components/RunDataSchema.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport { computed } from 'vue';\nimport type { INodeUi, Schema } from '@/Interface';\nimport { checkExhaustive, shorten } from '@/utils';\nimport { getMappedExpression } from '@/utils/mappingUtils';\n\ntype Props = {\n\tschema: Schema;\n\tlevel: number;\n\tparent: Schema | null;\n\tsubKey: string;\n\tpaneType: 'input' | 'output';\n\tmappingEnabled: boolean;\n\tdraggingPath: string;\n\tdistanceFromActive: number;\n\tnode: INodeUi | null;\n};\n\nconst props = defineProps<Props>();\n\nconst isSchemaValueArray = computed(() => Array.isArray(props.schema.value));\nconst isSchemaParentTypeArray = computed(() => props.parent?.type === 'array');\nconst isFlat = computed(\n\t() =>\n\t\tprops.level === 0 &&\n\t\tArray.isArray(props.schema.value) &&\n\t\tprops.schema.value.every((v) => !Array.isArray(v.value)),\n);\nconst key = computed((): string | undefined =>\n\tisSchemaParentTypeArray.value ? `[${props.schema.key}]` : props.schema.key,\n);\nconst schemaName = computed(() =>\n\tisSchemaParentTypeArray.value ? `${props.schema.type}[${props.schema.key}]` : props.schema.key,\n);\nconst text = computed(() =>\n\tArray.isArray(props.schema.value) ? '' : shorten(props.schema.value, 600, 0),\n);\n\nconst getJsonParameterPath = (path: string): string =>\n\tgetMappedExpression({\n\t\tnodeName: props.node!.name,\n\t\tdistanceFromActive: props.distanceFromActive,\n\t\tpath,\n\t});\n\nconst transitionDelay = (i: number) => `${i * 0.033}s`;\n\nconst getIconBySchemaType = (type: Schema['type']): string => {\n\tswitch (type) {\n\t\tcase 'object':\n\t\t\treturn 'cube';\n\t\tcase 'array':\n\t\t\treturn 'list';\n\t\tcase 'string':\n\t\tcase 'null':\n\t\t\treturn 'font';\n\t\tcase 'number':\n\t\t\treturn 'hashtag';\n\t\tcase 'boolean':\n\t\t\treturn 'check-square';\n\t\tcase 'function':\n\t\t\treturn 'code';\n\t\tcase 'bigint':\n\t\t\treturn 'calculator';\n\t\tcase 'symbol':\n\t\t\treturn 'sun';\n\t\tcase 'undefined':\n\t\t\treturn 'ban';\n\t}\n\n\tcheckExhaustive(type);\n};\n</script>\n\n<template>\n\t<div :class=\"$style.item\" data-test-id=\"run-data-schema-item\">\n\t\t<div\n\t\t\tv-if=\"level > 0 || (level === 0 && !isSchemaValueArray)\"\n\t\t\t:title=\"schema.type\"\n\t\t\t:class=\"{\n\t\t\t\t[$style.pill]: true,\n\t\t\t\t[$style.mappable]: mappingEnabled,\n\t\t\t\t[$style.dragged]: draggingPath === schema.path,\n\t\t\t}\"\n\t\t>\n\t\t\t<span\n\t\t\t\t:class=\"$style.label\"\n\t\t\t\t:data-value=\"getJsonParameterPath(schema.path)\"\n\t\t\t\t:data-name=\"schemaName\"\n\t\t\t\t:data-path=\"schema.path\"\n\t\t\t\t:data-depth=\"level\"\n\t\t\t\tdata-target=\"mappable\"\n\t\t\t>\n\t\t\t\t<font-awesome-icon :icon=\"getIconBySchemaType(schema.type)\" size=\"sm\" />\n\t\t\t\t<span v-if=\"isSchemaParentTypeArray\">{{ parent.key }}</span>\n\t\t\t\t<span v-if=\"key\" :class=\"{ [$style.arrayIndex]: isSchemaParentTypeArray }\">{{ key }}</span>\n\t\t\t</span>\n\t\t</div>\n\t\t<span v-if=\"text\" :class=\"$style.text\" class=\"ph-no-capture\">{{ text }}</span>\n\t\t<input v-if=\"level > 0 && isSchemaValueArray\" :id=\"subKey\" type=\"checkbox\" checked />\n\t\t<label v-if=\"level > 0 && isSchemaValueArray\" :class=\"$style.toggle\" :for=\"subKey\">\n\t\t\t<font-awesome-icon icon=\"angle-up\" />\n\t\t</label>\n\t\t<div v-if=\"isSchemaValueArray\" :class=\"{ [$style.sub]: true, [$style.flat]: isFlat }\">\n\t\t\t<run-data-schema-item\n\t\t\t\tv-for=\"(s, i) in schema.value\"\n\t\t\t\t:key=\"`${s.type}-${level}-${i}`\"\n\t\t\t\t:schema=\"s\"\n\t\t\t\t:level=\"level + 1\"\n\t\t\t\t:parent=\"schema\"\n\t\t\t\t:paneType=\"paneType\"\n\t\t\t\t:subKey=\"`${paneType}_${s.type}-${level}-${i}`\"\n\t\t\t\t:mappingEnabled=\"mappingEnabled\"\n\t\t\t\t:draggingPath=\"draggingPath\"\n\t\t\t\t:distanceFromActive=\"distanceFromActive\"\n\t\t\t\t:node=\"node\"\n\t\t\t\t:style=\"{ transitionDelay: transitionDelay(i) }\"\n\t\t\t/>\n\t\t</div>\n\t</div>\n</template>\n\n<style lang=\"scss\" module>\n@import '@/styles/css-animation-helpers.scss';\n\n.item {\n\tdisplay: block;\n\tposition: relative;\n\ttransition: all 0.3s $ease-out-expo;\n\n\t.item {\n\t\tpadding-top: var(--spacing-2xs);\n\t\tpadding-left: var(--spacing-l);\n\t}\n\n\tinput {\n\t\tposition: absolute;\n\t\tleft: -100%;\n\n\t\t~ .sub {\n\t\t\theight: 0;\n\n\t\t\t> .item {\n\t\t\t\ttransform: translateX(-100%);\n\t\t\t}\n\t\t}\n\n\t\t&:checked {\n\t\t\t~ .toggle svg {\n\t\t\t\ttransform: rotate(180deg);\n\t\t\t}\n\n\t\t\t~ .sub {\n\t\t\t\theight: auto;\n\n\t\t\t\t> .item {\n\t\t\t\t\ttransform: translateX(0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t&::after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tclear: both;\n\t}\n}\n\n.sub {\n\tdisplay: block;\n\toverflow: hidden;\n\ttransition: all 0.2s $ease-out-expo;\n\tclear: both;\n\n\t&.flat {\n\t\t> .item {\n\t\t\tpadding-left: 0;\n\t\t}\n\t}\n\n\t&:nth-of-type(1) {\n\t\t> .item:nth-of-type(1) {\n\t\t\tpadding-top: 0;\n\n\t\t\t.toggle {\n\t\t\t\ttop: -2px;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.pill {\n\tfloat: left;\n\tdisplay: inline-flex;\n\theight: 24px;\n\tpadding: 0 var(--spacing-3xs);\n\tborder: 1px solid var(--color-foreground-light);\n\tborder-radius: 4px;\n\tbackground-color: var(--color-background-xlight);\n\tfont-size: var(--font-size-2xs);\n\tcolor: var(--color-text-dark);\n\n\tspan {\n\t\tdisplay: flex;\n\t\theight: 100%;\n\t\talign-items: center;\n\n\t\tsvg {\n\t\t\tpath {\n\t\t\t\tfill: var(--color-text-light);\n\t\t\t}\n\t\t}\n\t}\n\n\t&.mappable {\n\t\tcursor: grab;\n\n\t\t&:hover {\n\t\t\t&,\n\t\t\tspan span {\n\t\t\t\tbackground-color: var(--color-background-light);\n\t\t\t\tborder-color: var(--color-foreground-base);\n\t\t\t}\n\t\t}\n\t}\n\n\t&.dragged {\n\t\t&,\n\t\t&:hover,\n\t\tspan {\n\t\t\tcolor: var(--color-primary);\n\t\t\tborder-color: var(--color-primary-tint-1);\n\t\t\tbackground-color: var(--color-primary-tint-3);\n\n\t\t\tsvg {\n\t\t\t\tpath {\n\t\t\t\t\tfill: var(--color-primary);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n.label {\n\t> span {\n\t\tmargin-left: var(--spacing-3xs);\n\t\tpadding-left: var(--spacing-3xs);\n\t\tborder-left: 1px solid var(--color-foreground-light);\n\n\t\t&.arrayIndex {\n\t\t\tborder: 0;\n\t\t\tpadding-left: 0;\n\t\t\tmargin-left: 0;\n\t\t}\n\t}\n}\n\n.text {\n\tdisplay: block;\n\tpadding-top: var(--spacing-4xs);\n\tpadding-left: var(--spacing-2xs);\n\tfont-weight: var(--font-weight-normal);\n\tfont-size: var(--font-size-2xs);\n\toverflow: hidden;\n\tword-break: break-word;\n}\n\n.toggle {\n\tdisplay: flex;\n\tposition: absolute;\n\tpadding: var(--spacing-2xs);\n\tleft: 0;\n\ttop: 5px;\n\tjustify-content: center;\n\talign-items: center;\n\tcursor: pointer;\n\tuser-select: none;\n\tfont-weight: normal;\n\tfont-size: var(--font-size-s);\n\toverflow: hidden;\n\n\tsvg {\n\t\ttransition: all 0.3s $ease-out-expo;\n\t}\n}\n</style>\n","<script lang=\"ts\" setup>\nimport { computed, ref } from 'vue';\nimport { merge } from 'lodash-es';\nimport type { INodeUi, Schema } from '@/Interface';\nimport RunDataSchemaItem from '@/components/RunDataSchemaItem.vue';\nimport Draggable from '@/components/Draggable.vue';\nimport { useNDVStore } from '@/stores/ndv.store';\nimport { useWebhooksStore } from '@/stores/webhooks.store';\nimport { telemetry } from '@/plugins/telemetry';\nimport type { IDataObject } from 'n8n-workflow';\nimport { getSchema, isEmpty, runExternalHook } from '@/utils';\nimport { i18n } from '@/plugins/i18n';\nimport MappingPill from './MappingPill.vue';\n\ntype Props = {\n\tdata: IDataObject[];\n\tmappingEnabled: boolean;\n\tdistanceFromActive: number;\n\trunIndex: number;\n\ttotalRuns: number;\n\tpaneType: 'input' | 'output';\n\tnode: INodeUi | null;\n};\n\nconst props = withDefaults(defineProps<Props>(), {\n\tdistanceFromActive: 0,\n});\n\nconst draggingPath = ref<string>('');\nconst ndvStore = useNDVStore();\nconst webhooksStore = useWebhooksStore();\n\nconst schema = computed<Schema>(() => {\n\tconst [head, ...tail] = props.data;\n\treturn getSchema(merge({}, head, ...tail, head));\n});\n\nconst isDataEmpty = computed(() => {\n\treturn isEmpty(props.data);\n});\n\nconst onDragStart = (el: HTMLElement) => {\n\tif (el && el.dataset?.path) {\n\t\tdraggingPath.value = el.dataset.path;\n\t}\n\n\tndvStore.resetMappingTelemetry();\n};\nconst onDragEnd = (el: HTMLElement) => {\n\tdraggingPath.value = '';\n\n\tsetTimeout(() => {\n\t\tconst mappingTelemetry = ndvStore.mappingTelemetry;\n\t\tconst telemetryPayload = {\n\t\t\tsrc_node_type: props.node?.type,\n\t\t\tsrc_field_name: el.dataset.name || '',\n\t\t\tsrc_nodes_back: props.distanceFromActive,\n\t\t\tsrc_run_index: props.runIndex,\n\t\t\tsrc_runs_total: props.totalRuns,\n\t\t\tsrc_field_nest_level: el.dataset.depth || 0,\n\t\t\tsrc_view: 'schema',\n\t\t\tsrc_element: el,\n\t\t\tsuccess: false,\n\t\t\t...mappingTelemetry,\n\t\t};\n\n\t\tvoid runExternalHook('runDataJson.onDragEnd', webhooksStore, telemetryPayload);\n\n\t\ttelemetry.track('User dragged data for mapping', telemetryPayload);\n\t}, 1000); // ensure dest data gets set if drop\n};\n</script>\n\n<template>\n\t<div :class=\"$style.schemaWrapper\">\n\t\t<n8n-info-tip v-if=\"isDataEmpty\">{{\n\t\t\ti18n.baseText('dataMapping.schemaView.emptyData')\n\t\t}}</n8n-info-tip>\n\t\t<draggable\n\t\t\tv-else\n\t\t\ttype=\"mapping\"\n\t\t\ttargetDataKey=\"mappable\"\n\t\t\t:disabled=\"!mappingEnabled\"\n\t\t\t@dragstart=\"onDragStart\"\n\t\t\t@dragend=\"onDragEnd\"\n\t\t>\n\t\t\t<template #preview=\"{ canDrop, el }\">\n\t\t\t\t<MappingPill v-if=\"el\" :html=\"el.outerHTML\" :can-drop=\"canDrop\" />\n\t\t\t</template>\n\t\t\t<template>\n\t\t\t\t<div :class=\"$style.schema\">\n\t\t\t\t\t<run-data-schema-item\n\t\t\t\t\t\t:schema=\"schema\"\n\t\t\t\t\t\t:level=\"0\"\n\t\t\t\t\t\t:parent=\"null\"\n\t\t\t\t\t\t:paneType=\"paneType\"\n\t\t\t\t\t\t:subKey=\"`${schema.type}-0-0`\"\n\t\t\t\t\t\t:mappingEnabled=\"mappingEnabled\"\n\t\t\t\t\t\t:draggingPath=\"draggingPath\"\n\t\t\t\t\t\t:distanceFromActive=\"distanceFromActive\"\n\t\t\t\t\t\t:node=\"node\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</draggable>\n\t</div>\n</template>\n\n<style lang=\"scss\" module>\n.schemaWrapper {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tbottom: 0;\n\tright: 0;\n\toverflow: auto;\n\tline-height: 1.5;\n\tword-break: normal;\n\theight: 100%;\n\twidth: 100%;\n\tbackground-color: var(--color-background-base);\n\n\t> div[class*='info'] {\n\t\tpadding: 0 var(--spacing-s);\n\t}\n}\n\n.schema {\n\tdisplay: inline-block;\n\tpadding: 0 var(--spacing-s) var(--spacing-s);\n}\n</style>\n"],"names":["isSchemaValueArray","computed","props","isSchemaParentTypeArray","_a","isFlat","v","key","schemaName","text","shorten","path","getMappedExpression","i","type","checkExhaustive","draggingPath","ref","ndvStore","useNDVStore","webhooksStore","useWebhooksStore","schema","head","tail","getSchema","merge","isDataEmpty","isEmpty","el","mappingTelemetry","telemetryPayload","runExternalHook","telemetry"],"mappings":"y2DAoBMA,EAAqBC,EAAS,IAAM,MAAM,QAAQC,EAAM,OAAO,KAAK,CAAC,EACrEC,EAA0BF,EAAS,IAAM,OAAA,QAAAG,EAAAF,EAAM,SAAN,YAAAE,EAAc,QAAS,QAAO,EACvEC,EAASJ,EACd,IACCC,EAAM,QAAU,GAChB,MAAM,QAAQA,EAAM,OAAO,KAAK,GAChCA,EAAM,OAAO,MAAM,MAAOI,GAAM,CAAC,MAAM,QAAQA,EAAE,KAAK,CAAC,CAAA,EAEnDC,EAAMN,EAAS,IACpBE,EAAwB,MAAQ,IAAID,EAAM,OAAO,OAASA,EAAM,OAAO,GAAA,EAElEM,EAAaP,EAAS,IAC3BE,EAAwB,MAAQ,GAAGD,EAAM,OAAO,QAAQA,EAAM,OAAO,OAASA,EAAM,OAAO,GAAA,EAEtFO,EAAOR,EAAS,IACrB,MAAM,QAAQC,EAAM,OAAO,KAAK,EAAI,GAAKQ,EAAQR,EAAM,OAAO,MAAO,IAAK,CAAC,CAAA,iIAG9CS,GAC7BC,EAAoB,CACnB,SAAUV,EAAM,KAAM,KACtB,mBAAoBA,EAAM,mBAC1B,KAAAS,CAAA,CACA,kBAEuBE,GAAc,GAAGA,EAAI,4BAEjBC,GAAiC,CAC7D,OAAQA,EAAM,CACb,IAAK,SACG,MAAA,OACR,IAAK,QACG,MAAA,OACR,IAAK,SACL,IAAK,OACG,MAAA,OACR,IAAK,SACG,MAAA,UACR,IAAK,UACG,MAAA,eACR,IAAK,WACG,MAAA,OACR,IAAK,SACG,MAAA,aACR,IAAK,SACG,MAAA,MACR,IAAK,YACG,MAAA,KACT,CAEAC,EAAgBD,CAAI,CAAA,yqEC1CfE,EAAeC,EAAY,EAAE,EAC7BC,EAAWC,IACXC,EAAgBC,IAEhBC,EAASrB,EAAiB,IAAM,CACrC,KAAM,CAACsB,EAAM,GAAGC,CAAI,EAAItB,EAAM,KACvB,OAAAuB,EAAUC,EAAM,CAAC,EAAGH,EAAM,GAAGC,EAAMD,CAAI,CAAC,CAAA,CAC/C,EAEKI,EAAc1B,EAAS,IACrB2B,EAAQ1B,EAAM,IAAI,CACzB,uGAEoB2B,GAAoB,OACpCA,KAAMzB,EAAAyB,EAAG,UAAH,MAAAzB,EAAY,QACRY,EAAA,MAAQa,EAAG,QAAQ,MAGjCX,EAAS,sBAAsB,CAAA,YAEbW,GAAoB,CACtCb,EAAa,MAAQ,GAErB,WAAW,IAAM,OAChB,MAAMc,EAAmBZ,EAAS,iBAC5Ba,EAAmB,CACxB,eAAe3B,EAAAF,EAAM,OAAN,YAAAE,EAAY,KAC3B,eAAgByB,EAAG,QAAQ,MAAQ,GACnC,eAAgB3B,EAAM,mBACtB,cAAeA,EAAM,SACrB,eAAgBA,EAAM,UACtB,qBAAsB2B,EAAG,QAAQ,OAAS,EAC1C,SAAU,SACV,YAAaA,EACb,QAAS,GACT,GAAGC,CAAA,EAGCE,EAAgB,wBAAyBZ,EAAeW,CAAgB,EAEnEE,EAAA,MAAM,gCAAiCF,CAAgB,GAC/D,GAAI,CAAA"}